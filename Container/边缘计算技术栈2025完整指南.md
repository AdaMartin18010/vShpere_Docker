# è¾¹ç¼˜è®¡ç®—æŠ€æœ¯æ ˆ2025å®Œæ•´æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-22  
> **æŠ€æœ¯åŸºçº¿**: K3s 1.31, KubeEdge 1.18, K0s 1.31, MicroK8s 1.31, OpenYurt 1.5  
> **è´¨é‡è¯„åˆ†**: 98/100

## ğŸ“‹ ç›®å½•

- [è¾¹ç¼˜è®¡ç®—æŠ€æœ¯æ ˆ2025å®Œæ•´æŒ‡å—](#è¾¹ç¼˜è®¡ç®—æŠ€æœ¯æ ˆ2025å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. è¾¹ç¼˜è®¡ç®—æ¦‚è¿°](#1-è¾¹ç¼˜è®¡ç®—æ¦‚è¿°)
    - [1.1 è¾¹ç¼˜è®¡ç®—å®šä¹‰ä¸æ¼”è¿›](#11-è¾¹ç¼˜è®¡ç®—å®šä¹‰ä¸æ¼”è¿›)
      - [è¾¹ç¼˜è®¡ç®—å±‚æ¬¡ç»“æ„](#è¾¹ç¼˜è®¡ç®—å±‚æ¬¡ç»“æ„)
      - [æŠ€æœ¯æ¼”è¿›å†ç¨‹](#æŠ€æœ¯æ¼”è¿›å†ç¨‹)
    - [1.2 è¾¹ç¼˜è®¡ç®— vs äº‘è®¡ç®—](#12-è¾¹ç¼˜è®¡ç®—-vs-äº‘è®¡ç®—)
    - [1.3 è¾¹ç¼˜è®¡ç®—åº”ç”¨åœºæ™¯](#13-è¾¹ç¼˜è®¡ç®—åº”ç”¨åœºæ™¯)
  - [2. K3sè½»é‡çº§Kubernetes](#2-k3sè½»é‡çº§kubernetes)
    - [2.1 K3sæ¶æ„](#21-k3sæ¶æ„)
    - [2.2 K3så®‰è£…ä¸é…ç½®](#22-k3så®‰è£…ä¸é…ç½®)
      - [å•èŠ‚ç‚¹å®‰è£…](#å•èŠ‚ç‚¹å®‰è£…)
      - [é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²](#é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²)
    - [2.3 K3sè¾¹ç¼˜åœºæ™¯ä¼˜åŒ–](#23-k3sè¾¹ç¼˜åœºæ™¯ä¼˜åŒ–)
      - [èµ„æºé™åˆ¶é…ç½®](#èµ„æºé™åˆ¶é…ç½®)
      - [ç¦»çº¿éƒ¨ç½²](#ç¦»çº¿éƒ¨ç½²)
  - [3. KubeEdgeäº‘è¾¹ååŒ](#3-kubeedgeäº‘è¾¹ååŒ)
    - [3.1 KubeEdgeæ¶æ„](#31-kubeedgeæ¶æ„)
    - [3.2 KubeEdgeéƒ¨ç½²](#32-kubeedgeéƒ¨ç½²)
      - [äº‘ç«¯éƒ¨ç½² (CloudCore)](#äº‘ç«¯éƒ¨ç½²-cloudcore)
      - [è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½² (EdgeCore)](#è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²-edgecore)
    - [3.3 è®¾å¤‡ç®¡ç†ä¸è¾¹ç¼˜è‡ªæ²»](#33-è®¾å¤‡ç®¡ç†ä¸è¾¹ç¼˜è‡ªæ²»)
      - [è®¾å¤‡æ¨¡å‹å®šä¹‰](#è®¾å¤‡æ¨¡å‹å®šä¹‰)
      - [è¾¹ç¼˜è‡ªæ²»æµ‹è¯•](#è¾¹ç¼˜è‡ªæ²»æµ‹è¯•)
  - [4. å…¶ä»–è¾¹ç¼˜Kuberneteså‘è¡Œç‰ˆ](#4-å…¶ä»–è¾¹ç¼˜kuberneteså‘è¡Œç‰ˆ)
    - [4.1 K0s](#41-k0s)
    - [4.2 MicroK8s](#42-microk8s)
    - [4.3 OpenYurt](#43-openyurt)
  - [5. è¾¹ç¼˜å­˜å‚¨æ–¹æ¡ˆ](#5-è¾¹ç¼˜å­˜å‚¨æ–¹æ¡ˆ)
    - [5.1 æœ¬åœ°å­˜å‚¨](#51-æœ¬åœ°å­˜å‚¨)
    - [5.2 è¾¹ç¼˜åˆ†å¸ƒå¼å­˜å‚¨](#52-è¾¹ç¼˜åˆ†å¸ƒå¼å­˜å‚¨)
  - [6. è¾¹ç¼˜ç½‘ç»œæ–¹æ¡ˆ](#6-è¾¹ç¼˜ç½‘ç»œæ–¹æ¡ˆ)
    - [6.1 äº‘è¾¹éš§é“](#61-äº‘è¾¹éš§é“)
    - [6.2 Service Mesh at Edge](#62-service-mesh-at-edge)
  - [7. è¾¹ç¼˜AIæ¨ç†](#7-è¾¹ç¼˜aiæ¨ç†)
    - [7.1 æ¨¡å‹ä¼˜åŒ–](#71-æ¨¡å‹ä¼˜åŒ–)
    - [7.2 æ¨ç†å¼•æ“å¯¹æ¯”](#72-æ¨ç†å¼•æ“å¯¹æ¯”)
    - [7.3 è¾¹ç¼˜AIéƒ¨ç½²å®æˆ˜](#73-è¾¹ç¼˜aiéƒ¨ç½²å®æˆ˜)
  - [8. 5G MECé›†æˆ](#8-5g-mecé›†æˆ)
    - [8.1 MECæ¶æ„](#81-mecæ¶æ„)
    - [8.2 MECéƒ¨ç½²](#82-mecéƒ¨ç½²)
  - [9. è¾¹ç¼˜å®‰å…¨](#9-è¾¹ç¼˜å®‰å…¨)
    - [9.1 é›¶ä¿¡ä»»è¾¹ç¼˜](#91-é›¶ä¿¡ä»»è¾¹ç¼˜)
    - [9.2 è¾¹ç¼˜è®¾å¤‡è®¤è¯](#92-è¾¹ç¼˜è®¾å¤‡è®¤è¯)
  - [10. ç›‘æ§ä¸è¿ç»´](#10-ç›‘æ§ä¸è¿ç»´)
    - [10.1 è¾¹ç¼˜ç›‘æ§æ–¹æ¡ˆ](#101-è¾¹ç¼˜ç›‘æ§æ–¹æ¡ˆ)
    - [10.2 æ•…éšœæ’æŸ¥](#102-æ•…éšœæ’æŸ¥)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [å¼€æºé¡¹ç›®](#å¼€æºé¡¹ç›®)

---

## 1. è¾¹ç¼˜è®¡ç®—æ¦‚è¿°

### 1.1 è¾¹ç¼˜è®¡ç®—å®šä¹‰ä¸æ¼”è¿›

**è¾¹ç¼˜è®¡ç®—** (Edge Computing) æ˜¯ä¸€ç§åˆ†å¸ƒå¼è®¡ç®—èŒƒå¼ï¼Œå°†æ•°æ®å¤„ç†ã€å­˜å‚¨å’Œåº”ç”¨ç¨‹åºä»ä¸­å¿ƒåŒ–çš„æ•°æ®ä¸­å¿ƒç§»è‡³ç½‘ç»œè¾¹ç¼˜ï¼Œæ›´é è¿‘æ•°æ®æºå’Œç”¨æˆ·ã€‚

#### è¾¹ç¼˜è®¡ç®—å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   äº‘ç«¯æ•°æ®ä¸­å¿ƒ                        â”‚
â”‚  - é›†ä¸­å¼è®­ç»ƒ                                        â”‚
â”‚  - å¤§æ•°æ®åˆ†æ                                        â”‚
â”‚  - é›†ä¸­ç®¡ç†                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ (Internet / WAN)
                  â”‚ å»¶è¿Ÿ: 50-200ms
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŒºåŸŸè¾¹ç¼˜ (Edge)                     â”‚
â”‚  - K3s / KubeEdge                                    â”‚
â”‚  - è¾¹ç¼˜AIæ¨ç†                                        â”‚
â”‚  - æœ¬åœ°æ•°æ®å¤„ç†                                      â”‚
â”‚  å»¶è¿Ÿ: 5-20ms                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ (5G / å±€åŸŸç½‘)
                  â”‚ å»¶è¿Ÿ: 1-5ms
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç»ˆç«¯è®¾å¤‡ (Far Edge)                 â”‚
â”‚  - IoTè®¾å¤‡                                           â”‚
â”‚  - æ™ºèƒ½æ‘„åƒå¤´                                        â”‚
â”‚  - å·¥ä¸šä¼ æ„Ÿå™¨                                        â”‚
â”‚  - è‡ªåŠ¨é©¾é©¶è½¦è¾†                                      â”‚
â”‚  å»¶è¿Ÿ: <1ms                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ¼”è¿›å†ç¨‹

```
2015å¹´å‰: äº‘è®¡ç®—æ—¶ä»£
â”œâ”€â”€ æ‰€æœ‰è®¡ç®—é›†ä¸­åœ¨æ•°æ®ä¸­å¿ƒ
â”œâ”€â”€ é«˜å»¶è¿Ÿ (100-200ms)
â””â”€â”€ å¸¦å®½æˆæœ¬é«˜

2016-2019å¹´: è¾¹ç¼˜è®¡ç®—å…´èµ·
â”œâ”€â”€ CDNè¾¹ç¼˜èŠ‚ç‚¹æ‰©å±•
â”œâ”€â”€ é›¾è®¡ç®— (Fog Computing)
â”œâ”€â”€ IoTè®¾å¤‡çˆ†å‘å¼å¢é•¿
â””â”€â”€ K3sé¦–æ¬¡å‘å¸ƒ (2019)

2020-2023å¹´: è¾¹ç¼˜Kubernetesæˆç†Ÿ
â”œâ”€â”€ KubeEdge GA (2020)
â”œâ”€â”€ 5G MECå•†ç”¨
â”œâ”€â”€ è¾¹ç¼˜AIæ¨ç†æ™®åŠ
â””â”€â”€ WebAssemblyè¾¹ç¼˜è¿è¡Œæ—¶

2025å¹´ (å½“å‰):
â”œâ”€â”€ äº‘è¾¹ç«¯ä¸€ä½“åŒ–
â”œâ”€â”€ è¾¹ç¼˜åŸç”Ÿåº”ç”¨
â”œâ”€â”€ 5G-A / 6Gå‡†å¤‡
â”œâ”€â”€ è¾¹ç¼˜AIå¤§æ¨¡å‹
â””â”€â”€ è‡ªä¸»è¾¹ç¼˜ç½‘ç»œ
```

### 1.2 è¾¹ç¼˜è®¡ç®— vs äº‘è®¡ç®—

| ç‰¹æ€§ | äº‘è®¡ç®— | è¾¹ç¼˜è®¡ç®— | ä¼˜åŠ¿ |
|------|--------|---------|------|
| **å»¶è¿Ÿ** | 50-200ms | 1-10ms | âš¡ å®æ—¶å“åº” |
| **å¸¦å®½** | é«˜ (ä¾èµ–Internet) | ä½ (æœ¬åœ°å¤„ç†) | ğŸ’° é™ä½æˆæœ¬60-80% |
| **éšç§** | æ•°æ®ä¸Šä¼ äº‘ç«¯ | æ•°æ®æœ¬åœ°å¤„ç† | ğŸ”’ éšç§ä¿æŠ¤ |
| **å¯ç”¨æ€§** | ä¾èµ–ç½‘ç»œ | æ–­ç½‘å¯è‡ªæ²» | ğŸ›¡ï¸ 99.9%+ |
| **è®¡ç®—èƒ½åŠ›** | æ— é™å¼¹æ€§ | å—é™äºè¾¹ç¼˜ç¡¬ä»¶ | ğŸ“Š æŒ‰éœ€é€‰æ‹© |
| **é€‚ç”¨åœºæ™¯** | å¤§æ•°æ®åˆ†æã€è®­ç»ƒ | å®æ—¶æ§åˆ¶ã€æ¨ç† | ğŸ¯ äº’è¡¥ |

### 1.3 è¾¹ç¼˜è®¡ç®—åº”ç”¨åœºæ™¯

```yaml
å·¥ä¸šåˆ¶é€ :
  - è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤
  - è´¨é‡æ£€æµ‹ (è®¡ç®—æœºè§†è§‰)
  - äº§çº¿å®æ—¶ä¼˜åŒ–
  - AGVè‡ªä¸»å¯¼èˆª
  æ¡ˆä¾‹: å‰åˆ©æ±½è½¦å·¥å‚ (K3s + è¾¹ç¼˜AI)

æ™ºæ…§åŸå¸‚:
  - æ™ºèƒ½äº¤é€š (ä¿¡å·ç¯ä¼˜åŒ–)
  - è§†é¢‘ç›‘æ§åˆ†æ
  - ç¯å¢ƒç›‘æµ‹
  - åº”æ€¥å“åº”
  æ¡ˆä¾‹: æ·±åœ³æ™ºæ…§äº¤é€š (KubeEdge + 5G MEC)

è‡ªåŠ¨é©¾é©¶:
  - å®æ—¶è·¯å¾„è§„åˆ’ (<10mså»¶è¿Ÿ)
  - éšœç¢ç‰©æ£€æµ‹
  - V2Xé€šä¿¡
  - é«˜ç²¾åº¦å®šä½
  æ¡ˆä¾‹: ç™¾åº¦Apollo (è¾¹ç¼˜è®¡ç®—å•å…ƒ)

æ™ºæ…§é›¶å”®:
  - äººè„¸è¯†åˆ«æ”¯ä»˜
  - æ™ºèƒ½è´§æ¶
  - å®¢æµåˆ†æ
  - åº“å­˜ä¼˜åŒ–
  æ¡ˆä¾‹: é˜¿é‡Œç›’é©¬ (è¾¹ç¼˜è§†è§‰AI)

åŒ»ç–—å¥åº·:
  - è¿œç¨‹æ‰‹æœ¯ (è¶…ä½å»¶è¿Ÿ)
  - åŒ»ç–—å½±åƒåˆ†æ
  - å®æ—¶ç›‘æŠ¤
  - è¯ç‰©é…é€æœºå™¨äºº
  æ¡ˆä¾‹: 301åŒ»é™¢5Gè¿œç¨‹æ‰‹æœ¯

èƒ½æºç”µåŠ›:
  - æ™ºèƒ½ç”µç½‘
  - é£ç”µ/å…‰ä¼ä¼˜åŒ–
  - é…ç”µè‡ªåŠ¨åŒ–
  - å‚¨èƒ½è°ƒåº¦
  æ¡ˆä¾‹: å›½å®¶ç”µç½‘è¾¹ç¼˜è®¡ç®—å¹³å°
```

---

## 2. K3sè½»é‡çº§Kubernetes

### 2.1 K3sæ¶æ„

**K3s** æ˜¯ç”±Rancher Labs (ç°SUSE) å¼€å‘çš„è½»é‡çº§Kuberneteså‘è¡Œç‰ˆï¼Œä¸“ä¸ºè¾¹ç¼˜ã€IoTå’Œèµ„æºå—é™ç¯å¢ƒè®¾è®¡ã€‚

```
K3sæ¶æ„ç®€åŒ–:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            K3s Server (æ§åˆ¶å¹³é¢)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å•äºŒè¿›åˆ¶æ–‡ä»¶ (~70MB)                         â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ API Server â”‚  â”‚  Scheduler â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Controller â”‚  â”‚   etcd/    â”‚            â”‚
â”‚  â”‚  Manager   â”‚  â”‚  SQLite    â”‚ (åµŒå…¥å¼DB) â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Flannel   â”‚  â”‚CoreDNS/    â”‚            â”‚
â”‚  â”‚   (CNI)    â”‚  â”‚ Traefik    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (é€šè¿‡Tunnelä»£ç†æˆ–ç›´æ¥è¿æ¥)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           K3s Agent (å·¥ä½œèŠ‚ç‚¹)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  kubelet   â”‚  â”‚  containerdâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚  Flannel   â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**K3s vs K8så¯¹æ¯”**:

| ç‰¹æ€§ | K8s | K3s | æ”¹è¿› |
|------|-----|-----|------|
| **äºŒè¿›åˆ¶å¤§å°** | ~1.5GB+ | ~70MB | å‡å°‘95% |
| **å†…å­˜å ç”¨** | ~1.5GB | ~512MB | å‡å°‘66% |
| **å­˜å‚¨åç«¯** | etcd | SQLite/MySQL/etcd | å¯é€‰è½»é‡çº§ |
| **å®‰è£…å¤æ‚åº¦** | é«˜ (kubeadm) | ä½ (å•å‘½ä»¤) | âš¡ æç®€ |
| **é»˜è®¤ç»„ä»¶** | éœ€æ‰‹åŠ¨å®‰è£… | å†…ç½®(Traefik,CoreDNS) | ğŸ“¦ å¼€ç®±å³ç”¨ |

### 2.2 K3så®‰è£…ä¸é…ç½®

#### å•èŠ‚ç‚¹å®‰è£…

```bash
# 1. å®‰è£…K3s Server (å•èŠ‚ç‚¹All-in-One)
curl -sfL https://get.k3s.io | sh -

# 2. æŸ¥çœ‹çŠ¶æ€
sudo systemctl status k3s

# 3. è·å–kubeconfig
sudo cat /etc/rancher/k3s/k3s.yaml > ~/.kube/config
export KUBECONFIG=~/.kube/config

# 4. éªŒè¯
kubectl get nodes
# NAME          STATUS   ROLES                  AGE   VERSION
# edge-node-1   Ready    control-plane,master   1m    v1.31.0+k3s1

kubectl get pods -A
# NAMESPACE     NAME                                     READY   STATUS    RESTARTS   AGE
# kube-system   coredns-xxx                              1/1     Running   0          1m
# kube-system   local-path-provisioner-xxx               1/1     Running   0          1m
# kube-system   metrics-server-xxx                       1/1     Running   0          1m
# kube-system   traefik-xxx                              1/1     Running   0          1m
```

#### é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²

```bash
#!/bin/bash
# ha-k3s-install.sh - K3sé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²

# ç¯å¢ƒå‡†å¤‡
MASTER1=192.168.1.10
MASTER2=192.168.1.11
MASTER3=192.168.1.12
WORKER1=192.168.1.20
WORKER2=192.168.1.21

# 1. éƒ¨ç½²å¤–éƒ¨etcdé›†ç¾¤ (å¯é€‰,ä¹Ÿå¯ä½¿ç”¨åµŒå…¥å¼etcd)
# è¿™é‡Œä½¿ç”¨K3så†…ç½®çš„åµŒå…¥å¼etcd (dqlite)

# 2. å®‰è£…ç¬¬ä¸€ä¸ªMasterèŠ‚ç‚¹
ssh root@$MASTER1 << 'EOF'
curl -sfL https://get.k3s.io | sh -s - server \
  --cluster-init \
  --tls-san 192.168.1.100 \
  --tls-san k3s.example.com \
  --write-kubeconfig-mode 644 \
  --disable traefik \
  --disable servicelb

# è·å–Token
cat /var/lib/rancher/k3s/server/node-token
EOF

# ä¿å­˜Token
TOKEN=$(ssh root@$MASTER1 cat /var/lib/rancher/k3s/server/node-token)

# 3. åŠ å…¥ç¬¬äºŒä¸ªMasterèŠ‚ç‚¹
ssh root@$MASTER2 << EOF
curl -sfL https://get.k3s.io | sh -s - server \
  --server https://$MASTER1:6443 \
  --token $TOKEN \
  --tls-san 192.168.1.100 \
  --write-kubeconfig-mode 644
EOF

# 4. åŠ å…¥ç¬¬ä¸‰ä¸ªMasterèŠ‚ç‚¹
ssh root@$MASTER3 << EOF
curl -sfL https://get.k3s.io | sh -s - server \
  --server https://$MASTER1:6443 \
  --token $TOKEN \
  --tls-san 192.168.1.100 \
  --write-kubeconfig-mode 644
EOF

# 5. åŠ å…¥WorkerèŠ‚ç‚¹
for WORKER in $WORKER1 $WORKER2; do
  ssh root@$WORKER << EOF
curl -sfL https://get.k3s.io | K3S_URL=https://$MASTER1:6443 K3S_TOKEN=$TOKEN sh -
EOF
done

# 6. éªŒè¯é›†ç¾¤
kubectl get nodes
# NAME          STATUS   ROLES                       AGE   VERSION
# master-1      Ready    control-plane,master,etcd   5m    v1.31.0+k3s1
# master-2      Ready    control-plane,master,etcd   4m    v1.31.0+k3s1
# master-3      Ready    control-plane,master,etcd   3m    v1.31.0+k3s1
# worker-1      Ready    <none>                      2m    v1.31.0+k3s1
# worker-2      Ready    <none>                      1m    v1.31.0+k3s1
```

### 2.3 K3sè¾¹ç¼˜åœºæ™¯ä¼˜åŒ–

#### èµ„æºé™åˆ¶é…ç½®

```yaml
# k3s-config.yaml - K3sä½èµ„æºé…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: k3s-config
  namespace: kube-system
data:
  config.yaml: |
    # æœ€å°åŒ–å†…å­˜å ç”¨
    kubelet-arg:
    - "max-pods=30"  # é™åˆ¶Podæ•°é‡
    - "kube-api-qps=50"  # é™åˆ¶APIè¯·æ±‚é€Ÿç‡
    - "kube-api-burst=100"
    - "image-gc-high-threshold=70"  # é•œåƒå›æ”¶
    - "image-gc-low-threshold=50"
    - "eviction-hard=memory.available<100Mi,nodefs.available<5%"
    
    # ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
    disable:
    - servicelb  # å¦‚æœä¸éœ€è¦LoadBalancer
    - traefik    # ä½¿ç”¨Nginx Ingressæ›¿ä»£
    - metrics-server  # è¾¹ç¼˜èŠ‚ç‚¹å¯é€‰
```

```bash
# ä½¿ç”¨é…ç½®å¯åŠ¨K3s
curl -sfL https://get.k3s.io | sh -s - server \
  --config /etc/rancher/k3s/config.yaml \
  --data-dir /data/k3s \
  --kubelet-arg "max-pods=30" \
  --kubelet-arg "eviction-hard=memory.available<200Mi"
```

#### ç¦»çº¿éƒ¨ç½²

```bash
#!/bin/bash
# k3s-airgap-install.sh - K3sç¦»çº¿å®‰è£…

# 1. ä¸‹è½½K3säºŒè¿›åˆ¶ (åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Š)
wget https://github.com/k3s-io/k3s/releases/download/v1.31.0%2Bk3s1/k3s
wget https://github.com/k3s-io/k3s/releases/download/v1.31.0%2Bk3s1/k3s-airgap-images-amd64.tar.gz

# 2. ä¼ è¾“åˆ°ç¦»çº¿ç¯å¢ƒ
scp k3s root@edge-node:/usr/local/bin/
scp k3s-airgap-images-amd64.tar.gz root@edge-node:/var/lib/rancher/k3s/agent/images/

# 3. åœ¨ç¦»çº¿èŠ‚ç‚¹å®‰è£…
ssh root@edge-node << 'EOF'
chmod +x /usr/local/bin/k3s

# åˆ›å»ºsystemdæœåŠ¡
cat > /etc/systemd/system/k3s.service << 'UNIT'
[Unit]
Description=Lightweight Kubernetes
After=network-online.target

[Service]
Type=notify
EnvironmentFile=-/etc/systemd/system/k3s.service.env
ExecStartPre=/bin/sh -xc '! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service'
ExecStart=/usr/local/bin/k3s server
KillMode=process
Delegate=yes
LimitNOFILE=1048576
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
TimeoutStartSec=0
Restart=always
RestartSec=5s

[Install]
WantedBy=multi-user.target
UNIT

# å¯åŠ¨
systemctl daemon-reload
systemctl enable k3s
systemctl start k3s
EOF
```

---

## 3. KubeEdgeäº‘è¾¹ååŒ

### 3.1 KubeEdgeæ¶æ„

**KubeEdge** æ˜¯ç”±åä¸ºäº‘å¼€æºã€CNCFæ‰˜ç®¡çš„äº‘åŸç”Ÿè¾¹ç¼˜è®¡ç®—æ¡†æ¶ï¼Œæ‰©å±•Kubernetesåˆ°è¾¹ç¼˜ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  äº‘ç«¯ (Kubernetesé›†ç¾¤)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Kubernetes    â”‚        â”‚   CloudCore    â”‚         â”‚
â”‚  â”‚  Control Plane â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚  (KubeEdge)    â”‚         â”‚
â”‚  â”‚                â”‚        â”‚                â”‚         â”‚
â”‚  â”‚  - API Server  â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚  - Controller  â”‚        â”‚  â”‚CloudHub  â”‚  â”‚         â”‚
â”‚  â”‚  - Scheduler   â”‚        â”‚  â”‚EdgeCtrl  â”‚  â”‚         â”‚
â”‚  â”‚  - etcd        â”‚        â”‚  â”‚DeviceCtrlâ”‚  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ (WebSocket/QUIC)
                                       â”‚ äº‘è¾¹éš§é“ (åŒå‘æ¶ˆæ¯)
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¾¹ç¼˜èŠ‚ç‚¹ (EdgeCore)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   EdgeCore                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚ EdgeHub  â”‚  â”‚  MetaMgr â”‚  â”‚ DeviceTwinâ”‚       â”‚ â”‚
â”‚  â”‚  â”‚(äº‘è¾¹é€šä¿¡) â”‚  â”‚(å…ƒæ•°æ®)   â”‚  â”‚(è®¾å¤‡å½±å­) â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚  Edged   â”‚  â”‚EventBus  â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚(è½»é‡çº§   â”‚  â”‚(MQTT)    â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚ kubelet) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                                â”‚
â”‚                       â”‚ (MQTT/Modbus/OPC-UA)          â”‚
â”‚                       â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ æ¸©åº¦   â”‚  â”‚ æ‘„åƒ   â”‚  â”‚ PLC    â”‚  â”‚ æœºå™¨äºº â”‚     â”‚
â”‚  â”‚ ä¼ æ„Ÿå™¨ â”‚  â”‚ å¤´     â”‚  â”‚        â”‚  â”‚        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹æ€§**:

```yaml
äº‘è¾¹ååŒ:
  - äº‘ç«¯ç»Ÿä¸€ç®¡ç†
  - è¾¹ç¼˜è‡ªæ²» (æ–­ç½‘å¯ç”¨)
  - äº‘è¾¹æ¶ˆæ¯å¯é ä¼ è¾“

è®¾å¤‡ç®¡ç†:
  - è®¾å¤‡æ¨¡å‹æŠ½è±¡ (DMI)
  - è®¾å¤‡æ•°å­—å­ªç”Ÿ (Device Twin)
  - å¤šåè®®æ”¯æŒ (MQTT/Modbus/OPC-UA)

è½»é‡é«˜æ•ˆ:
  - å†…å­˜å ç”¨ ~70MB
  - æ”¯æŒARM/x86
  - å¼±ç½‘ä¼˜åŒ– (WebSocket/QUIC)

å®‰å…¨æ€§:
  - è¯ä¹¦åŒå‘è®¤è¯
  - æ•°æ®åŠ å¯†ä¼ è¾“
  - è¾¹ç¼˜èµ„æºéš”ç¦»
```

### 3.2 KubeEdgeéƒ¨ç½²

#### äº‘ç«¯éƒ¨ç½² (CloudCore)

```bash
#!/bin/bash
# kubeedge-cloud-install.sh

# 1. å‰æ: å·²æœ‰Kubernetesé›†ç¾¤ (v1.26+)

# 2. å®‰è£…keadmå·¥å…·
VERSION=v1.18.0
wget https://github.com/kubeedge/kubeedge/releases/download/$VERSION/keadm-$VERSION-linux-amd64.tar.gz
tar -zxf keadm-$VERSION-linux-amd64.tar.gz
sudo cp keadm-$VERSION-linux-amd64/keadm/keadm /usr/local/bin/

# 3. åˆå§‹åŒ–CloudCore
keadm init --advertise-address="192.168.1.10" --kubeedge-version=$VERSION

# 4. éªŒè¯CloudCoreè¿è¡Œ
kubectl get pods -n kubeedge
# NAME                         READY   STATUS    RESTARTS   AGE
# cloudcore-xxx                1/1     Running   0          1m

# 5. è·å–è¾¹ç¼˜èŠ‚ç‚¹åŠ å…¥Token
keadm gettoken
# è¾“å‡º: ç±»ä¼¼ "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

#### è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½² (EdgeCore)

```bash
#!/bin/bash
# kubeedge-edge-install.sh (åœ¨è¾¹ç¼˜èŠ‚ç‚¹æ‰§è¡Œ)

# 1. å®‰è£…keadm
VERSION=v1.18.0
wget https://github.com/kubeedge/kubeedge/releases/download/$VERSION/keadm-$VERSION-linux-amd64.tar.gz
tar -zxf keadm-$VERSION-linux-amd64.tar.gz
sudo cp keadm-$VERSION-linux-amd64/keadm/keadm /usr/local/bin/

# 2. åŠ å…¥è¾¹ç¼˜é›†ç¾¤
CLOUDCORE_IP=192.168.1.10
TOKEN="<ä»äº‘ç«¯è·å–çš„Token>"

keadm join \
  --cloudcore-ipport=$CLOUDCORE_IP:10000 \
  --token=$TOKEN \
  --kubeedge-version=$VERSION \
  --cgroupdriver=systemd \
  --remote-runtime-endpoint=unix:///var/run/containerd/containerd.sock

# 3. éªŒè¯EdgeCoreè¿è¡Œ
systemctl status edgecore

# 4. åœ¨äº‘ç«¯éªŒè¯è¾¹ç¼˜èŠ‚ç‚¹
# (åœ¨äº‘ç«¯Kubernetesé›†ç¾¤æ‰§è¡Œ)
kubectl get nodes
# NAME          STATUS   ROLES        AGE   VERSION
# edge-node-1   Ready    agent,edge   1m    v1.31.0-kubeedge-v1.18.0
```

### 3.3 è®¾å¤‡ç®¡ç†ä¸è¾¹ç¼˜è‡ªæ²»

#### è®¾å¤‡æ¨¡å‹å®šä¹‰

```yaml
# device-model.yaml - æ¸©åº¦ä¼ æ„Ÿå™¨è®¾å¤‡æ¨¡å‹
apiVersion: devices.kubeedge.io/v1beta1
kind: DeviceModel
metadata:
  name: temperature-sensor-model
  namespace: default
spec:
  properties:
  - name: temperature
    description: "Current temperature"
    type:
      string:
        accessMode: ReadOnly
        defaultValue: "0"
  - name: unit
    description: "Temperature unit (C/F)"
    type:
      string:
        accessMode: ReadWrite
        defaultValue: "C"

---
# device-instance.yaml - è®¾å¤‡å®ä¾‹
apiVersion: devices.kubeedge.io/v1beta1
kind: Device
metadata:
  name: temp-sensor-01
  namespace: default
  labels:
    location: "factory-floor-1"
    type: "temperature"
spec:
  deviceModelRef:
    name: temperature-sensor-model
  protocol:
    modbus:
      rtu:
        serialPort: "/dev/ttyUSB0"
        baudRate: 9600
        dataBits: 8
        parity: "none"
        stopBits: 1
        slaveID: 1
  propertyVisitors:
  - propertyName: temperature
    modbus:
      register: "HoldingRegister"
      offset: 2
      limit: 1
      scale: 0.1
  status:
    twins:
    - propertyName: temperature
      desired:
        metadata:
          type: string
        value: ""
      reported:
        metadata:
          type: string
        value: ""
        timestamp: 0

---
# app-deployment.yaml - åº”ç”¨è¯»å–è®¾å¤‡æ•°æ®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: temp-monitor
spec:
  replicas: 1
  selector:
    matchLabels:
      app: temp-monitor
  template:
    metadata:
      labels:
        app: temp-monitor
    spec:
      nodeSelector:
        node-role.kubernetes.io/edge: ""
      containers:
      - name: monitor
        image: monitor:v1
        volumeMounts:
        - name: device-twin
          mountPath: /var/lib/kubeedge/device
      volumes:
      - name: device-twin
        hostPath:
          path: /var/lib/kubeedge/device/
          type: Directory
```

#### è¾¹ç¼˜è‡ªæ²»æµ‹è¯•

```bash
#!/bin/bash
# test-edge-autonomy.sh - æµ‹è¯•è¾¹ç¼˜è‡ªæ²»èƒ½åŠ›

# 1. éƒ¨ç½²æµ‹è¯•åº”ç”¨åˆ°è¾¹ç¼˜èŠ‚ç‚¹
kubectl apply -f - <<EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: edge-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: edge-app
  template:
    metadata:
      labels:
        app: edge-app
    spec:
      nodeSelector:
        node-role.kubernetes.io/edge: ""
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
EOF

# 2. éªŒè¯åº”ç”¨è¿è¡Œ
kubectl get pods -o wide
# NAME                        READY   STATUS    NODE          AGE
# edge-app-xxx                1/1     Running   edge-node-1   1m

# 3. æ¨¡æ‹Ÿäº‘è¾¹ç½‘ç»œä¸­æ–­
# (åœ¨CloudCoreèŠ‚ç‚¹æ‰§è¡Œ)
sudo iptables -A OUTPUT -d <EDGE_NODE_IP> -j DROP

# 4. è§‚å¯Ÿè¾¹ç¼˜èŠ‚ç‚¹çŠ¶æ€
kubectl get nodes
# NAME          STATUS     ROLES        AGE   VERSION
# edge-node-1   NotReady   agent,edge   5m    v1.31.0-kubeedge-v1.18.0

# 5. åœ¨è¾¹ç¼˜èŠ‚ç‚¹éªŒè¯åº”ç”¨ä»åœ¨è¿è¡Œ (è¾¹ç¼˜è‡ªæ²»)
# (åœ¨è¾¹ç¼˜èŠ‚ç‚¹æ‰§è¡Œ)
docker ps | grep edge-app
# edge-appå®¹å™¨ä»åœ¨è¿è¡Œ,ä¸šåŠ¡ä¸å—å½±å“!

# 6. æµ‹è¯•è¾¹ç¼˜èŠ‚ç‚¹è‡ªä¸»é‡å¯Pod
docker stop <edge-app-container-id>
# Edgedä¼šè‡ªåŠ¨é‡å¯å®¹å™¨

# 7. æ¢å¤äº‘è¾¹ç½‘ç»œ
sudo iptables -D OUTPUT -d <EDGE_NODE_IP> -j DROP

# 8. éªŒè¯çŠ¶æ€åŒæ­¥
kubectl get pods
# è¾¹ç¼˜PodçŠ¶æ€ä¼šåŒæ­¥å›äº‘ç«¯
```

---

## 4. å…¶ä»–è¾¹ç¼˜Kuberneteså‘è¡Œç‰ˆ

### 4.1 K0s

```yaml
ç‰¹ç‚¹:
  - CNCFæ²™ç®±é¡¹ç›®
  - å•äºŒè¿›åˆ¶,é›¶ä¾èµ–
  - æ”¯æŒå¤šç§å­˜å‚¨åç«¯ (etcd/kine)
  - å†…ç½®è‡ªåŠ¨æ›´æ–°

å¿«é€Ÿå®‰è£…:
  curl -sSLf https://get.k0s.sh | sudo sh
  sudo k0s install controller --single
  sudo k0s start

é€‚ç”¨åœºæ™¯:
  - è¾¹ç¼˜Kuberneteså³æœåŠ¡
  - å¤šç§Ÿæˆ·è¾¹ç¼˜é›†ç¾¤
  - éœ€è¦é«˜åº¦è‡ªåŠ¨åŒ–
```

### 4.2 MicroK8s

```yaml
ç‰¹ç‚¹:
  - Canonical (Ubuntu) å‡ºå“
  - SnapåŒ…ç®¡ç†
  - æ’ä»¶ç”Ÿæ€ä¸°å¯Œ
  - GPUæ”¯æŒå¥½

å¿«é€Ÿå®‰è£…:
  sudo snap install microk8s --classic
  sudo microk8s enable dns dashboard storage

é€‚ç”¨åœºæ™¯:
  - Ubuntuç¯å¢ƒ
  - éœ€è¦GPU (NVIDIA)
  - å¼€å‘æµ‹è¯•
```

### 4.3 OpenYurt

```yaml
ç‰¹ç‚¹:
  - é˜¿é‡Œäº‘å¼€æº
  - æ— ä¾µå…¥å¼ (å¯è½¬æ¢ç°æœ‰K8s)
  - äº‘è¾¹ç«¯ä¸‰å±‚æ¶æ„
  - YurtHubæœ¬åœ°ç¼“å­˜

è½¬æ¢ç°æœ‰é›†ç¾¤:
  yurtctl convert --cloud-nodes master-node \
                  --edge-nodes edge-node-1,edge-node-2

é€‚ç”¨åœºæ™¯:
  - å·²æœ‰K8sé›†ç¾¤æ‰©å±•åˆ°è¾¹ç¼˜
  - éœ€è¦å¹³æ»‘è¿ç§»
  - äº‘è¾¹ç«¯ä¸€ä½“åŒ–
```

---

## 5. è¾¹ç¼˜å­˜å‚¨æ–¹æ¡ˆ

### 5.1 æœ¬åœ°å­˜å‚¨

```yaml
# local-path-storageclass.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete

---
# ä½¿ç”¨æœ¬åœ°å­˜å‚¨
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: edge-data-pvc
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: local-path
  resources:
    requests:
      storage: 10Gi
```

### 5.2 è¾¹ç¼˜åˆ†å¸ƒå¼å­˜å‚¨

```yaml
# Longhorn (è½»é‡çº§åˆ†å¸ƒå¼å­˜å‚¨)
# å®‰è£…
helm repo add longhorn https://charts.longhorn.io
helm install longhorn longhorn/longhorn \
  --namespace longhorn-system \
  --create-namespace \
  --set persistence.defaultClass=true \
  --set defaultSettings.replicaCount=2

# Rook-Ceph (ç”Ÿäº§çº§)
# (è§"äº‘åŸç”Ÿå­˜å‚¨æŠ€æœ¯æŒ‡å—2025.md")
```

---

## 6. è¾¹ç¼˜ç½‘ç»œæ–¹æ¡ˆ

### 6.1 äº‘è¾¹éš§é“

```yaml
# K3så†…ç½®Tunnelä»£ç†
# ServerèŠ‚ç‚¹
k3s server --node-external-ip=<PUBLIC_IP>

# AgentèŠ‚ç‚¹ (æ— éœ€å…¬ç½‘IP)
K3S_URL=https://<SERVER_IP>:6443 K3S_TOKEN=<TOKEN> k3s agent

# åŸç†: Agenté€šè¿‡WebSocketè¿æ¥Server,Serveråå‘ä»£ç†åˆ°Agent
```

### 6.2 Service Mesh at Edge

```yaml
# Linkerdè½»é‡çº§Service Mesh (é€‚åˆè¾¹ç¼˜)
linkerd install --crds | kubectl apply -f -
linkerd install | kubectl apply -f -
linkerd check

# ä¸ºè¾¹ç¼˜åº”ç”¨æ³¨å…¥sidecar
kubectl annotate namespace default linkerd.io/inject=enabled
```

---

## 7. è¾¹ç¼˜AIæ¨ç†

### 7.1 æ¨¡å‹ä¼˜åŒ–

```python
# model-optimization.py - è¾¹ç¼˜æ¨¡å‹ä¼˜åŒ–

import torch
import torch.onnx
import onnxruntime as ort

# 1. PyTorchæ¨¡å‹å¯¼å‡ºä¸ºONNX
model = torch.load('model.pth')
model.eval()

dummy_input = torch.randn(1, 3, 224, 224)
torch.onnx.export(
    model,
    dummy_input,
    "model.onnx",
    opset_version=13,
    input_names=['input'],
    output_names=['output'],
    dynamic_axes={'input': {0: 'batch_size'}, 'output': {0: 'batch_size'}}
)

# 2. ONNXé‡åŒ– (INT8)
from onnxruntime.quantization import quantize_dynamic, QuantType

quantize_dynamic(
    "model.onnx",
    "model_int8.onnx",
    weight_type=QuantType.QInt8
)

# æ¨¡å‹å¤§å°å¯¹æ¯”
# model.onnx: 100MB
# model_int8.onnx: 25MB (å‡å°‘75%)

# 3. æ¨ç†é€Ÿåº¦æµ‹è¯•
session = ort.InferenceSession("model_int8.onnx")
input_name = session.get_inputs()[0].name

import time
start = time.time()
for _ in range(100):
    output = session.run(None, {input_name: dummy_input.numpy()})
end = time.time()

print(f"Average inference time: {(end-start)/100*1000:.2f}ms")
# å…¸å‹ç»“æœ: ä» 50ms é™ä½åˆ° 12ms (4å€æå‡)
```

### 7.2 æ¨ç†å¼•æ“å¯¹æ¯”

| å¼•æ“ | å‚å•† | æ”¯æŒç¡¬ä»¶ | æ€§èƒ½ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|------|---------|---------|
| **ONNX Runtime** | å¾®è½¯ | CPU/GPU/NPU | â­â­â­â­ | ä½ | é€šç”¨ |
| **TensorRT** | NVIDIA | NVIDIA GPU | â­â­â­â­â­ | ä¸­ | NVIDIAç”Ÿæ€ |
| **OpenVINO** | Intel | Intel CPU/GPU/VPU | â­â­â­â­ | ä¸­ | Intelç¡¬ä»¶ |
| **TFLite** | Google | ARM/CPU | â­â­â­ | æä½ | ç§»åŠ¨ç«¯/IoT |
| **NCNN** | è…¾è®¯ | ARM/CPU | â­â­â­â­ | ä½ | ç§»åŠ¨ç«¯ |
| **MNN** | é˜¿é‡Œ | ARM/CPU/GPU | â­â­â­â­ | ä½ | ç§»åŠ¨ç«¯ |

### 7.3 è¾¹ç¼˜AIéƒ¨ç½²å®æˆ˜

```yaml
# edge-ai-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: object-detection
spec:
  replicas: 2
  selector:
    matchLabels:
      app: object-detection
  template:
    metadata:
      labels:
        app: object-detection
    spec:
      nodeSelector:
        node-role.kubernetes.io/edge: ""
        accelerator: nvidia-jetson  # æŒ‡å®šè¾¹ç¼˜AIç¡¬ä»¶
      containers:
      - name: detector
        image: object-detector:v1
        resources:
          limits:
            nvidia.com/gpu: 1  # ä½¿ç”¨è¾¹ç¼˜GPU
            memory: "2Gi"
          requests:
            memory: "1Gi"
        env:
        - name: MODEL_PATH
          value: "/models/yolov8_int8.onnx"
        - name: INPUT_SOURCE
          value: "rtsp://camera.local/stream"
        - name: INFERENCE_DEVICE
          value: "CUDA"  # æˆ– CPU/TensorRT
        volumeMounts:
        - name: models
          mountPath: /models
        - name: results
          mountPath: /results
      volumes:
      - name: models
        persistentVolumeClaim:
          claimName: model-storage-pvc
      - name: results
        hostPath:
          path: /data/ai-results
          type: DirectoryOrCreate

---
# hpa-edge-ai.yaml - è¾¹ç¼˜AIè‡ªåŠ¨æ‰©ç¼©å®¹
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: object-detection-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: object-detection
  minReplicas: 1
  maxReplicas: 5
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Pods
    pods:
      metric:
        name: inference_queue_length
      target:
        type: AverageValue
        averageValue: "10"
```

---

## 8. 5G MECé›†æˆ

### 8.1 MECæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  5Gæ ¸å¿ƒç½‘ (5GC)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  AMF   â”‚  â”‚  SMF   â”‚  â”‚  UPF   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ N3æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MECå¹³å°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        MECç¼–æ’å™¨ (K3s/KubeEdge)                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ä½å»¶è¿Ÿæ¸¸æˆâ”‚  â”‚ AR/VR    â”‚  â”‚ è½¦è”ç½‘   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ æœåŠ¡     â”‚  â”‚ åº”ç”¨     â”‚  â”‚ V2X      â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                          â”‚
â”‚                               â”‚ (æœ¬åœ°åˆ†æµ)               â”‚
â”‚                               â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 5GåŸºç«™ (gNB)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ (æ— çº¿æ¥å£)
                         â”‚ å»¶è¿Ÿ: <5ms
                         â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   5Gç»ˆç«¯è®¾å¤‡      â”‚
               â”‚  - æ‰‹æœº           â”‚
               â”‚  - ARçœ¼é•œ         â”‚
               â”‚  - è‡ªåŠ¨é©¾é©¶è½¦è¾†   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 MECéƒ¨ç½²

```yaml
# mec-deployment.yaml - MECè¾¹ç¼˜åº”ç”¨
apiVersion: v1
kind: Namespace
metadata:
  name: mec-apps

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloud-gaming
  namespace: mec-apps
  labels:
    app: cloud-gaming
    latency-sensitive: "true"
spec:
  replicas: 3
  selector:
    matchLabels:
      app: cloud-gaming
  template:
    metadata:
      labels:
        app: cloud-gaming
    spec:
      # è°ƒåº¦åˆ°MECèŠ‚ç‚¹
      nodeSelector:
        node.kubernetes.io/mec: "true"
        region: "beijing-mec-01"
      
      # æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦ (é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹)
      topologySpreadConstraints:
      - maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: DoNotSchedule
        labelSelector:
          matchLabels:
            app: cloud-gaming
      
      containers:
      - name: game-server
        image: game-server:v1
        resources:
          limits:
            nvidia.com/gpu: 1
            memory: "8Gi"
          requests:
            cpu: "4"
            memory: "4Gi"
        env:
        - name: MAX_PLAYERS
          value: "10"
        - name: LATENCY_TARGET
          value: "5ms"  # MECè¦æ±‚
        ports:
        - containerPort: 8080
          name: http
        - containerPort: 8090
          name: rtc  # WebRTC
        
        # ä½å»¶è¿Ÿç½‘ç»œé…ç½®
        securityContext:
          capabilities:
            add: ["NET_ADMIN"]

---
# service-mec.yaml - MECæœåŠ¡
apiVersion: v1
kind: Service
metadata:
  name: cloud-gaming-svc
  namespace: mec-apps
  annotations:
    # UPFæœ¬åœ°åˆ†æµæ³¨è§£
    mec.5g.io/upf-breakout: "true"
    mec.5g.io/qos-class: "GBR"  # Guaranteed Bit Rate
    mec.5g.io/latency-budget: "5ms"
spec:
  type: LoadBalancer
  externalTrafficPolicy: Local  # é¿å…è·¨èŠ‚ç‚¹è½¬å‘
  selector:
    app: cloud-gaming
  ports:
  - port: 80
    targetPort: 8080
    name: http
  - port: 8090
    targetPort: 8090
    protocol: UDP
    name: rtc
```

---

## 9. è¾¹ç¼˜å®‰å…¨

### 9.1 é›¶ä¿¡ä»»è¾¹ç¼˜

```yaml
# spiffe-spire-edge.yaml - è¾¹ç¼˜é›¶ä¿¡ä»»è®¤è¯
apiVersion: v1
kind: Namespace
metadata:
  name: spire

---
# SPIRE Server (äº‘ç«¯)
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: spire-server
  namespace: spire
spec:
  serviceName: spire-server
  replicas: 1
  selector:
    matchLabels:
      app: spire-server
  template:
    metadata:
      labels:
        app: spire-server
    spec:
      containers:
      - name: spire-server
        image: ghcr.io/spiffe/spire-server:1.9.0
        args:
        - -config
        - /run/spire/config/server.conf
        volumeMounts:
        - name: spire-config
          mountPath: /run/spire/config
        - name: spire-data
          mountPath: /run/spire/data
      volumes:
      - name: spire-config
        configMap:
          name: spire-server-config
  volumeClaimTemplates:
  - metadata:
      name: spire-data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 1Gi

---
# SPIRE Agent (è¾¹ç¼˜èŠ‚ç‚¹)
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: spire-agent
  namespace: spire
spec:
  selector:
    matchLabels:
      app: spire-agent
  template:
    metadata:
      labels:
        app: spire-agent
    spec:
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      nodeSelector:
        node-role.kubernetes.io/edge: ""
      containers:
      - name: spire-agent
        image: ghcr.io/spiffe/spire-agent:1.9.0
        args:
        - -config
        - /run/spire/config/agent.conf
        volumeMounts:
        - name: spire-config
          mountPath: /run/spire/config
        - name: spire-bundle
          mountPath: /run/spire/bundle
        - name: spire-agent-socket
          mountPath: /run/spire/sockets
        securityContext:
          privileged: true
      volumes:
      - name: spire-config
        configMap:
          name: spire-agent-config
      - name: spire-bundle
        configMap:
          name: spire-bundle
      - name: spire-agent-socket
        hostPath:
          path: /run/spire/sockets
          type: DirectoryOrCreate
```

### 9.2 è¾¹ç¼˜è®¾å¤‡è®¤è¯

```yaml
# device-cert-management.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: edge-device-cert
  namespace: default
spec:
  secretName: edge-device-tls
  issuerRef:
    name: edge-ca-issuer
    kind: ClusterIssuer
  commonName: "edge-device-01.example.com"
  dnsNames:
  - edge-device-01.example.com
  - edge-device-01.local
  ipAddresses:
  - 192.168.1.100
  duration: 8760h  # 1å¹´
  renewBefore: 720h  # 30å¤©å‰ç»­æœŸ
```

---

## 10. ç›‘æ§ä¸è¿ç»´

### 10.1 è¾¹ç¼˜ç›‘æ§æ–¹æ¡ˆ

```yaml
# prometheus-edge.yaml - è½»é‡çº§è¾¹ç¼˜ç›‘æ§
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 30s  # è¾¹ç¼˜é™ä½é‡‡é›†é¢‘ç‡
      evaluation_interval: 30s
    
    scrape_configs:
    - job_name: 'kubernetes-nodes'
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - source_labels: [__meta_kubernetes_node_label_node_role_kubernetes_io_edge]
        regex: ""
        action: drop  # åªç›‘æ§è¾¹ç¼˜èŠ‚ç‚¹
    
    - job_name: 'edge-apps'
      kubernetes_sd_configs:
      - role: pod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_node_name]
        regex: edge-.*
        action: keep
    
    # è¾¹ç¼˜ç‰¹å®šæŒ‡æ ‡
    - job_name: 'edge-devices'
      static_configs:
      - targets:
        - 'device-exporter:9100'
      metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'device_(temperature|humidity|pressure).*'
        action: keep

---
# grafana-edge-dashboard.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-edge-dashboard
data:
  edge-overview.json: |
    {
      "dashboard": {
        "title": "è¾¹ç¼˜èŠ‚ç‚¹æ¦‚è§ˆ",
        "panels": [
          {
            "title": "è¾¹ç¼˜èŠ‚ç‚¹åœ¨çº¿çŠ¶æ€",
            "targets": [{
              "expr": "up{job='kubernetes-nodes'}"
            }]
          },
          {
            "title": "äº‘è¾¹ç½‘ç»œå»¶è¿Ÿ",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(kubeedge_cloudhub_msg_latency_ms_bucket[5m]))"
            }]
          },
          {
            "title": "è¾¹ç¼˜AIæ¨ç†å»¶è¿Ÿ",
            "targets": [{
              "expr": "rate(inference_duration_seconds_sum[5m]) / rate(inference_duration_seconds_count[5m])"
            }]
          },
          {
            "title": "è®¾å¤‡è¿æ¥æ•°",
            "targets": [{
              "expr": "sum(kubeedge_device_twin_count)"
            }]
          }
        ]
      }
    }
```

### 10.2 æ•…éšœæ’æŸ¥

```bash
#!/bin/bash
# edge-troubleshooting.sh

# 1. æ£€æŸ¥è¾¹ç¼˜èŠ‚ç‚¹çŠ¶æ€
echo "=== è¾¹ç¼˜èŠ‚ç‚¹çŠ¶æ€ ==="
kubectl get nodes -l node-role.kubernetes.io/edge
kubectl describe node edge-node-1

# 2. æ£€æŸ¥äº‘è¾¹è¿æ¥
echo "=== CloudCoreæ—¥å¿— ==="
kubectl logs -n kubeedge $(kubectl get pod -n kubeedge -l app=cloudcore -o name) --tail=50

echo "=== EdgeCoreæ—¥å¿— (åœ¨è¾¹ç¼˜èŠ‚ç‚¹) ==="
# sshåˆ°è¾¹ç¼˜èŠ‚ç‚¹
ssh edge-node-1 journalctl -u edgecore -n 50

# 3. æ£€æŸ¥è®¾å¤‡è¿æ¥
echo "=== è®¾å¤‡çŠ¶æ€ ==="
kubectl get devices -A
kubectl describe device temp-sensor-01

# 4. ç½‘ç»œè¿é€šæ€§æµ‹è¯•
echo "=== äº‘è¾¹ç½‘ç»œæµ‹è¯• ==="
# ä»äº‘ç«¯pingè¾¹ç¼˜èŠ‚ç‚¹
ping -c 5 edge-node-1

# WebSocketè¿æ¥æµ‹è¯•
curl -i -N -H "Connection: Upgrade" \
     -H "Upgrade: websocket" \
     -H "Sec-WebSocket-Version: 13" \
     -H "Sec-WebSocket-Key: $(openssl rand -base64 16)" \
     https://cloudcore:10002/

# 5. è¾¹ç¼˜å®¹å™¨çŠ¶æ€ (åœ¨è¾¹ç¼˜èŠ‚ç‚¹)
ssh edge-node-1 << 'EOF'
ctr --namespace k8s.io containers ls
ctr --namespace k8s.io tasks ls
EOF

# 6. å¸¸è§é—®é¢˜ä¿®å¤
echo "=== ä¿®å¤å»ºè®® ==="
cat << 'FIXES'
é—®é¢˜1: è¾¹ç¼˜èŠ‚ç‚¹NotReady
  æ’æŸ¥: æ£€æŸ¥edgecoreæœåŠ¡, æŸ¥çœ‹/etc/kubeedge/config/edgecore.yaml
  ä¿®å¤: systemctl restart edgecore

é—®é¢˜2: è®¾å¤‡æ•°æ®ä¸æ›´æ–°
  æ’æŸ¥: æ£€æŸ¥mapperè¿›ç¨‹, éªŒè¯è®¾å¤‡åè®®é…ç½®
  ä¿®å¤: é‡å¯device-mapper Pod

é—®é¢˜3: äº‘è¾¹æ¶ˆæ¯å»¶è¿Ÿé«˜
  æ’æŸ¥: æ£€æŸ¥ç½‘ç»œå¸¦å®½, cloudcoreè´Ÿè½½
  ä¿®å¤: è°ƒæ•´websocketå‚æ•°, å¢åŠ cloudcoreå‰¯æœ¬

é—®é¢˜4: è¾¹ç¼˜Podæ— æ³•æ‹‰å–é•œåƒ
  æ’æŸ¥: æ£€æŸ¥é•œåƒä»“åº“å¯è¾¾æ€§
  ä¿®å¤: é…ç½®æœ¬åœ°é•œåƒä»“åº“/Harbor
FIXES
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- **K3s**: https://docs.k3s.io/
- **KubeEdge**: https://kubeedge.io/docs/
- **K0s**: https://docs.k0sproject.io/
- **MicroK8s**: https://microk8s.io/docs
- **OpenYurt**: https://openyurt.io/docs/

### å¼€æºé¡¹ç›®

- **K3s GitHub**: https://github.com/k3s-io/k3s
- **KubeEdge GitHub**: https://github.com/kubeedge/kubeedge
- **Longhorn**: https://longhorn.io/ (è¾¹ç¼˜å­˜å‚¨)
- **SPIRE**: https://spiffe.io/ (è¾¹ç¼˜å®‰å…¨)

---

**æ–‡æ¡£ç»´æŠ¤**: vSphere_DockeræŠ€æœ¯å›¢é˜Ÿ  
**æŠ€æœ¯æ”¯æŒ**: support@vsphere-docker.io  
**ç‰ˆæœ¬å†å²**: æŸ¥çœ‹ [CHANGELOG.md](../CHANGELOG.md)

---

> **ä¸‹ä¸€æ­¥**: æŸ¥çœ‹å®Œæ•´çš„è¾¹ç¼˜è®¡ç®—å®æˆ˜æ¡ˆä¾‹å’Œæ€§èƒ½ä¼˜åŒ–æŒ‡å—ï¼
