# 08 - å­˜å‚¨å®‰å…¨

**ä½œè€…**: äº‘åŸç”Ÿå­˜å‚¨ä¸“å®¶å›¢é˜Ÿ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-19  
**æœ€åæ›´æ–°**: 2025-10-19  
**ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ æœ¬ç« å¯¼èˆª

- [08 - å­˜å‚¨å®‰å…¨](#08---å­˜å‚¨å®‰å…¨)
  - [ğŸ“‹ æœ¬ç« å¯¼èˆª](#-æœ¬ç« å¯¼èˆª)
  - [1. åŠ å¯†](#1-åŠ å¯†)
    - [1.1 é™æ€æ•°æ®åŠ å¯†](#11-é™æ€æ•°æ®åŠ å¯†)
    - [1.2 ä¼ è¾“åŠ å¯†](#12-ä¼ è¾“åŠ å¯†)
    - [1.3 å¯†é’¥ç®¡ç†](#13-å¯†é’¥ç®¡ç†)
  - [2. è®¿é—®æ§åˆ¶](#2-è®¿é—®æ§åˆ¶)
    - [2.1 Kubernetes RBAC](#21-kubernetes-rbac)
    - [2.2 Cephè®¤è¯](#22-cephè®¤è¯)
  - [3. ç½‘ç»œå®‰å…¨](#3-ç½‘ç»œå®‰å…¨)
    - [3.1 ç½‘ç»œéš”ç¦»](#31-ç½‘ç»œéš”ç¦»)
    - [3.2 NetworkPolicy](#32-networkpolicy)
  - [4. å®¡è®¡ä¸åˆè§„](#4-å®¡è®¡ä¸åˆè§„)
    - [4.1 å®¡è®¡æ—¥å¿—](#41-å®¡è®¡æ—¥å¿—)
    - [4.2 åˆè§„æ ‡å‡†](#42-åˆè§„æ ‡å‡†)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
  - [6. æ€»ç»“](#6-æ€»ç»“)

---

## 1. åŠ å¯†

### 1.1 é™æ€æ•°æ®åŠ å¯†

**Kubernetes SecretsåŠ å¯†**:

```yaml
# å¯ç”¨etcdåŠ å¯†
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources:
  - secrets
  providers:
  - aescbc:
      keys:
      - name: key1
        secret: <BASE64_ENCODED_SECRET>
  - identity: {}
```

**CephåŠ å¯†**:

```yaml
# RBDåŠ å¯† (LUKS)
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: rook-ceph-block-encrypted
provisioner: rook-ceph.rbd.csi.ceph.com
parameters:
  clusterID: rook-ceph
  pool: replicapool
  encrypted: "true"
  encryptionKMSID: vault
```

**äº‘å­˜å‚¨åŠ å¯†**:

```yaml
# AWS EBSåŠ å¯†
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ebs-encrypted
provisioner: ebs.csi.aws.com
parameters:
  type: gp3
  encrypted: "true"
  kmsKeyId: arn:aws:kms:us-east-1:123456789012:key/xxxx

---
# Azure DiskåŠ å¯†
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: azure-disk-encrypted
provisioner: disk.csi.azure.com
parameters:
  skuName: Premium_LRS
  encrypted: "true"
  diskEncryptionSetID: /subscriptions/.../diskEncryptionSets/myDES
```

---

### 1.2 ä¼ è¾“åŠ å¯†

**Ceph mTLS**:

```yaml
# Cephé…ç½®
[global]
ms_client_mode = secure
ms_cluster_mode = secure
ms_service_mode = secure
ms_mon_service_mode = secure
ms_mon_cluster_mode = secure
```

**StorageClass TLS**:

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: secure-storage
provisioner: rook-ceph.rbd.csi.ceph.com
parameters:
  ...
  csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner
  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph
mountOptions:
- sec=sys  # NFSå®‰å…¨æ¨¡å¼
```

---

### 1.3 å¯†é’¥ç®¡ç†

**HashiCorp Vaulté›†æˆ**:

```yaml
# Vault KMS
apiVersion: v1
kind: ConfigMap
metadata:
  name: csi-kms-config
  namespace: rook-ceph
data:
  config.json: |
    {
      "vault": {
        "VAULT_ADDR": "https://vault.example.com:8200",
        "VAULT_BACKEND_PATH": "rook",
        "VAULT_CACERT": "/etc/vault/ca.crt",
        "VAULT_TLS_SERVER_NAME": "vault.example.com",
        "VAULT_CLIENT_CERT": "/etc/vault/client.crt",
        "VAULT_CLIENT_KEY": "/etc/vault/client.key"
      }
    }
```

---

## 2. è®¿é—®æ§åˆ¶

### 2.1 Kubernetes RBAC

**å­˜å‚¨RBAC**:

```yaml
# StorageClassç®¡ç†å‘˜
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: storage-admin
rules:
- apiGroups: ["storage.k8s.io"]
  resources: ["storageclasses"]
  verbs: ["*"]
- apiGroups: [""]
  resources: ["persistentvolumes"]
  verbs: ["*"]

---
# PVCç”¨æˆ·
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pvc-user
  namespace: myapp
rules:
- apiGroups: [""]
  resources: ["persistentvolumeclaims"]
  verbs: ["get", "list", "create", "delete"]

---
# ç»‘å®š
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pvc-user-binding
  namespace: myapp
subjects:
- kind: User
  name: john
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pvc-user
  apiGroup: rbac.authorization.k8s.io
```

---

### 2.2 Cephè®¤è¯

**Ceph CephXè®¤è¯**:

```bash
# åˆ›å»ºCephç”¨æˆ·
ceph auth get-or-create client.myapp \
  mon 'allow r' \
  osd 'allow rw pool=myapp-pool' \
  -o /etc/ceph/ceph.client.myapp.keyring

# æŸ¥çœ‹ç”¨æˆ·æƒé™
ceph auth get client.myapp

# é™åˆ¶è®¿é—®
ceph auth caps client.myapp \
  mon 'allow r' \
  osd 'allow rw pool=myapp-pool, allow r pool=shared-pool'
```

---

## 3. ç½‘ç»œå®‰å…¨

### 3.1 ç½‘ç»œéš”ç¦»

**Cephç½‘ç»œéš”ç¦»**:

```yaml
# Rook CephClusterç½‘ç»œé…ç½®
apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
  name: rook-ceph
  namespace: rook-ceph
spec:
  network:
    provider: host
    selectors:
      public: "10.0.1.0/24"    # å‰ç«¯ç½‘ç»œ
      cluster: "10.0.2.0/24"   # åç«¯ç½‘ç»œ
```

---

### 3.2 NetworkPolicy

**å­˜å‚¨NetworkPolicy**:

```yaml
# é™åˆ¶è®¿é—®Ceph
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ceph-network-policy
  namespace: rook-ceph
spec:
  podSelector:
    matchLabels:
      app: rook-ceph-osd
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: rook-ceph
    - namespaceSelector:
        matchLabels:
          storage-access: "true"
    ports:
    - protocol: TCP
      port: 6800-7300  # Ceph OSDç«¯å£
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: rook-ceph
    ports:
    - protocol: TCP
      port: 6800-7300
```

---

## 4. å®¡è®¡ä¸åˆè§„

### 4.1 å®¡è®¡æ—¥å¿—

**Kuberneteså®¡è®¡**:

```yaml
# å®¡è®¡ç­–ç•¥
apiVersion: audit.k8s.io/v1
kind: Policy
rules:
# è®°å½•PV/PVCæ“ä½œ
- level: RequestResponse
  resources:
  - group: ""
    resources: ["persistentvolumes", "persistentvolumeclaims"]
  verbs: ["create", "delete", "patch", "update"]

# è®°å½•StorageClassæ“ä½œ
- level: RequestResponse
  resources:
  - group: "storage.k8s.io"
    resources: ["storageclasses"]
  verbs: ["*"]
```

**Cephå®¡è®¡**:

```bash
# å¯ç”¨Cephå®¡è®¡
ceph config set mgr mgr/telemetry/enabled true

# æŸ¥çœ‹å®¡è®¡æ—¥å¿—
ceph log last 100

# Cephæ“ä½œæ—¥å¿—
tail -f /var/log/ceph/ceph.audit.log
```

---

### 4.2 åˆè§„æ ‡å‡†

**å­˜å‚¨åˆè§„è¦æ±‚**:

```yaml
PCI DSS (æ”¯ä»˜å¡):
  âœ… åŠ å¯†é™æ€æ•°æ®
  âœ… åŠ å¯†ä¼ è¾“æ•°æ®
  âœ… è®¿é—®æ§åˆ¶ (RBAC)
  âœ… å®¡è®¡æ—¥å¿—
  âœ… å®šæœŸå¤‡ä»½
  âœ… å¯†é’¥ç®¡ç†

HIPAA (åŒ»ç–—):
  âœ… æ•°æ®åŠ å¯†
  âœ… è®¿é—®å®¡è®¡
  âœ… æ•°æ®å®Œæ•´æ€§
  âœ… å¤‡ä»½ä¸æ¢å¤
  âœ… ç¾éš¾æ¢å¤è®¡åˆ’

GDPR (éšç§):
  âœ… æ•°æ®åŠ å¯†
  âœ… è®¿é—®æ§åˆ¶
  âœ… æ•°æ®åˆ é™¤ (right to be forgotten)
  âœ… æ•°æ®å¯ç§»æ¤æ€§
  âœ… å®¡è®¡æ—¥å¿—

ISO 27001:
  âœ… ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³» (ISMS)
  âœ… é£é™©è¯„ä¼°
  âœ… å®‰å…¨æ§åˆ¶
  âœ… æŒç»­æ”¹è¿›
```

---

## 5. æœ€ä½³å®è·µ

```yaml
åŠ å¯†:
  âœ… é»˜è®¤å¯ç”¨é™æ€æ•°æ®åŠ å¯†
  âœ… ä½¿ç”¨äº‘KMSç®¡ç†å¯†é’¥
  âœ… å®šæœŸè½®æ¢å¯†é’¥
  âœ… ä¼ è¾“åŠ å¯† (TLS)

è®¿é—®æ§åˆ¶:
  âœ… æœ€å°æƒé™åŸåˆ™
  âœ… RBACç²¾ç»†åŒ–
  âœ… å®šæœŸå®¡æŸ¥æƒé™
  âœ… ä½¿ç”¨ServiceAccount

ç½‘ç»œå®‰å…¨:
  âœ… ç½‘ç»œéš”ç¦» (å‰åç«¯åˆ†ç¦»)
  âœ… NetworkPolicyé™åˆ¶è®¿é—®
  âœ… ç§æœ‰ç½‘ç»œ
  âœ… é˜²ç«å¢™è§„åˆ™

å®¡è®¡:
  âœ… å¯ç”¨å®¡è®¡æ—¥å¿—
  âœ… é›†ä¸­æ—¥å¿—ç®¡ç†
  âœ… å®æ—¶å‘Šè­¦
  âœ… å®šæœŸå®¡æŸ¥

å¤‡ä»½:
  âœ… åŠ å¯†å¤‡ä»½
  âœ… å¼‚åœ°å¤‡ä»½
  âœ… å®šæœŸæ¢å¤æ¼”ç»ƒ
  âœ… è®¿é—®æ§åˆ¶

åˆè§„:
  âœ… äº†è§£åˆè§„è¦æ±‚
  âœ… å®šæœŸå®¡è®¡
  âœ… æ–‡æ¡£è®°å½•
  âœ… åŸ¹è®­
```

---

## 6. æ€»ç»“

```yaml
æ ¸å¿ƒçŸ¥è¯†:
  âœ… åŠ å¯† (é™æ€/ä¼ è¾“/å¯†é’¥ç®¡ç†)
  âœ… è®¿é—®æ§åˆ¶ (RBAC/CephX)
  âœ… ç½‘ç»œå®‰å…¨ (éš”ç¦»/NetworkPolicy)
  âœ… å®¡è®¡ä¸åˆè§„ (æ—¥å¿—/æ ‡å‡†)
  âœ… æœ€ä½³å®è·µ

ä»£ç ç¤ºä¾‹:
  - åŠ å¯†é…ç½® (Kubernetes/Ceph/äº‘)
  - RBACè§„åˆ™
  - NetworkPolicy
  - å®¡è®¡ç­–ç•¥
  - 30+é…ç½®

å®‰å…¨å±‚æ¬¡:
  L1: ç‰©ç†å®‰å…¨ (æ•°æ®ä¸­å¿ƒ)
  L2: ç½‘ç»œå®‰å…¨ (éš”ç¦»/é˜²ç«å¢™)
  L3: ç³»ç»Ÿå®‰å…¨ (OSåŠ å›º)
  L4: åº”ç”¨å®‰å…¨ (RBAC/åŠ å¯†)
  L5: æ•°æ®å®‰å…¨ (åŠ å¯†/å¤‡ä»½)
  L6: å®¡è®¡ä¸åˆè§„ (æ—¥å¿—/ç›‘æ§)
```

---

**å®Œæˆæ—¥æœŸ**: 2025-10-19  
**ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: äº‘åŸç”Ÿå­˜å‚¨ä¸“å®¶å›¢é˜Ÿ

**Tags**: `#Security` `#Encryption` `#RBAC` `#Compliance` `#CloudNativeStorage`
