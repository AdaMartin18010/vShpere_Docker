# 服务发现与负载均衡

## 目录

- [服务发现与负载均衡](#服务发现与负载均衡)
  - [目录](#目录)
  - [1. Service 模型](#1-service-模型)
  - [2. Ingress 与网关](#2-ingress-与网关)
  - [3. DNS 与服务发现](#3-dns-与服务发现)
  - [4. 外部流量与 LB](#4-外部流量与-lb)
  - [5. 实践要点与 FAQ](#5-实践要点与-faq)
  - [6. 故障清单与排查](#6-故障清单与排查)
  - [7. 示例 YAML 与 SOP](#7-示例-yaml-与-sop)

## 1. Service 模型

- ClusterIP/NodePort/LoadBalancer/Headless；SessionAffinity

## 2. Ingress 与网关

- IngressClass 与控制器；Gateway API 概览

## 3. DNS 与服务发现

- CoreDNS、Service/Endpoints、Headless + SRV

## 4. 外部流量与 LB

- 外部 LB 与云集成、MetalLB、本地直通

## 5. 实践要点与 FAQ

- 常见拓扑与排障清单

（待补充：示例 YAML 与流量策略）

## 6. 故障清单与排查

- Service 无法访问：确认选择器与 Endpoints；核对网络策略。
- NodePort 不通：检查节点防火墙、安全组与云路由。
- Ingress 404/证书问题：核对 IngressClass、TLS Secret 与主机名解析。

## 7. 示例 YAML 与 SOP

```yaml
apiVersion: v1
kind: Service
metadata:
  name: web-svc
spec:
  selector:
    app: web
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: web-ing
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  tls:
  - hosts: ["web.example.com"]
    secretName: web-tls
  rules:
  - host: web.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-svc
            port:
              number: 80
```

SOP：

- 端点检查：`kubectl get endpoints web-svc -o wide`
- Ingress 路由：`kubectl describe ingress web-ing`
- 证书核对：`kubectl get secret web-tls -o yaml | head -n 40`
