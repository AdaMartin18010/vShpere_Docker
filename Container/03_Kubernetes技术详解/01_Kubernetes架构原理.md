# Kubernetes架构原理

## 目录

- [Kubernetes架构原理](#kubernetes架构原理)
  - [目录](#目录)
  - [1. 整体架构与组件职责](#1-整体架构与组件职责)
  - [2. 控制面与数据面](#2-控制面与数据面)
  - [3. 节点、容器运行时与 CRI](#3-节点容器运行时与-cri)
  - [4. CNI/CSI 扩展模型](#4-cnicsi-扩展模型)
  - [5. 对象模型与一致性](#5-对象模型与一致性)
  - [6. 高可用与扩展性](#6-高可用与扩展性)
  - [7. 实践要点与 FAQ](#7-实践要点与-faq)
  - [8. 升级与回滚流程（SOP）](#8-升级与回滚流程sop)

## 1. 整体架构与组件职责

- kube-apiserver、etcd、kube-scheduler、kube-controller-manager、cloud-controller-manager

## 2. 控制面与数据面

- 控制回路、期望状态与实际状态；声明式模型

## 3. 节点、容器运行时与 CRI

- kubelet、kube-proxy；containerd/CRI-O 与 CRI 接口

## 4. CNI/CSI 扩展模型

- 网络与存储插件生态与对接要点

## 5. 对象模型与一致性

- API 资源、控制器、Informer、Finalizer

## 6. 高可用与扩展性

- 控制面多副本、水平扩缩；多集群与联邦

## 7. 实践要点与 FAQ

- 版本与组件兼容矩阵；证书与身份；集群升级策略

（待补充：架构图与常见拓扑）

## 8. 升级与回滚流程（SOP）

步骤要点：

1) 盘点与评估：版本矩阵/插件兼容性/备份（etcd/CRDs/配置）。
2) 控制面滚动：apiserver→controller-manager→scheduler；多副本逐个升级与验证。
3) 节点升级：逐节点 cordon & drain，升级 kubelet/CRI/CNI/CSI，业务验证后 uncordon。
4) 验证：API 健康、控制器队列、关键业务 SLO；观察 24-48h。
5) 回滚：保留前版本镜像与配置；必要时恢复 etcd 备份并按相反顺序回滚。

进阶（多 AZ/多集群）：

- 多 AZ：分区滚动，优先低风险 AZ；跨 AZ 流量权重控制，验证后逐步提升。
- 多集群蓝绿：并行运行旧/新集群，数据面解耦（DB/缓存共享或复制），通过网关权重/路由切换；保留回切路径。
- 金丝雀：基于服务网格/网关对小比例流量放量观察，指标达标后扩大；失败则自动回退。
