# 日志采集与分析

> **返回**: [日志管理首页](README.md) | [运维管理首页](../README.md) | [部署指南首页](../../00_索引导航/README.md)

---

## 📋 目录

- [日志采集与分析](#日志采集与分析)
  - [📋 目录](#-目录)
  - [1. Fluent Bit采集](#1-fluent-bit采集)
  - [2. 日志格式化](#2-日志格式化)
  - [3. 日志过滤](#3-日志过滤)
  - [4. 日志分析](#4-日志分析)

---

## 1. Fluent Bit采集

**DaemonSet部署**:

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluent-bit
  namespace: logging
spec:
  selector:
    matchLabels:
      app: fluent-bit
  template:
    metadata:
      labels:
        app: fluent-bit
    spec:
      containers:
      - name: fluent-bit
        image: fluent/fluent-bit:2.2
        volumeMounts:
        - name: varlog
          mountPath: /var/log
        - name: varlibdockercontainers
          mountPath: /var/lib/docker/containers
          readOnly: true
        - name: config
          mountPath: /fluent-bit/etc/
      volumes:
      - name: varlog
        hostPath:
          path: /var/log
      - name: varlibdockercontainers
        hostPath:
          path: /var/lib/docker/containers
      - name: config
        configMap:
          name: fluent-bit-config
```

---

## 2. 日志格式化

**Fluent Bit配置**:

```ini
[INPUT]
    Name              tail
    Path              /var/log/containers/*.log
    Parser            docker
    Tag               kube.*
    
[FILTER]
    Name              kubernetes
    Match             kube.*
    Kube_URL          https://kubernetes.default.svc:443
    
[OUTPUT]
    Name              elasticsearch
    Match             *
    Host              elasticsearch
    Port              9200
    Index             fluent-bit
    Type              _doc
```

---

## 3. 日志过滤

**过滤规则**:

```ini
[FILTER]
    Name    grep
    Match   *
    Regex   log level=(ERROR|WARN)
    
[FILTER]
    Name    modify
    Match   *
    Add     cluster prod
```

---

## 4. 日志分析

**日志告警规则**:

```yaml
groups:
- name: log_alerts
  rules:
  - alert: HighErrorRate
    expr: |
      sum(rate({job="app"} |= "ERROR" [5m])) > 10
    labels:
      severity: warning
    annotations:
      summary: "应用错误日志过多"
```

---

**更新时间**: 2025-10-19  
**文档版本**: v1.0  
**状态**: ✅ 完成

