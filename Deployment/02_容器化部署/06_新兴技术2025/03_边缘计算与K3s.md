# 边缘计算与K3s

> **返回**: [新兴技术2025首页](README.md) | [容器化部署首页](../README.md)

---

## 📋 目录

- [边缘计算与K3s](#边缘计算与k3s)
  - [📋 目录](#-目录)
  - [边缘计算概述](#边缘计算概述)
    - [什么是边缘计算](#什么是边缘计算)
    - [边缘计算架构](#边缘计算架构)
    - [边缘计算 vs 云计算](#边缘计算-vs-云计算)
    - [边缘计算应用场景](#边缘计算应用场景)
      - [1. **5G MEC (移动边缘计算)**](#1-5g-mec-移动边缘计算)
      - [2. **工业互联网**](#2-工业互联网)
      - [3. **智慧城市**](#3-智慧城市)
      - [4. **CDN边缘缓存**](#4-cdn边缘缓存)
      - [5. **IoT设备管理**](#5-iot设备管理)
  - [K3s轻量级Kubernetes](#k3s轻量级kubernetes)
    - [K3s概述](#k3s概述)
    - [K3s架构](#k3s架构)
    - [K3s vs K8s对比](#k3s-vs-k8s对比)
    - [K3s安装部署](#k3s安装部署)
      - [单节点部署](#单节点部署)
      - [高可用集群部署](#高可用集群部署)
      - [离线安装](#离线安装)
    - [K3s核心特性](#k3s核心特性)
      - [内置组件](#内置组件)
      - [轻量级存储 - Local Path Provisioner](#轻量级存储---local-path-provisioner)
      - [嵌入式负载均衡 - ServiceLB](#嵌入式负载均衡---servicelb)
      - [嵌入式数据库 - SQLite/etcd](#嵌入式数据库---sqliteetcd)
    - [K3s 2025新特性](#k3s-2025新特性)
      - [1. **Kubernetes 1.28+ 支持**](#1-kubernetes-128-支持)
      - [2. **增强的离线能力**](#2-增强的离线能力)
      - [3. **ARM64完全支持**](#3-arm64完全支持)
      - [4. **安全增强**](#4-安全增强)
      - [5. **集成Wasm支持**](#5-集成wasm支持)
  - [KubeEdge边云协同](#kubeedge边云协同)
    - [KubeEdge概述](#kubeedge概述)
    - [KubeEdge架构](#kubeedge架构)
    - [KubeEdge安装部署](#kubeedge安装部署)
      - [云端安装 (CloudCore)](#云端安装-cloudcore)
      - [边缘节点安装 (EdgeCore)](#边缘节点安装-edgecore)
    - [KubeEdge核心特性](#kubeedge核心特性)
      - [边云消息路由](#边云消息路由)
      - [设备管理 (Device Mapper)](#设备管理-device-mapper)
      - [边缘自治](#边缘自治)
    - [KubeEdge 2025新特性](#kubeedge-2025新特性)
      - [1. **KubeEdge 1.15+ 新特性**](#1-kubeedge-115-新特性)
      - [2. **边缘原生Service**](#2-边缘原生service)
      - [3. **边缘AI - Sedna**](#3-边缘ai---sedna)
  - [OpenYurt边缘自治](#openyurt边缘自治)
    - [OpenYurt概述](#openyurt概述)
    - [OpenYurt架构](#openyurt架构)
    - [OpenYurt安装部署](#openyurt安装部署)
    - [OpenYurt核心特性](#openyurt核心特性)
      - [1. **YurtHub本地代理**](#1-yurthub本地代理)
      - [2. **节点池 (NodePool)**](#2-节点池-nodepool)
      - [3. **UnitedDeployment多地域部署**](#3-uniteddeployment多地域部署)
      - [4. **流量拓扑 (ServiceTopology)**](#4-流量拓扑-servicetopology)
    - [OpenYurt 2025新特性](#openyurt-2025新特性)
      - [1. **OpenYurt 1.4+ 新特性**](#1-openyurt-14-新特性)
      - [2. **边缘Ingress**](#2-边缘ingress)
  - [边缘计算技术对比](#边缘计算技术对比)
    - [K3s vs KubeEdge vs OpenYurt](#k3s-vs-kubeedge-vs-openyurt)
    - [选型建议](#选型建议)
      - [使用K3s的场景](#使用k3s的场景)
      - [使用KubeEdge的场景](#使用kubeedge的场景)
      - [使用OpenYurt的场景](#使用openyurt的场景)
  - [边缘计算最佳实践](#边缘计算最佳实践)
    - [网络优化](#网络优化)
      - [1. **边云网络优化**](#1-边云网络优化)
      - [2. **边缘服务拓扑**](#2-边缘服务拓扑)
    - [资源管理](#资源管理)
      - [1. **边缘节点资源预留**](#1-边缘节点资源预留)
      - [2. **边缘Pod资源限制**](#2-边缘pod资源限制)
    - [安全加固](#安全加固)
      - [1. **边缘节点TLS加固**](#1-边缘节点tls加固)
      - [2. **NetworkPolicy隔离**](#2-networkpolicy隔离)
    - [监控运维](#监控运维)
      - [1. **边缘节点监控 (Prometheus)**](#1-边缘节点监控-prometheus)
      - [2. **边缘日志收集 (Fluent Bit)**](#2-边缘日志收集-fluent-bit)
  - [边缘计算生产案例](#边缘计算生产案例)
    - [案例1：5G MEC边缘计算](#案例15g-mec边缘计算)
    - [案例2：IoT设备管理](#案例2iot设备管理)
    - [案例3：CDN边缘节点](#案例3cdn边缘节点)
  - [边缘计算未来趋势](#边缘计算未来趋势)
    - [1. **边缘原生 (Edge Native)**](#1-边缘原生-edge-native)
    - [2. **边缘AI主流化**](#2-边缘ai主流化)
    - [3. **5G + 边缘计算融合**](#3-5g--边缘计算融合)
    - [4. **边缘安全增强**](#4-边缘安全增强)
    - [5. **边缘Serverless**](#5-边缘serverless)
  - [相关资源](#相关资源)
    - [官方文档](#官方文档)
    - [GitHub仓库](#github仓库)
    - [社区](#社区)

---

## 边缘计算概述

### 什么是边缘计算

**边缘计算** (Edge Computing) 是一种分布式计算架构，将计算、存储和网络能力从集中式数据中心**下沉到网络边缘**，更靠近数据源和用户。

**核心理念**:

```text
传统云计算:  设备 → 云数据中心 → 处理 → 返回结果 (延迟: 100-500ms)
边缘计算:    设备 → 边缘节点 → 本地处理 → 返回结果 (延迟: 1-10ms)
```

**价值**:

- ⚡ **低延迟**: 本地处理，延迟降低10-100倍
- 💰 **节省带宽**: 数据本地过滤，减少90%以上云端传输
- 🔒 **数据主权**: 敏感数据不出边缘，满足合规要求
- 🌐 **离线自治**: 边缘节点断网也能继续运行
- 📈 **可扩展**: 水平扩展边缘节点

---

### 边缘计算架构

```text
┌─────────────────────────────────────────────────────────────┐
│                         云数据中心                            │
│  ┌──────────────────────────────────────────────────────┐   │
│  │   Kubernetes集群 (中心云)                             │   │
│  │   - 应用编排管理                                      │   │
│  │   - 边缘节点注册                                      │   │
│  │   - 配置下发                                          │   │
│  │   - 数据汇聚分析                                      │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              ↕ 边云通信
┌─────────────────────────────────────────────────────────────┐
│                         边缘区域                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ 边缘节点1     │  │ 边缘节点2     │  │ 边缘节点3     │      │
│  │ (K3s/KubeEdge)│  │ (K3s/KubeEdge)│  │ (K3s/KubeEdge)│      │
│  │ - 容器运行时  │  │ - 容器运行时  │  │ - 容器运行时  │      │
│  │ - 本地存储    │  │ - 本地存储    │  │ - 本地存储    │      │
│  │ - 边缘应用    │  │ - 边缘应用    │  │ - 边缘应用    │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│         ↕                 ↕                 ↕                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  IoT设备      │  │  摄像头       │  │  传感器       │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

**架构层次**:

1. **云端层**: 中心Kubernetes集群，负责全局管理、应用编排、数据汇聚
2. **边缘层**: 边缘Kubernetes节点 (K3s/KubeEdge/OpenYurt)，本地计算和存储
3. **设备层**: IoT设备、传感器、摄像头，数据采集

---

### 边缘计算 vs 云计算

| 维度 | 云计算 | 边缘计算 | 优势 |
|-----|--------|---------|------|
| **延迟** | 100-500ms | 1-10ms | 边缘低10-100倍 |
| **带宽** | 高带宽需求 | 低带宽 | 边缘节省90%+ |
| **数据主权** | 数据上云 | 数据本地 | 边缘合规性好 |
| **离线能力** | 依赖网络 | 自治运行 | 边缘容错性强 |
| **计算能力** | 高性能 | 中低性能 | 云端算力强 |
| **成本** | 高 (带宽+计算) | 低 (本地处理) | 边缘成本低 |
| **管理复杂度** | 低 | 中高 | 云端管理简单 |

**最佳实践**: 边云协同

- **边缘处理**: 实时性要求高、数据量大、敏感数据
- **云端处理**: 复杂计算、数据汇聚分析、模型训练

---

### 边缘计算应用场景

#### 1. **5G MEC (移动边缘计算)**

- **场景**: 5G基站边缘计算
- **需求**: 超低延迟 (<10ms)、高并发、移动性
- **应用**: AR/VR、云游戏、自动驾驶

#### 2. **工业互联网**

- **场景**: 工厂车间、生产线
- **需求**: 实时控制、数据安全、离线自治
- **应用**: 设备监控、预测性维护、质量检测

#### 3. **智慧城市**

- **场景**: 交通监控、公共安全
- **需求**: 视频分析、实时告警、数据本地化
- **应用**: 车牌识别、人脸识别、交通流量分析

#### 4. **CDN边缘缓存**

- **场景**: 内容分发网络
- **需求**: 低延迟、高吞吐、就近访问
- **应用**: 视频流、静态资源、动态加速

#### 5. **IoT设备管理**

- **场景**: 智能家居、智能农业
- **需求**: 设备接入、协议转换、边缘AI
- **应用**: 设备监控、数据采集、边缘推理

---

## K3s轻量级Kubernetes

### K3s概述

**K3s** 是 **Rancher Labs** 开发的轻量级Kubernetes发行版，专为**边缘计算**、**IoT**和**资源受限环境**设计。

**官网**: https://k3s.io/  
**GitHub**: https://github.com/k3s-io/k3s  
**CNCF状态**: Sandbox → Graduated (2023)

**核心特点**:

- ⚡ **极致轻量**: 二进制文件<100MB，内存占用<512MB
- 🚀 **快速启动**: 30秒内启动完整集群
- 📦 **内置组件**: Traefik、CoreDNS、ServiceLB、Local Path Provisioner
- 🔧 **简化操作**: 单一二进制，一条命令安装
- 🌍 **跨平台**: x86_64、ARM64、ARMv7

---

### K3s架构

```text
┌───────────────────────────────────────────────────────────┐
│                     K3s Server Node                        │
│  ┌──────────────────────────────────────────────────────┐ │
│  │  K3s Server (单一二进制)                              │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │  Kubernetes Control Plane                       │ │ │
│  │  │  - kube-apiserver                               │ │ │
│  │  │  - kube-controller-manager                      │ │ │
│  │  │  - kube-scheduler                               │ │ │
│  │  │  - embedded etcd/SQLite (数据存储)             │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │  Kubernetes Data Plane                          │ │ │
│  │  │  - kubelet                                      │ │ │
│  │  │  - containerd (容器运行时)                      │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │  内置组件                                        │ │ │
│  │  │  - Traefik Ingress Controller                   │ │ │
│  │  │  - CoreDNS                                      │ │ │
│  │  │  - ServiceLB (Klipper-lb)                       │ │ │
│  │  │  - Local Path Provisioner                       │ │ │
│  │  │  - Network Policy Controller (默认禁用)         │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────┘
                            ↕
┌───────────────────────────────────────────────────────────┐
│                     K3s Agent Nodes                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ Agent Node 1 │  │ Agent Node 2 │  │ Agent Node 3 │    │
│  │ - kubelet    │  │ - kubelet    │  │ - kubelet    │    │
│  │ - containerd │  │ - containerd │  │ - containerd │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
└───────────────────────────────────────────────────────────┘
```

**K3s vs K8s架构差异**:

| 组件 | K8s | K3s | 说明 |
|-----|-----|-----|------|
| **二进制** | 多个组件分离 | 单一二进制 | K3s简化部署 |
| **数据存储** | etcd | SQLite/etcd | K3s默认SQLite |
| **容器运行时** | Docker/containerd | containerd | K3s仅支持containerd |
| **Ingress** | 需手动安装 | Traefik内置 | K3s开箱即用 |
| **LB** | 需外部LB | ServiceLB内置 | K3s自带LB |
| **存储** | 需手动配置 | Local Path内置 | K3s自动PV |

---

### K3s vs K8s对比

| 维度 | K3s | K8s | 优势 |
|-----|-----|-----|------|
| **安装复杂度** | ⭐ (一条命令) | ⭐⭐⭐⭐ | K3s极简 |
| **资源占用** | <512MB内存 | >2GB内存 | K3s省资源 |
| **启动速度** | <30s | >5min | K3s快10倍 |
| **功能完整性** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | K8s更全 |
| **生态成熟度** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | K8s最成熟 |
| **适用场景** | 边缘/IoT | 大规模云 | 各有优势 |

**兼容性**: K3s **100%兼容** Kubernetes API，可运行所有标准K8s工作负载。

---

### K3s安装部署

#### 单节点部署

```bash
#!/bin/bash
# install-k3s-single.sh - K3s单节点快速安装 (2025)

set -e

echo "=== K3s单节点安装 ==="

# 1. 系统检查
echo "1. 检查系统环境..."
uname -a
free -h

# 2. 安装K3s Server (使用国内镜像加速)
echo "2. 安装K3s Server..."
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
  INSTALL_K3S_MIRROR=cn \
  INSTALL_K3S_VERSION="v1.28.5+k3s1" \
  sh -s - server \
    --write-kubeconfig-mode 644 \
    --disable traefik \
    --disable servicelb \
    --kube-apiserver-arg='feature-gates=MixedProtocolLBService=true' \
    --node-name edge-master

# 3. 验证安装
echo "3. 验证K3s..."
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
kubectl get nodes
kubectl get pods -A

# 4. 配置kubectl (可选)
echo "4. 配置kubectl..."
mkdir -p ~/.kube
cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
chmod 600 ~/.kube/config

# 5. 安装Helm (可选)
echo "5. 安装Helm..."
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

# 6. 显示节点Token (用于添加Agent节点)
echo ""
echo "=== K3s安装完成 ==="
echo "Node Token (保存用于添加Agent节点):"
cat /var/lib/rancher/k3s/server/node-token
echo ""
echo "添加Agent节点命令:"
echo "curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \\"
echo "  INSTALL_K3S_MIRROR=cn \\"
echo "  K3S_URL=https://$(hostname -I | awk '{print $1}'):6443 \\"
echo "  K3S_TOKEN=<上面的Token> sh -"
```

#### 高可用集群部署

```bash
#!/bin/bash
# install-k3s-ha.sh - K3s高可用集群安装 (嵌入式etcd)

set -e

echo "=== K3s高可用集群安装 (嵌入式etcd) ==="

# ======== 第一个Server节点 ========
# 在 server1 上执行
echo "在第一个Server节点上执行:"
echo "---"
cat <<'EOF'
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
  INSTALL_K3S_MIRROR=cn \
  INSTALL_K3S_VERSION="v1.28.5+k3s1" \
  sh -s - server \
    --cluster-init \
    --write-kubeconfig-mode 644 \
    --tls-san load-balancer.example.com \
    --node-name server1
EOF

# 获取Token
# cat /var/lib/rancher/k3s/server/node-token

# ======== 第二、三个Server节点 ========
# 在 server2, server3 上执行
echo ""
echo "在第二、三个Server节点上执行:"
echo "---"
cat <<'EOF'
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
  INSTALL_K3S_MIRROR=cn \
  INSTALL_K3S_VERSION="v1.28.5+k3s1" \
  K3S_TOKEN=<从server1获取的Token> \
  sh -s - server \
    --server https://<server1-ip>:6443 \
    --write-kubeconfig-mode 644 \
    --tls-san load-balancer.example.com \
    --node-name server2  # server3改为server3
EOF

# ======== Agent节点 ========
echo ""
echo "添加Agent节点 (在agent节点上执行):"
echo "---"
cat <<'EOF'
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
  INSTALL_K3S_MIRROR=cn \
  INSTALL_K3S_VERSION="v1.28.5+k3s1" \
  K3S_URL=https://load-balancer.example.com:6443 \
  K3S_TOKEN=<Token> \
  sh -
EOF

# ======== 验证集群 ========
echo ""
echo "验证集群 (在任一Server节点执行):"
echo "kubectl get nodes"
echo "kubectl get pods -A"
```

**高可用架构**:

```text
┌──────────────┐
│  Load Balancer │  (可选: HAProxy/Nginx)
│  VIP: 10.0.0.10│
└──────────────┘
       ↓
┌────────────────────────────────────┐
│     K3s Server Nodes (HA)          │
│  ┌────────┐  ┌────────┐  ┌────────┐
│  │Server1 │  │Server2 │  │Server3 │
│  │etcd    │  │etcd    │  │etcd    │
│  └────────┘  └────────┘  └────────┘
└────────────────────────────────────┘
       ↓
┌────────────────────────────────────┐
│     K3s Agent Nodes                │
│  ┌────────┐  ┌────────┐  ┌────────┐
│  │Agent1  │  │Agent2  │  │Agent3  │
│  └────────┘  └────────┘  └────────┘
└────────────────────────────────────┘
```

#### 离线安装

```bash
#!/bin/bash
# install-k3s-airgap.sh - K3s离线安装

set -e

echo "=== K3s离线安装 ==="

# 前提: 已下载以下文件并传输到离线环境
# - k3s (二进制)
# - k3s-airgap-images-amd64.tar.gz (镜像包)
# - install.sh (安装脚本)

# 1. 放置二进制
sudo cp k3s /usr/local/bin/
sudo chmod +x /usr/local/bin/k3s

# 2. 创建镜像目录并解压
sudo mkdir -p /var/lib/rancher/k3s/agent/images/
sudo cp k3s-airgap-images-amd64.tar.gz /var/lib/rancher/k3s/agent/images/

# 3. 运行安装脚本
INSTALL_K3S_SKIP_DOWNLOAD=true ./install.sh

# 4. 验证
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
kubectl get nodes
```

---

### K3s核心特性

#### 内置组件

**1. Traefik Ingress Controller**:

```yaml
# traefik-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
spec:
  rules:
  - host: app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-service
            port:
              number: 80
```

**禁用Traefik** (如果使用其他Ingress):

```bash
curl -sfL https://get.k3s.io | sh -s - --disable traefik
```

#### 轻量级存储 - Local Path Provisioner

**自动创建本地存储PV**:

```yaml
# local-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: local-path-pvc
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: local-path  # K3s内置
  resources:
    requests:
      storage: 10Gi
```

**存储路径**: `/var/lib/rancher/k3s/storage/`

#### 嵌入式负载均衡 - ServiceLB

**自动为LoadBalancer类型Service分配IP**:

```yaml
# loadbalancer-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-lb
spec:
  type: LoadBalancer
  selector:
    app: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
```

**原理**: Klipper-lb在所有节点上启动DaemonSet，监听分配的端口。

#### 嵌入式数据库 - SQLite/etcd

**SQLite** (默认):

- 单节点部署
- 零配置
- 自动备份到 `/var/lib/rancher/k3s/server/db/`

**嵌入式etcd** (HA):

- 高可用集群
- 自动管理
- 无需外部etcd

---

### K3s 2025新特性

#### 1. **Kubernetes 1.28+ 支持**

- Gateway API 1.0 GA
- SIG Storage增强
- Job资源改进

#### 2. **增强的离线能力**

- 镜像预加载优化
- Air-gapped安装简化

#### 3. **ARM64完全支持**

- Raspberry Pi 4/5
- NVIDIA Jetson系列
- Apple Silicon (M1/M2/M3)

#### 4. **安全增强**

- FIPS 140-2合规版本
- SELinux/AppArmor完全支持
- CIS Hardening自动化

#### 5. **集成Wasm支持**

```bash
# 安装支持Wasm的K3s
curl -sfL https://get.k3s.io | sh -s - \
  --container-runtime-endpoint unix:///run/containerd/containerd.sock

# 配置containerd支持Wasm
kubectl apply -f wasm-runtimeclass.yaml
```

---

## KubeEdge边云协同

### KubeEdge概述

**KubeEdge** 是 **华为云开源** 的 **边缘计算平台**，将 Kubernetes 的容器编排能力延伸到边缘。

**官网**: https://kubeedge.io/  
**GitHub**: https://github.com/kubeedge/kubeedge  
**CNCF状态**: Sandbox → Incubating (2020) → Graduated (2023)

**核心特点**:

- ☁️ **边云协同**: 云端Kubernetes原生管理边缘节点
- 📡 **可靠通信**: 边云消息总线，支持离线场景
- 🔌 **设备管理**: 内置Device Mapper，管理IoT设备
- 🧠 **边缘智能**: 边缘AI推理框架 (KubeEdge-Sedna)
- 🌐 **边缘自治**: 断网后边缘节点继续运行

---

### KubeEdge架构

```text
┌─────────────────────────────────────────────────────────────┐
│                        Cloud (云端)                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Kubernetes集群                                       │   │
│  │  ┌────────────────────────────────────────────────┐  │   │
│  │  │  CloudCore (KubeEdge云端组件)                  │  │   │
│  │  │  - CloudHub: WebSocket服务器                   │  │   │
│  │  │  - EdgeController: 边缘节点管理                │  │   │
│  │  │  - DeviceController: 设备管理                  │  │   │
│  │  └────────────────────────────────────────────────┘  │   │
│  │  ┌────────────────────────────────────────────────┐  │   │
│  │  │  Kubernetes API Server                         │  │   │
│  │  └────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↕ WebSocket/QUIC
┌─────────────────────────────────────────────────────────────┐
│                        Edge (边缘)                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ Edge Node 1  │  │ Edge Node 2  │  │ Edge Node 3  │      │
│  │ ┌──────────┐ │  │ ┌──────────┐ │  │ ┌──────────┐ │      │
│  │ │EdgeCore  │ │  │ │EdgeCore  │ │  │ │EdgeCore  │ │      │
│  │ │- EdgeHub │ │  │ │- EdgeHub │ │  │ │- EdgeHub │ │      │
│  │ │- Edged   │ │  │ │- Edged   │ │  │ │- Edged   │ │      │
│  │ │- MetaManager│ │ │- MetaManager│ │ │- MetaManager│ │   │
│  │ │- DeviceTwin│ │  │- DeviceTwin│ │  │- DeviceTwin│ │    │
│  │ └──────────┘ │  │ └──────────┘ │  │ └──────────┘ │      │
│  │ containerd   │  │ containerd   │  │ containerd   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│         ↕                 ↕                 ↕                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  IoT设备      │  │  传感器       │  │  摄像头       │      │
│  │  (MQTT/Modbus)│  │              │  │              │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

**核心组件**:

**云端 (CloudCore)**:

- **CloudHub**: 边云通信服务器 (WebSocket/QUIC)
- **EdgeController**: 同步K8s资源到边缘
- **DeviceController**: 设备CRD管理

**边缘 (EdgeCore)**:

- **EdgeHub**: 边云通信客户端
- **Edged**: 轻量级Kubelet，管理容器生命周期
- **MetaManager**: 本地元数据存储 (SQLite)，实现边缘自治
- **DeviceTwin**: 设备状态同步

---

### KubeEdge安装部署

#### 云端安装 (CloudCore)

```bash
#!/bin/bash
# install-kubeedge-cloud.sh - KubeEdge云端安装 (2025)

set -e

echo "=== KubeEdge CloudCore安装 ==="

# 前提: 已有Kubernetes集群 (1.24+)

# 1. 安装keadm (KubeEdge管理工具)
echo "1. 下载keadm..."
KUBEEDGE_VERSION="v1.15.0"
wget https://github.com/kubeedge/kubeedge/releases/download/${KUBEEDGE_VERSION}/keadm-${KUBEEDGE_VERSION}-linux-amd64.tar.gz
tar -zxvf keadm-${KUBEEDGE_VERSION}-linux-amd64.tar.gz
sudo cp keadm-${KUBEEDGE_VERSION}-linux-amd64/keadm/keadm /usr/local/bin/
sudo chmod +x /usr/local/bin/keadm

# 2. 初始化CloudCore
echo "2. 初始化CloudCore..."
sudo keadm init --advertise-address="<云端公网IP>" --profile version=${KUBEEDGE_VERSION}

# 3. 验证CloudCore
echo "3. 验证CloudCore..."
kubectl get pods -n kubeedge

# 4. 获取边缘节点Token
echo "4. 获取边缘节点Token..."
sudo keadm gettoken

# 输出示例:
# eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

echo ""
echo "=== CloudCore安装完成 ==="
echo "Token (保存用于边缘节点加入):"
sudo keadm gettoken
```

#### 边缘节点安装 (EdgeCore)

```bash
#!/bin/bash
# install-kubeedge-edge.sh - KubeEdge边缘节点安装

set -e

echo "=== KubeEdge EdgeCore安装 ==="

# 1. 下载keadm
echo "1. 下载keadm..."
KUBEEDGE_VERSION="v1.15.0"
wget https://github.com/kubeedge/kubeedge/releases/download/${KUBEEDGE_VERSION}/keadm-${KUBEEDGE_VERSION}-linux-amd64.tar.gz
tar -zxvf keadm-${KUBEEDGE_VERSION}-linux-amd64.tar.gz
sudo cp keadm-${KUBEEDGE_VERSION}-linux-amd64/keadm/keadm /usr/local/bin/
sudo chmod +x /usr/local/bin/keadm

# 2. 加入边缘节点
echo "2. 加入边缘节点..."
sudo keadm join \
  --cloudcore-ipport=<云端IP>:10000 \
  --edgenode-name=edge-node-1 \
  --token=<从云端获取的Token> \
  --cgroupdriver=systemd

# 3. 验证EdgeCore
echo "3. 验证EdgeCore..."
sudo systemctl status edgecore

# 4. 在云端验证节点加入
echo "4. 在云端验证 (在云端执行):"
echo "kubectl get nodes"

echo ""
echo "=== EdgeCore安装完成 ==="
```

---

### KubeEdge核心特性

#### 边云消息路由

**可靠通信机制**:

```text
云端 (K8s API) → EdgeController → CloudHub (WebSocket) → EdgeHub → Edged → 容器
                                        ↓
                                  MetaManager (本地缓存)
                                        ↓
                                  离线自治运行
```

**特点**:

- WebSocket长连接 (支持QUIC协议)
- 断线重连自动处理
- 消息持久化队列
- 边缘本地缓存

#### 设备管理 (Device Mapper)

**1. 定义设备模型**:

```yaml
# device-model.yaml
apiVersion: devices.kubeedge.io/v1alpha2
kind: DeviceModel
metadata:
  name: temperature-sensor-model
  namespace: default
spec:
  properties:
  - name: temperature
    description: "Temperature in Celsius"
    type:
      int:
        accessMode: ReadOnly
        minimum: -50
        maximum: 100
        unit: "Celsius"
  - name: humidity
    description: "Humidity percentage"
    type:
      int:
        accessMode: ReadOnly
        minimum: 0
        maximum: 100
        unit: "percent"
```

**2. 定义设备实例**:

```yaml
# device-instance.yaml
apiVersion: devices.kubeedge.io/v1alpha2
kind: Device
metadata:
  name: sensor-01
  namespace: default
spec:
  deviceModelRef:
    name: temperature-sensor-model
  nodeSelector:
    nodeSelectorTerms:
    - matchExpressions:
      - key: kubernetes.io/hostname
        operator: In
        values:
        - edge-node-1
  protocol:
    modbus:
      slaveID: 1
    common:
      com:
        serialPort: "/dev/ttyUSB0"
        baudRate: 9600
        dataBits: 8
        parity: "none"
        stopBits: 1
```

**3. Device Mapper实现**:

支持的协议:

- **MQTT** (常用于IoT)
- **Modbus** (工业设备)
- **OPC-UA** (工业自动化)
- **Bluetooth** (蓝牙设备)
- **自定义Mapper**

**查询设备状态**:

```bash
# 查看设备列表
kubectl get devices -n default

# 查看设备详情
kubectl describe device sensor-01

# 查看设备上报的数据
kubectl get device sensor-01 -o jsonpath='{.status.twins}'
```

#### 边缘自治

**离线运行能力**:

```yaml
# edge-autonomous-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: edge-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: edge-app
  template:
    metadata:
      labels:
        app: edge-app
    spec:
      nodeSelector:
        node-role.kubernetes.io/edge: ""
      containers:
      - name: app
        image: nginx:alpine
        imagePullPolicy: IfNotPresent  # 使用本地镜像
```

**自治机制**:

1. **本地缓存**: MetaManager缓存Pod、Service等元数据到SQLite
2. **镜像预拉取**: 提前拉取镜像到边缘节点
3. **断网运行**: 边缘节点断网后，基于本地缓存继续运行
4. **自动恢复**: 网络恢复后，自动同步状态到云端

---

### KubeEdge 2025新特性

#### 1. **KubeEdge 1.15+ 新特性**

- ✅ **QUIC协议支持**: 比WebSocket更可靠、低延迟
- ✅ **边缘原生Service**: 边缘节点间服务发现
- ✅ **设备管理增强**: 支持更多IoT协议
- ✅ **边缘AI框架**: Sedna 0.6+ (联邦学习、增量学习)

#### 2. **边缘原生Service**

```yaml
# edge-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: edge-service
  annotations:
    service.kubeedge.io/edge-native: "true"  # 边缘原生Service
spec:
  selector:
    app: edge-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
```

#### 3. **边缘AI - Sedna**

**联邦学习示例**:

```yaml
# federated-learning-job.yaml
apiVersion: sedna.io/v1alpha1
kind: FederatedLearningJob
metadata:
  name: federated-learning-demo
spec:
  aggregationWorker:
    model:
      name: "federated-model"
    template:
      spec:
        containers:
        - name: agg-worker
          image: kubeedge/sedna-example-federated-learning-aggregation-worker:v0.6.0
  trainingWorkers:
  - model:
      name: "model-1"
    template:
      spec:
        nodeName: edge-node-1
        containers:
        - name: train-worker
          image: kubeedge/sedna-example-federated-learning-train-worker:v0.6.0
  - model:
      name: "model-2"
    template:
      spec:
        nodeName: edge-node-2
        containers:
        - name: train-worker
          image: kubeedge/sedna-example-federated-learning-train-worker:v0.6.0
```

---

## OpenYurt边缘自治

### OpenYurt概述

**OpenYurt** 是 **阿里云开源** 的边缘计算平台，通过**非侵入式**方式将原生Kubernetes扩展到边缘。

**官网**: https://openyurt.io/  
**GitHub**: https://github.com/openyurtio/openyurt  
**CNCF状态**: Sandbox (2020)

**核心特点**:

- 🔧 **非侵入式**: 不修改Kubernetes核心组件
- 🌐 **边缘自治**: YurtHub本地缓存，断网可用
- 📦 **节点池管理**: UnitedDeployment统一管理多地域边缘节点
- 🔀 **流量拓扑**: 流量闭环，减少边云通信
- 🎯 **原生兼容**: 100%兼容Kubernetes API

---

### OpenYurt架构

```text
┌─────────────────────────────────────────────────────────────┐
│                        Cloud (云端)                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Kubernetes集群                                       │   │
│  │  ┌────────────────────────────────────────────────┐  │   │
│  │  │  Yurt-App-Manager                              │  │   │
│  │  │  - UnitedDeployment CRD (多地域部署)          │  │   │
│  │  │  - NodePool CRD (节点池管理)                   │  │   │
│  │  └────────────────────────────────────────────────┘  │   │
│  │  ┌────────────────────────────────────────────────┐  │   │
│  │  │  Yurt-Controller-Manager                       │  │   │
│  │  └────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────┐
│                        Edge (边缘)                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ Edge Node 1  │  │ Edge Node 2  │  │ Edge Node 3  │      │
│  │ ┌──────────┐ │  │ ┌──────────┐ │  │ ┌──────────┐ │      │
│  │ │ YurtHub  │ │  │ │ YurtHub  │ │  │ │ YurtHub  │ │      │
│  │ │(本地代理)│ │  │ │(本地代理)│ │  │ │(本地代理)│ │      │
│  │ └──────────┘ │  │ └──────────┘ │  │ └──────────┘ │      │
│  │     ↕        │  │     ↕        │  │     ↕        │      │
│  │ ┌──────────┐ │  │ ┌──────────┐ │  │ ┌──────────┐ │      │
│  │ │ Kubelet  │ │  │ │ Kubelet  │  │  │ │ Kubelet  │ │      │
│  │ └──────────┘ │  │ └──────────┘ │  │ └──────────┘ │      │
│  │ containerd   │  │ containerd   │  │ containerd   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

**核心组件**:

- **YurtHub**: 边缘节点本地代理，缓存云端数据，实现边缘自治
- **Yurt-Controller-Manager**: 边缘控制器管理
- **Yurt-App-Manager**: 节点池和UnitedDeployment管理

---

### OpenYurt安装部署

```bash
#!/bin/bash
# install-openyurt.sh - OpenYurt安装 (2025)

set -e

echo "=== OpenYurt安装 ==="

# 前提: 已有Kubernetes集群 (1.24+)

# 1. 安装yurtadm
echo "1. 下载yurtadm..."
OPENYURT_VERSION="v1.4.0"
wget https://github.com/openyurtio/openyurt/releases/download/${OPENYURT_VERSION}/yurtadm
sudo chmod +x yurtadm
sudo mv yurtadm /usr/local/bin/

# 2. 转换Kubernetes集群为OpenYurt集群
echo "2. 转换为OpenYurt集群..."
sudo yurtadm convert --cloud-nodes <cloud-node-name> \
  --provider kubeadm

# 3. 验证安装
echo "3. 验证OpenYurt组件..."
kubectl get pods -n kube-system | grep yurt

# 4. 标记边缘节点
echo "4. 标记边缘节点..."
kubectl label node <edge-node-name> openyurt.io/is-edge-worker=true

# 5. 创建节点池
echo "5. 创建节点池..."
cat <<EOF | kubectl apply -f -
apiVersion: apps.openyurt.io/v1beta1
kind: NodePool
metadata:
  name: beijing
spec:
  selector:
    matchLabels:
      region: beijing
  type: Edge
EOF

# 6. 验证节点池
kubectl get nodepools

echo ""
echo "=== OpenYurt安装完成 ==="
```

---

### OpenYurt核心特性

#### 1. **YurtHub本地代理**

**工作原理**:

```text
Kubelet → YurtHub (本地代理) → Kubernetes API Server
              ↓
         本地缓存 (边缘自治)
```

**特点**:

- 透明代理Kubelet请求
- 本地缓存Pod、ConfigMap、Secret等资源
- 断网后基于缓存运行

#### 2. **节点池 (NodePool)**

```yaml
# nodepool.yaml
apiVersion: apps.openyurt.io/v1beta1
kind: NodePool
metadata:
  name: hangzhou
spec:
  selector:
    matchLabels:
      region: hangzhou
  type: Edge
  taints:
  - key: node-role.openyurt.io/edge
    effect: NoSchedule
```

#### 3. **UnitedDeployment多地域部署**

```yaml
# united-deployment.yaml
apiVersion: apps.openyurt.io/v1beta1
kind: UnitedDeployment
metadata:
  name: multi-region-app
  namespace: default
spec:
  selector:
    matchLabels:
      app: nginx
  workloadTemplate:
    deploymentTemplate:
      metadata:
        labels:
          app: nginx
      spec:
        template:
          metadata:
            labels:
              app: nginx
          spec:
            containers:
            - name: nginx
              image: nginx:alpine
  topology:
    pools:
    - name: beijing
      nodeSelectorTerm:
        matchExpressions:
        - key: region
          operator: In
          values:
          - beijing
      replicas: 2
    - name: shanghai
      nodeSelectorTerm:
        matchExpressions:
        - key: region
          operator: In
          values:
          - shanghai
      replicas: 3
```

**效果**: 自动在北京节点池部署2个副本，上海节点池部署3个副本。

#### 4. **流量拓扑 (ServiceTopology)**

```yaml
# service-topology.yaml
apiVersion: v1
kind: Service
metadata:
  name: app-service
  annotations:
    openyurt.io/topologyKeys: "openyurt.io/nodepool"
spec:
  selector:
    app: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
```

**效果**: 同一节点池内的Pod访问Service时，流量只路由到本节点池的Endpoint，不跨节点池。

---

### OpenYurt 2025新特性

#### 1. **OpenYurt 1.4+ 新特性**

- ✅ **Kubernetes 1.28支持**
- ✅ **YurtHub性能优化** (缓存命中率>99%)
- ✅ **边缘Ingress**: YurtIngress Controller
- ✅ **边缘存储**: YurtStorage (CSI插件)

#### 2. **边缘Ingress**

```yaml
# yurt-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: edge-ingress
  annotations:
    openyurt.io/nodepool: "beijing"  # 仅在北京节点池生效
spec:
  rules:
  - host: app.beijing.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-service
            port:
              number: 80
```

---

## 边缘计算技术对比

### K3s vs KubeEdge vs OpenYurt

| 维度 | K3s | KubeEdge | OpenYurt |
|-----|-----|---------|---------|
| **定位** | 轻量级K8s | 边云协同平台 | 边缘自治平台 |
| **架构** | 独立K8s集群 | 云边协同 | 云边协同 |
| **侵入性** | 无 (独立) | 低 (边缘组件) | 极低 (透明代理) |
| **设备管理** | ❌ | ✅ (Device Mapper) | ❌ |
| **边缘AI** | ❌ | ✅ (Sedna) | ❌ |
| **边缘自治** | ✅ (本地集群) | ✅ (MetaManager) | ✅ (YurtHub) |
| **节点池** | ❌ | ❌ | ✅ (NodePool) |
| **资源占用** | 极低 (<512MB) | 中 (1-2GB) | 中 (1-2GB) |
| **安装复杂度** | ⭐ (极简) | ⭐⭐⭐ (复杂) | ⭐⭐ (中等) |
| **适用场景** | 边缘独立集群 | IoT设备管理 | 多地域边缘 |

---

### 选型建议

#### 使用K3s的场景

✅ **边缘独立Kubernetes集群**

- 边缘节点算力充足 (>2核4GB)
- 需要完整Kubernetes功能
- 边缘场景相对独立，不需要云端管理

**典型案例**:

- CDN边缘节点
- 零售门店系统
- 工厂车间独立集群

#### 使用KubeEdge的场景

✅ **边云协同 + IoT设备管理**

- 大量IoT设备需要管理 (MQTT/Modbus/OPC-UA)
- 需要边缘AI能力 (联邦学习、增量学习)
- 网络不稳定，需要强边缘自治

**典型案例**:

- 智慧城市 (摄像头、传感器)
- 工业互联网 (设备监控)
- 车联网 (V2X)

#### 使用OpenYurt的场景

✅ **多地域边缘节点池管理**

- 已有Kubernetes集群，希望扩展到边缘
- 多地域边缘节点统一管理
- 需要流量拓扑优化

**典型案例**:

- 多地域CDN
- 连锁零售 (多门店)
- 多园区工厂

---

## 边缘计算最佳实践

### 网络优化

#### 1. **边云网络优化**

```yaml
# quic-protocol.yaml (KubeEdge)
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudcore
  namespace: kubeedge
data:
  cloudcore.yaml: |
    modules:
      cloudHub:
        quic:
          enable: true
          port: 10001
          maxIncomingStreams: 10000
        websocket:
          enable: true
          port: 10000
```

#### 2. **边缘服务拓扑**

```yaml
# service-topology-policy.yaml (OpenYurt)
apiVersion: v1
kind: Service
metadata:
  name: database-service
  annotations:
    openyurt.io/topologyKeys: "openyurt.io/nodepool,kubernetes.io/hostname"
spec:
  selector:
    app: database
  ports:
  - port: 3306
```

### 资源管理

#### 1. **边缘节点资源预留**

```yaml
# kubelet-config.yaml
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
systemReserved:
  cpu: "500m"
  memory: "512Mi"
kubeReserved:
  cpu: "500m"
  memory: "512Mi"
evictionHard:
  memory.available: "256Mi"
  nodefs.available: "10%"
```

#### 2. **边缘Pod资源限制**

```yaml
# edge-pod-resources.yaml
apiVersion: v1
kind: Pod
metadata:
  name: edge-app
spec:
  containers:
  - name: app
    image: nginx:alpine
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
```

### 安全加固

#### 1. **边缘节点TLS加固**

```bash
# 生成边缘节点证书
sudo keadm join \
  --cloudcore-ipport=<云端IP>:10000 \
  --edgenode-name=edge-node-1 \
  --token=<Token> \
  --certPath=/etc/kubeedge/certs \
  --cgroupdriver=systemd
```

#### 2. **NetworkPolicy隔离**

```yaml
# edge-network-policy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: edge-isolation
  namespace: edge-apps
spec:
  podSelector:
    matchLabels:
      tier: edge
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: edge
  egress:
  - to:
    - podSelector:
        matchLabels:
          tier: edge
```

### 监控运维

#### 1. **边缘节点监控 (Prometheus)**

```yaml
# edge-node-exporter.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-exporter
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: node-exporter
  template:
    metadata:
      labels:
        app: node-exporter
    spec:
      hostNetwork: true
      hostPID: true
      containers:
      - name: node-exporter
        image: prom/node-exporter:latest
        args:
        - --path.procfs=/host/proc
        - --path.sysfs=/host/sys
        - --collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)
        ports:
        - containerPort: 9100
        volumeMounts:
        - name: proc
          mountPath: /host/proc
          readOnly: true
        - name: sys
          mountPath: /host/sys
          readOnly: true
      volumes:
      - name: proc
        hostPath:
          path: /proc
      - name: sys
        hostPath:
          path: /sys
```

#### 2. **边缘日志收集 (Fluent Bit)**

```yaml
# fluent-bit-edge.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-config
  namespace: logging
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush         5
        Daemon        off
        Log_Level     info
        
    [INPUT]
        Name              tail
        Path              /var/log/containers/*.log
        Parser            docker
        Tag               kube.*
        Refresh_Interval  5
        
    [FILTER]
        Name                kubernetes
        Match               kube.*
        Kube_URL            https://kubernetes.default.svc:443
        Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
        
    [OUTPUT]
        Name   forward
        Match  *
        Host   loki.monitoring.svc
        Port   24224
```

---

## 边缘计算生产案例

### 案例1：5G MEC边缘计算

**背景**: 某运营商5G网络边缘计算部署

**架构**:

```text
┌──────────────────────────────────────────────────┐
│  中心云 (Regional DC)                             │
│  - Kubernetes 1.28                                │
│  - KubeEdge CloudCore                             │
│  - 流量分析、计费、运营                            │
└──────────────────────────────────────────────────┘
                    ↕
┌──────────────────────────────────────────────────┐
│  5G MEC边缘节点 (每个基站)                        │
│  - K3s / KubeEdge EdgeCore                        │
│  - 边缘应用: AR/VR、云游戏、视频分析               │
│  - 延迟: <10ms                                    │
└──────────────────────────────────────────────────┘
```

**技术选型**:

- **边缘平台**: KubeEdge (边云协同)
- **轻量化**: K3s (资源受限基站)
- **网络**: QUIC协议 (5G网络)
- **监控**: Prometheus + Grafana

**效果**:

- ✅ 延迟降低: 100ms → 5ms
- ✅ 带宽节省: 90%流量本地处理
- ✅ 用户体验: AR/VR卡顿率降低95%

---

### 案例2：IoT设备管理

**背景**: 智慧工厂设备监控与预测性维护

**架构**:

```text
┌──────────────────────────────────────────────────┐
│  云端 (Central Cloud)                             │
│  - Kubernetes集群                                 │
│  - KubeEdge CloudCore + DeviceController          │
│  - 数据湖、AI模型训练                             │
└──────────────────────────────────────────────────┘
                    ↕
┌──────────────────────────────────────────────────┐
│  工厂边缘节点                                      │
│  - KubeEdge EdgeCore                              │
│  - Sedna边缘AI推理                                │
│  - Device Mapper (MQTT/Modbus)                    │
└──────────────────────────────────────────────────┘
                    ↕
┌──────────────────────────────────────────────────┐
│  IoT设备                                          │
│  - PLC控制器 (Modbus)                             │
│  - 传感器 (MQTT)                                  │
│  - 机器人 (OPC-UA)                                │
└──────────────────────────────────────────────────┘
```

**技术选型**:

- **边缘平台**: KubeEdge (设备管理)
- **设备协议**: MQTT、Modbus、OPC-UA
- **边缘AI**: Sedna (异常检测模型)
- **数据存储**: TimescaleDB (时序数据)

**效果**:

- ✅ 设备监控: 10000+设备实时监控
- ✅ 预测维护: 设备故障率降低60%
- ✅ 数据本地化: 满足工业数据安全合规

---

### 案例3：CDN边缘节点

**背景**: 视频CDN边缘缓存与加速

**架构**:

```text
┌──────────────────────────────────────────────────┐
│  中心云                                           │
│  - Kubernetes集群                                 │
│  - OpenYurt Yurt-App-Manager                      │
│  - 源站存储、内容管理                             │
└──────────────────────────────────────────────────┘
                    ↕
┌──────────────────────────────────────────────────┐
│  边缘节点池 (多地域)                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐ │
│  │ 北京节点池 │  │ 上海节点池 │  │ 广州节点池 │ │
│  │ - K3s      │  │ - K3s      │  │ - K3s      │ │
│  │ - Nginx    │  │ - Nginx    │  │ - Nginx    │ │
│  │ - 本地缓存 │  │ - 本地缓存 │  │ - 本地缓存 │ │
│  └────────────┘  └────────────┘  └────────────┘ │
└──────────────────────────────────────────────────┘
```

**技术选型**:

- **边缘平台**: K3s (独立轻量集群)
- **节点管理**: OpenYurt UnitedDeployment (可选)
- **缓存**: Nginx + Redis
- **存储**: Local Path Provisioner

**效果**:

- ✅ 延迟降低: 200ms → 20ms
- ✅ 回源率: <5% (95%命中率)
- ✅ 成本节省: 带宽成本降低80%

---

## 边缘计算未来趋势

### 1. **边缘原生 (Edge Native)**

- 专为边缘设计的应用架构
- 轻量级容器 + WebAssembly
- 边缘函数计算 (FaaS)

### 2. **边缘AI主流化**

- 模型压缩技术成熟
- 边缘推理芯片普及 (NPU)
- 联邦学习标准化

### 3. **5G + 边缘计算融合**

- MEC成为5G标准配置
- 超低延迟应用爆发 (AR/VR/自动驾驶)
- 网络切片 + 边缘计算

### 4. **边缘安全增强**

- 零信任架构下沉到边缘
- 边缘TEE (可信执行环境)
- 边缘密钥管理

### 5. **边缘Serverless**

- Knative边缘版
- WebAssembly + 边缘FaaS
- 事件驱动边缘应用

---

## 相关资源

### 官方文档

- [K3s官网](https://k3s.io/)
- [KubeEdge官网](https://kubeedge.io/)
- [OpenYurt官网](https://openyurt.io/)

### GitHub仓库

- [K3s GitHub](https://github.com/k3s-io/k3s)
- [KubeEdge GitHub](https://github.com/kubeedge/kubeedge)
- [OpenYurt GitHub](https://github.com/openyurtio/openyurt)

### 社区

- [CNCF Edge Computing](https://www.cncf.io/projects/)
- [K3s Slack](https://rancher-users.slack.com/)
- [KubeEdge Slack](https://kubeedge.slack.com/)

---

**更新时间**: 2025-10-20  
**文档版本**: v1.0  
**状态**: ✅ **完成 - 2025边缘计算技术全面对齐**

---

**💡 边缘计算是云原生技术的重要延伸，K3s、KubeEdge、OpenYurt各有特色，请根据实际场景选型！**
