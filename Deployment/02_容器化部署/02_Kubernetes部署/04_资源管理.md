# Kubernetesèµ„æºç®¡ç†

> **è¿”å›**: [Kuberneteséƒ¨ç½²ç›®å½•](README.md) | [å®¹å™¨åŒ–éƒ¨ç½²é¦–é¡µ](../README.md) | [éƒ¨ç½²æŒ‡å—é¦–é¡µ](../../00_ç´¢å¼•å¯¼èˆª/README.md)

---

## ğŸ“‹ ç›®å½•

- [Kubernetesèµ„æºç®¡ç†](#kubernetesèµ„æºç®¡ç†)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. Namespaceå‘½åç©ºé—´](#1-namespaceå‘½åç©ºé—´)
  - [2. RBACæƒé™ç®¡ç†](#2-rbacæƒé™ç®¡ç†)
  - [3. ResourceQuotaèµ„æºé…é¢](#3-resourcequotaèµ„æºé…é¢)
  - [4. LimitRangeèµ„æºé™åˆ¶](#4-limitrangeèµ„æºé™åˆ¶)
  - [5. Horizontal Pod Autoscaler (HPA)](#5-horizontal-pod-autoscaler-hpa)
  - [6. Vertical Pod Autoscaler (VPA)](#6-vertical-pod-autoscaler-vpa)
  - [7. PodDisruptionBudget (PDB)](#7-poddisruptionbudget-pdb)
  - [8. èŠ‚ç‚¹ç®¡ç†](#8-èŠ‚ç‚¹ç®¡ç†)
  - [9. èµ„æºç›‘æ§](#9-èµ„æºç›‘æ§)
  - [10. æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)
  - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. Namespaceå‘½åç©ºé—´

```yaml
Namespace_Overview:
  å®šä¹‰:
    - è™šæ‹Ÿé›†ç¾¤
    - èµ„æºéš”ç¦»
    - å‘½åç©ºé—´éš”ç¦»
    - å¤šç§Ÿæˆ·æ”¯æŒ
  
  é»˜è®¤å‘½åç©ºé—´:
    default: é»˜è®¤å‘½åç©ºé—´
    kube-system: Kubernetesç³»ç»Ÿç»„ä»¶
    kube-public: å…¬å¼€èµ„æº
    kube-node-lease: èŠ‚ç‚¹å¿ƒè·³
  
  é€‚ç”¨åœºæ™¯:
    - ç¯å¢ƒéš”ç¦» (dev, test, prod)
    - å›¢é˜Ÿéš”ç¦»
    - é¡¹ç›®éš”ç¦»
    - èµ„æºé…é¢ç®¡ç†
```

**Namespaceæ“ä½œ**:

```yaml
# åˆ›å»ºNamespace
apiVersion: v1
kind: Namespace
metadata:
  name: development
  labels:
    name: development
    environment: dev

---
# å¸¦èµ„æºé…é¢çš„Namespace
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    name: production
    environment: prod
  annotations:
    owner: "ops-team@example.com"
    cost-center: "12345"
```

```bash
# å‘½ä»¤è¡Œåˆ›å»º
kubectl create namespace development

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´
kubectl get namespaces
kubectl get ns  # ç®€å†™

# æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…
kubectl describe namespace development

# è®¾ç½®é»˜è®¤å‘½åç©ºé—´
kubectl config set-context --current --namespace=development

# æŸ¥çœ‹å½“å‰å‘½åç©ºé—´
kubectl config view --minify | grep namespace:

# åˆ‡æ¢å‘½åç©ºé—´
kubectl config use-context <context-name>

# åœ¨ç‰¹å®šå‘½åç©ºé—´æ“ä½œ
kubectl get pods -n development
kubectl get all -n development

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„èµ„æº
kubectl get pods --all-namespaces
kubectl get pods -A  # ç®€å†™

# åˆ é™¤å‘½åç©ºé—´ (ä¼šåˆ é™¤æ‰€æœ‰èµ„æº)
kubectl delete namespace development
```

---

## 2. RBACæƒé™ç®¡ç†

```yaml
RBAC_Overview:
  ç»„ä»¶:
    Role: å‘½åç©ºé—´çº§åˆ«è§’è‰²
    ClusterRole: é›†ç¾¤çº§åˆ«è§’è‰²
    RoleBinding: ç»‘å®šRoleåˆ°ç”¨æˆ·
    ClusterRoleBinding: ç»‘å®šClusterRoleåˆ°ç”¨æˆ·
  
  ä¸»ä½“ (Subject):
    User: ç”¨æˆ·
    Group: ç”¨æˆ·ç»„
    ServiceAccount: æœåŠ¡è´¦å·
  
  æƒé™ (Verb):
    - get, list, watch
    - create, update, patch
    - delete, deletecollection
    - *: æ‰€æœ‰æƒé™
  
  èµ„æº (Resource):
    - pods, services, deployments
    - configmaps, secrets
    - nodes, namespaces
    - *: æ‰€æœ‰èµ„æº
```

**Roleå’ŒRoleBindingç¤ºä¾‹**:

```yaml
# Role - å‘½åç©ºé—´çº§åˆ«
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: development
  name: pod-reader
rules:
- apiGroups: [""]  # "" è¡¨ç¤ºæ ¸å¿ƒAPIç»„
  resources: ["pods"]
  verbs: ["get", "watch", "list"]
- apiGroups: [""]
  resources: ["pods/log"]
  verbs: ["get"]

---
# RoleBinding - ç»‘å®šRole
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: development
subjects:
- kind: User
  name: jane
  apiGroup: rbac.authorization.k8s.io
- kind: ServiceAccount
  name: myapp-sa
  namespace: development
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```

**ClusterRoleå’ŒClusterRoleBindingç¤ºä¾‹**:

```yaml
# ClusterRole - é›†ç¾¤çº§åˆ«
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-reader
rules:
- apiGroups: [""]
  resources: ["pods", "services", "nodes"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments", "statefulsets", "daemonsets"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["batch"]
  resources: ["jobs", "cronjobs"]
  verbs: ["get", "list", "watch"]

---
# ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-reader-binding
subjects:
- kind: Group
  name: readers
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-reader
  apiGroup: rbac.authorization.k8s.io
```

**å¸¸ç”¨æƒé™åœºæ™¯**:

```yaml
# 1. åªè¯»æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: readonly
  namespace: development
rules:
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["get", "list", "watch"]

---
# 2. å¼€å‘è€…æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer
  namespace: development
rules:
- apiGroups: ["", "apps", "batch"]
  resources: ["*"]
  verbs: ["*"]
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]  # Secretåªè¯»

---
# 3. ç®¡ç†å‘˜æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: admin
rules:
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["*"]

---
# 4. CI/CDæƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cicd
  namespace: production
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "update", "patch"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["pods/log"]
  verbs: ["get"]
```

**ServiceAccountç®¡ç†**:

```yaml
# åˆ›å»ºServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: myapp-sa
  namespace: development

---
# ä½¿ç”¨ServiceAccount
apiVersion: v1
kind: Pod
metadata:
  name: myapp
  namespace: development
spec:
  serviceAccountName: myapp-sa
  containers:
  - name: myapp
    image: myapp:v1.0
```

```bash
# åˆ›å»ºServiceAccount
kubectl create serviceaccount myapp-sa -n development

# æŸ¥çœ‹ServiceAccount
kubectl get serviceaccounts -n development
kubectl get sa -n development  # ç®€å†™

# æŸ¥çœ‹ServiceAccount Token
kubectl describe sa myapp-sa -n development

# è·å–Token
kubectl create token myapp-sa -n development

# æ£€æŸ¥æƒé™
kubectl auth can-i create pods --as=system:serviceaccount:development:myapp-sa -n development
kubectl auth can-i get secrets --as=system:serviceaccount:development:myapp-sa -n development

# æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™
kubectl auth can-i create deployments
kubectl auth can-i delete nodes
kubectl auth can-i '*' '*'  # æ˜¯å¦æœ‰æ‰€æœ‰æƒé™
```

---

## 3. ResourceQuotaèµ„æºé…é¢

```yaml
ResourceQuota_Overview:
  å®šä¹‰:
    - é™åˆ¶å‘½åç©ºé—´èµ„æºä½¿ç”¨
    - é˜²æ­¢èµ„æºæ»¥ç”¨
    - å¤šç§Ÿæˆ·èµ„æºéš”ç¦»
  
  é…é¢ç±»å‹:
    è®¡ç®—èµ„æº:
      - requests.cpu, requests.memory
      - limits.cpu, limits.memory
    
    å¯¹è±¡æ•°é‡:
      - pods, services, secrets
      - configmaps, persistentvolumeclaims
      - replicationcontrollers, deployments
    
    å­˜å‚¨èµ„æº:
      - requests.storage
      - persistentvolumeclaims
```

**ResourceQuotaç¤ºä¾‹**:

```yaml
# è®¡ç®—èµ„æºé…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: compute-quota
  namespace: development
spec:
  hard:
    requests.cpu: "10"         # æ€»CPUè¯·æ±‚
    requests.memory: 20Gi      # æ€»å†…å­˜è¯·æ±‚
    limits.cpu: "20"           # æ€»CPUé™åˆ¶
    limits.memory: 40Gi        # æ€»å†…å­˜é™åˆ¶

---
# å¯¹è±¡æ•°é‡é…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: object-quota
  namespace: development
spec:
  hard:
    pods: "50"                      # æœ€å¤š50ä¸ªPod
    services: "10"                  # æœ€å¤š10ä¸ªService
    secrets: "20"                   # æœ€å¤š20ä¸ªSecret
    configmaps: "20"                # æœ€å¤š20ä¸ªConfigMap
    persistentvolumeclaims: "10"    # æœ€å¤š10ä¸ªPVC
    replicationcontrollers: "20"    # æœ€å¤š20ä¸ªRC
    deployments.apps: "20"          # æœ€å¤š20ä¸ªDeployment
    services.loadbalancers: "2"     # æœ€å¤š2ä¸ªLB

---
# å­˜å‚¨é…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: storage-quota
  namespace: development
spec:
  hard:
    requests.storage: 100Gi                    # æ€»å­˜å‚¨è¯·æ±‚
    persistentvolumeclaims: "10"               # PVCæ•°é‡
    requests.ephemeral-storage: 10Gi           # ä¸´æ—¶å­˜å‚¨
    limits.ephemeral-storage: 20Gi             # ä¸´æ—¶å­˜å‚¨é™åˆ¶

---
# æŒ‰StorageClassé…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: storageclass-quota
  namespace: development
spec:
  hard:
    fast.storageclass.storage.k8s.io/requests.storage: 50Gi
    slow.storageclass.storage.k8s.io/requests.storage: 100Gi
    fast.storageclass.storage.k8s.io/persistentvolumeclaims: "5"
    slow.storageclass.storage.k8s.io/persistentvolumeclaims: "10"

---
# æŒ‰ä¼˜å…ˆçº§é…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: priority-quota
  namespace: development
spec:
  hard:
    pods: "50"
  scopeSelector:
    matchExpressions:
    - operator: In
      scopeName: PriorityClass
      values: ["high"]
```

**ResourceQuotaç®¡ç†**:

```bash
# åˆ›å»ºResourceQuota
kubectl apply -f resourcequota.yaml

# æŸ¥çœ‹ResourceQuota
kubectl get resourcequota -n development
kubectl get quota -n development  # ç®€å†™

# æŸ¥çœ‹è¯¦æƒ…
kubectl describe resourcequota compute-quota -n development

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl describe namespace development

# åˆ é™¤ResourceQuota
kubectl delete resourcequota compute-quota -n development
```

---

## 4. LimitRangeèµ„æºé™åˆ¶

```yaml
LimitRange_Overview:
  å®šä¹‰:
    - é™åˆ¶å•ä¸ªå¯¹è±¡èµ„æº
    - Pod/Containerçš„min/max/default
    - é˜²æ­¢èµ„æºè¯·æ±‚è¿‡å¤§æˆ–è¿‡å°
  
  é™åˆ¶ç±»å‹:
    Container:
      - CPU, Memory
      - é»˜è®¤requestså’Œlimits
    
    Pod:
      - æ€»CPU, Memory
      - æ‰€æœ‰å®¹å™¨ä¹‹å’Œ
    
    PersistentVolumeClaim:
      - å­˜å‚¨å¤§å°é™åˆ¶
```

**LimitRangeç¤ºä¾‹**:

```yaml
# Containerçº§åˆ«é™åˆ¶
apiVersion: v1
kind: LimitRange
metadata:
  name: container-limit-range
  namespace: development
spec:
  limits:
  - type: Container
    max:
      cpu: "2"          # å•ä¸ªå®¹å™¨æœ€å¤§CPU
      memory: "4Gi"     # å•ä¸ªå®¹å™¨æœ€å¤§å†…å­˜
    min:
      cpu: "100m"       # å•ä¸ªå®¹å™¨æœ€å°CPU
      memory: "128Mi"   # å•ä¸ªå®¹å™¨æœ€å°å†…å­˜
    default:
      cpu: "500m"       # é»˜è®¤limits
      memory: "512Mi"
    defaultRequest:
      cpu: "200m"       # é»˜è®¤requests
      memory: "256Mi"
    maxLimitRequestRatio:
      cpu: "4"          # limit/requestæœ€å¤§æ¯”ä¾‹
      memory: "2"

---
# Podçº§åˆ«é™åˆ¶
apiVersion: v1
kind: LimitRange
metadata:
  name: pod-limit-range
  namespace: development
spec:
  limits:
  - type: Pod
    max:
      cpu: "4"          # Podæ€»CPUé™åˆ¶
      memory: "8Gi"     # Podæ€»å†…å­˜é™åˆ¶
    min:
      cpu: "100m"
      memory: "128Mi"

---
# PVCé™åˆ¶
apiVersion: v1
kind: LimitRange
metadata:
  name: pvc-limit-range
  namespace: development
spec:
  limits:
  - type: PersistentVolumeClaim
    max:
      storage: 10Gi     # å•ä¸ªPVCæœ€å¤§å­˜å‚¨
    min:
      storage: 1Gi      # å•ä¸ªPVCæœ€å°å­˜å‚¨
```

**LimitRangeç®¡ç†**:

```bash
# åˆ›å»ºLimitRange
kubectl apply -f limitrange.yaml

# æŸ¥çœ‹LimitRange
kubectl get limitrange -n development
kubectl get limits -n development  # ç®€å†™

# æŸ¥çœ‹è¯¦æƒ…
kubectl describe limitrange container-limit-range -n development

# åˆ é™¤LimitRange
kubectl delete limitrange container-limit-range -n development
```

---

## 5. Horizontal Pod Autoscaler (HPA)

```yaml
HPA_Overview:
  å®šä¹‰:
    - æ°´å¹³Podè‡ªåŠ¨æ‰©ç¼©å®¹
    - åŸºäºæŒ‡æ ‡è‡ªåŠ¨è°ƒæ•´å‰¯æœ¬æ•°
    - æ”¯æŒCPUã€å†…å­˜ã€è‡ªå®šä¹‰æŒ‡æ ‡
  
  å·¥ä½œåŸç†:
    1. Metrics Serveræ”¶é›†æŒ‡æ ‡
    2. HPA Controllerè®¡ç®—æœŸæœ›å‰¯æœ¬æ•°
    3. è°ƒæ•´Deployment/StatefulSetå‰¯æœ¬æ•°
  
  æŒ‡æ ‡ç±»å‹:
    Resource: CPU, Memory
    Pods: è‡ªå®šä¹‰PodæŒ‡æ ‡
    Object: Kuberneteså¯¹è±¡æŒ‡æ ‡
    External: å¤–éƒ¨ç³»ç»ŸæŒ‡æ ‡
```

**å®‰è£…Metrics Server**:

```bash
# éƒ¨ç½²Metrics Server
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

# æŸ¥çœ‹Metrics Server
kubectl get deployment metrics-server -n kube-system

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æº
kubectl top nodes

# æŸ¥çœ‹Podèµ„æº
kubectl top pods -n development
```

**HPAç¤ºä¾‹**:

```yaml
# åŸºäºCPUçš„HPA
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
  namespace: development
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 80  # ç›®æ ‡CPUä½¿ç”¨ç‡80%

---
# åŸºäºCPUå’Œå†…å­˜çš„HPA
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa-multi
  namespace: development
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  minReplicas: 2
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300  # ç¼©å®¹ç¨³å®šçª—å£
      policies:
      - type: Percent
        value: 50       # æ¯æ¬¡æœ€å¤šç¼©å®¹50%
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - type: Percent
        value: 100      # æ¯æ¬¡æœ€å¤šæ‰©å®¹100%
        periodSeconds: 15
      - type: Pods
        value: 4        # æ¯æ¬¡æœ€å¤šæ‰©å®¹4ä¸ªPod
        periodSeconds: 15
      selectPolicy: Max  # é€‰æ‹©æœ€å¤§å€¼

---
# åŸºäºè‡ªå®šä¹‰æŒ‡æ ‡çš„HPA
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa-custom
  namespace: development
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  minReplicas: 3
  maxReplicas: 15
  metrics:
  - type: Pods
    pods:
      metric:
        name: http_requests_per_second
      target:
        type: AverageValue
        averageValue: "1000"  # æ¯ç§’1000ä¸ªè¯·æ±‚
```

**HPAç®¡ç†**:

```bash
# å‘½ä»¤è¡Œåˆ›å»ºHPA
kubectl autoscale deployment myapp --min=3 --max=10 --cpu-percent=80 -n development

# æŸ¥çœ‹HPA
kubectl get hpa -n development

# æŸ¥çœ‹è¯¦æƒ…
kubectl describe hpa myapp-hpa -n development

# æŸ¥çœ‹HPAäº‹ä»¶
kubectl get events -n development --field-selector involvedObject.name=myapp-hpa

# ç¼–è¾‘HPA
kubectl edit hpa myapp-hpa -n development

# åˆ é™¤HPA
kubectl delete hpa myapp-hpa -n development
```

---

## 6. Vertical Pod Autoscaler (VPA)

```yaml
VPA_Overview:
  å®šä¹‰:
    - å‚ç›´Podè‡ªåŠ¨æ‰©ç¼©å®¹
    - è‡ªåŠ¨è°ƒæ•´Podèµ„æºrequests/limits
    - ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡
  
  æ›´æ–°æ¨¡å¼:
    Off: åªæ¨èï¼Œä¸åº”ç”¨
    Initial: ä»…åˆ›å»ºæ—¶åº”ç”¨
    Recreate: åˆ é™¤é‡å»ºPod
    Auto: è‡ªåŠ¨åº”ç”¨ï¼ˆæœªæ¥ï¼‰
  
  ç»„ä»¶:
    VPA Recommender: è®¡ç®—æ¨èå€¼
    VPA Updater: æ›´æ–°Pod
    VPA Admission Controller: å‡†å…¥æ§åˆ¶
```

**å®‰è£…VPA**:

```bash
# å…‹éš†VPAä»“åº“
git clone https://github.com/kubernetes/autoscaler.git
cd autoscaler/vertical-pod-autoscaler

# å®‰è£…VPA
./hack/vpa-up.sh

# æŸ¥çœ‹VPAç»„ä»¶
kubectl get pods -n kube-system | grep vpa
```

**VPAç¤ºä¾‹**:

```yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: myapp-vpa
  namespace: development
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  updatePolicy:
    updateMode: "Auto"  # Off, Initial, Recreate, Auto
  resourcePolicy:
    containerPolicies:
    - containerName: myapp
      minAllowed:
        cpu: 100m
        memory: 128Mi
      maxAllowed:
        cpu: 2000m
        memory: 2Gi
      controlledResources: ["cpu", "memory"]
```

---

## 7. PodDisruptionBudget (PDB)

```yaml
PDB_Overview:
  å®šä¹‰:
    - é™åˆ¶åŒæ—¶ä¸å¯ç”¨çš„Podæ•°é‡
    - ä¿æŠ¤åº”ç”¨å¯ç”¨æ€§
    - è‡ªæ„¿ä¸­æ–­ä¿æŠ¤
  
  é€‚ç”¨åœºæ™¯:
    - èŠ‚ç‚¹ç»´æŠ¤
    - é›†ç¾¤å‡çº§
    - Podé©±é€
    - è‡ªåŠ¨æ‰©ç¼©å®¹
```

**PDBç¤ºä¾‹**:

```yaml
# æœ€å°å¯ç”¨å‰¯æœ¬æ•°
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: myapp-pdb
  namespace: development
spec:
  minAvailable: 2  # è‡³å°‘2ä¸ªPodå¯ç”¨
  selector:
    matchLabels:
      app: myapp

---
# æœ€å¤§ä¸å¯ç”¨å‰¯æœ¬æ•°
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: myapp-pdb-percent
  namespace: development
spec:
  maxUnavailable: 1  # æˆ– "30%" æœ€å¤š30%ä¸å¯ç”¨
  selector:
    matchLabels:
      app: myapp
```

**PDBç®¡ç†**:

```bash
# åˆ›å»ºPDB
kubectl apply -f pdb.yaml

# æŸ¥çœ‹PDB
kubectl get pdb -n development

# æŸ¥çœ‹è¯¦æƒ…
kubectl describe pdb myapp-pdb -n development

# åˆ é™¤PDB
kubectl delete pdb myapp-pdb -n development
```

---

## 8. èŠ‚ç‚¹ç®¡ç†

```yaml
Node_Management:
  èŠ‚ç‚¹æ ‡ç­¾:
    - èŠ‚ç‚¹åˆ†ç±»
    - Podè°ƒåº¦
    - nodeSelector
  
  æ±¡ç‚¹å’Œå®¹å¿:
    Taint: èŠ‚ç‚¹æ‹’ç»Pod
    Toleration: Podå®¹å¿æ±¡ç‚¹
  
  èŠ‚ç‚¹äº²å’Œæ€§:
    - ç¡¬æ€§è¦æ±‚ (required)
    - è½¯æ€§åå¥½ (preferred)
```

**èŠ‚ç‚¹æ“ä½œ**:

```bash
# æŸ¥çœ‹èŠ‚ç‚¹
kubectl get nodes
kubectl get nodes -o wide

# æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…
kubectl describe node node01

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨
kubectl top node node01

# èŠ‚ç‚¹æ ‡ç­¾ç®¡ç†
kubectl label nodes node01 disktype=ssd
kubectl label nodes node01 env=production
kubectl label nodes node01 disktype-  # åˆ é™¤æ ‡ç­¾

# æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾
kubectl get nodes --show-labels
kubectl get nodes -L disktype,env

# èŠ‚ç‚¹æ±¡ç‚¹ç®¡ç†
# æ·»åŠ æ±¡ç‚¹
kubectl taint nodes node01 key=value:NoSchedule
kubectl taint nodes node01 key=value:NoExecute
kubectl taint nodes node01 key=value:PreferNoSchedule

# åˆ é™¤æ±¡ç‚¹
kubectl taint nodes node01 key:NoSchedule-

# æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
kubectl describe node node01 | grep Taints

# èŠ‚ç‚¹ç»´æŠ¤
# æ ‡è®°ä¸å¯è°ƒåº¦
kubectl cordon node01

# é©±é€Pod
kubectl drain node01 --ignore-daemonsets --delete-emptydir-data

# æ¢å¤è°ƒåº¦
kubectl uncordon node01
```

**æ±¡ç‚¹å’Œå®¹å¿ç¤ºä¾‹**:

```yaml
# Podå®¹å¿æ±¡ç‚¹
apiVersion: v1
kind: Pod
metadata:
  name: myapp
spec:
  tolerations:
  - key: "key"
    operator: "Equal"
    value: "value"
    effect: "NoSchedule"
  - key: "key"
    operator: "Exists"
    effect: "NoExecute"
    tolerationSeconds: 3600  # å®¹å¿3600ç§’
  containers:
  - name: myapp
    image: myapp:v1.0
```

---

## 9. èµ„æºç›‘æ§

```yaml
Monitoring_Overview:
  Metrics Server:
    - kubectl topå‘½ä»¤
    - HPAæ•°æ®æº
    - åŸºç¡€æŒ‡æ ‡
  
  Prometheus:
    - å®Œæ•´ç›‘æ§æ–¹æ¡ˆ
    - è‡ªå®šä¹‰æŒ‡æ ‡
    - å‘Šè­¦è§„åˆ™
  
  å…³é”®æŒ‡æ ‡:
    èŠ‚ç‚¹:
      - CPUä½¿ç”¨ç‡
      - å†…å­˜ä½¿ç”¨ç‡
      - ç£ç›˜ä½¿ç”¨ç‡
      - ç½‘ç»œæµé‡
    
    Pod:
      - CPUä½¿ç”¨
      - å†…å­˜ä½¿ç”¨
      - é‡å¯æ¬¡æ•°
      - ç½‘ç»œæµé‡
    
    é›†ç¾¤:
      - Podæ•°é‡
      - Nodeæ•°é‡
      - API Server QPS
      - etcdå»¶è¿Ÿ
```

**ç›‘æ§å‘½ä»¤**:

```bash
# æŸ¥çœ‹èŠ‚ç‚¹èµ„æº
kubectl top nodes
kubectl top nodes --sort-by=cpu
kubectl top nodes --sort-by=memory

# æŸ¥çœ‹Podèµ„æº
kubectl top pods -n development
kubectl top pods -A --sort-by=memory
kubectl top pods --containers  # æ˜¾ç¤ºå®¹å™¨

# æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€
kubectl get componentstatuses
kubectl get cs  # ç®€å†™

# æŸ¥çœ‹API ServeræŒ‡æ ‡
kubectl get --raw /metrics | grep apiserver

# æŸ¥çœ‹äº‹ä»¶
kubectl get events -n development --sort-by='.lastTimestamp'
kubectl get events -A --watch
```

---

## 10. æœ€ä½³å®è·µ

```yaml
Resource_Management_Best_Practices:
  å‘½åç©ºé—´:
    âœ… æŒ‰ç¯å¢ƒéš”ç¦»: dev, test, prod
    âœ… æŒ‰å›¢é˜Ÿéš”ç¦»: team-a, team-b
    âœ… è®¾ç½®ResourceQuotaå’ŒLimitRange
    âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å’Œæ³¨è§£
  
  RBAC:
    âœ… æœ€å°æƒé™åŸåˆ™
    âœ… ä½¿ç”¨ServiceAccountè€ŒéUser
    âœ… å®šæœŸå®¡è®¡æƒé™
    âœ… ç¦ç”¨åŒ¿åè®¿é—®
  
  èµ„æºé…é¢:
    âœ… æ‰€æœ‰å‘½åç©ºé—´è®¾ç½®ResourceQuota
    âœ… é¢„ç•™10-20%ç¼“å†²
    âœ… ç›‘æ§é…é¢ä½¿ç”¨ç‡
    âœ… å®šæœŸè°ƒæ•´é…é¢
  
  èµ„æºè¯·æ±‚å’Œé™åˆ¶:
    âœ… å§‹ç»ˆè®¾ç½®requestså’Œlimits
    âœ… requests = åº”ç”¨ç¨³å®šè¿è¡Œæ‰€éœ€
    âœ… limits = åº”ç”¨å³°å€¼æ‰€éœ€
    âœ… é¿å…è¿‡åº¦åˆ†é…
  
  è‡ªåŠ¨æ‰©ç¼©å®¹:
    âœ… ä½¿ç”¨HPAåº”å¯¹æµé‡æ³¢åŠ¨
    âœ… è®¾ç½®åˆç†çš„min/max
    âœ… é…ç½®æ‰©ç¼©å®¹ç­–ç•¥ï¼ˆbehaviorï¼‰
    âœ… ç›‘æ§æ‰©ç¼©å®¹äº‹ä»¶
  
  é«˜å¯ç”¨:
    âœ… è®¾ç½®PodDisruptionBudget
    âœ… å¤šå‰¯æœ¬éƒ¨ç½²
    âœ… è·¨å¯ç”¨åŒºåˆ†å¸ƒ
    âœ… åäº²å’Œæ€§è§„åˆ™
  
  ç›‘æ§å‘Šè­¦:
    âœ… ç›‘æ§èµ„æºä½¿ç”¨ç‡
    âœ… ç›‘æ§é…é¢ä½¿ç”¨æƒ…å†µ
    âœ… é…ç½®å‘Šè­¦è§„åˆ™
    âœ… å®šæœŸå®¡æŸ¥ç›‘æ§æ•°æ®
```

---

## ç›¸å…³æ–‡æ¡£

- [Kubernetesé›†ç¾¤éƒ¨ç½²](01_é›†ç¾¤éƒ¨ç½².md)
- [Kubernetesæ ¸å¿ƒç»„ä»¶](02_æ ¸å¿ƒç»„ä»¶.md)
- [Kubernetesåº”ç”¨éƒ¨ç½²](03_åº”ç”¨éƒ¨ç½².md)
- [Kubernetesæ•…éšœæ’æŸ¥](05_æ•…éšœæ’æŸ¥.md)
- [Kubernetesé«˜å¯ç”¨æ¶æ„](../../01_è™šæ‹ŸåŒ–éƒ¨ç½²/05_é«˜å¯ç”¨å®¹ç¾/02_Kubernetesé«˜å¯ç”¨æ¶æ„.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
