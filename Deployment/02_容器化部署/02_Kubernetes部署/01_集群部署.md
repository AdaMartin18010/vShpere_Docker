# Kubernetesé›†ç¾¤éƒ¨ç½²

> **è¿”å›**: [Kuberneteséƒ¨ç½²ç›®å½•](README.md) | [å®¹å™¨åŒ–éƒ¨ç½²é¦–é¡µ](../README.md) | [éƒ¨ç½²æŒ‡å—é¦–é¡µ](../../00_ç´¢å¼•å¯¼èˆª/README.md)

---

## ğŸ“‹ ç›®å½•

- [Kubernetesé›†ç¾¤éƒ¨ç½²](#kubernetesé›†ç¾¤éƒ¨ç½²)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. Kubernetesæ¦‚è¿°](#1-kubernetesæ¦‚è¿°)
  - [2. éƒ¨ç½²å‰å‡†å¤‡](#2-éƒ¨ç½²å‰å‡†å¤‡)
  - [3. kubeadméƒ¨ç½²](#3-kubeadméƒ¨ç½²)
    - [3.1 å•MasterèŠ‚ç‚¹éƒ¨ç½²](#31-å•masterèŠ‚ç‚¹éƒ¨ç½²)
    - [3.2 é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²](#32-é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²)
  - [4. äºŒè¿›åˆ¶éƒ¨ç½²](#4-äºŒè¿›åˆ¶éƒ¨ç½²)
  - [5. äº‘å‚å•†æ‰˜ç®¡Kubernetes](#5-äº‘å‚å•†æ‰˜ç®¡kubernetes)
  - [6. è½»é‡çº§Kubernetes](#6-è½»é‡çº§kubernetes)
  - [7. é›†ç¾¤éªŒè¯](#7-é›†ç¾¤éªŒè¯)
  - [8. éƒ¨ç½²æœ€ä½³å®è·µ](#8-éƒ¨ç½²æœ€ä½³å®è·µ)
  - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. Kubernetesæ¦‚è¿°

```yaml
Kubernetes_Overview:
  å®šä¹‰:
    - å®¹å™¨ç¼–æ’å¹³å°
    - è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨
    - Googleå¼€æºï¼ŒCNCFæ‰˜ç®¡
    - å¸Œè…Šè¯­ï¼šèˆµæ‰‹ã€é£è¡Œå‘˜
  
  æ ¸å¿ƒæ¶æ„:
    Control Plane (æ§åˆ¶å¹³é¢):
      kube-apiserver:
        - é›†ç¾¤APIå…¥å£
        - RESTful API
        - è®¤è¯ã€æˆæƒã€å‡†å…¥æ§åˆ¶
      
      etcd:
        - åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨
        - é›†ç¾¤æ•°æ®æŒä¹…åŒ–
        - ä¸€è‡´æ€§ä¿è¯
      
      kube-scheduler:
        - Podè°ƒåº¦å™¨
        - èµ„æºåŒ¹é…
        - è°ƒåº¦ç­–ç•¥
      
      kube-controller-manager:
        - æ§åˆ¶å™¨ç®¡ç†å™¨
        - Node Controller
        - Replication Controller
        - Endpoints Controller
        - Service Account Controller
      
      cloud-controller-manager (å¯é€‰):
        - äº‘å¹³å°é›†æˆ
        - Nodeã€Routeã€Serviceç®¡ç†
    
    Node (å·¥ä½œèŠ‚ç‚¹):
      kubelet:
        - èŠ‚ç‚¹ä»£ç†
        - Podç”Ÿå‘½å‘¨æœŸç®¡ç†
        - å®¹å™¨å¥åº·æ£€æŸ¥
      
      kube-proxy:
        - ç½‘ç»œä»£ç†
        - æœåŠ¡è´Ÿè½½å‡è¡¡
        - iptables/ipvsè§„åˆ™
      
      Container Runtime:
        - Docker
        - containerd (æ¨è)
        - CRI-O
  
  æ ¸å¿ƒæ¦‚å¿µ:
    Pod: æœ€å°éƒ¨ç½²å•å…ƒ
    Deployment: æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²
    StatefulSet: æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²
    DaemonSet: æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªPod
    Service: æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
    Ingress: HTTP/HTTPSè·¯ç”±
    ConfigMap: é…ç½®ç®¡ç†
    Secret: å¯†é’¥ç®¡ç†
    PersistentVolume: æŒä¹…åŒ–å­˜å‚¨
    Namespace: å‘½åç©ºé—´éš”ç¦»
  
  ç‰ˆæœ¬è¯´æ˜:
    å½“å‰ç¨³å®šç‰ˆ: v1.28
    æ¨èç‰ˆæœ¬: v1.27.x (LTS)
    æ”¯æŒå‘¨æœŸ: çº¦14ä¸ªæœˆ
    å‡çº§ç­–ç•¥: å°ç‰ˆæœ¬é€æ­¥å‡çº§
```

---

## 2. éƒ¨ç½²å‰å‡†å¤‡

```yaml
Pre_Deployment_Checklist:
  ç¡¬ä»¶è¦æ±‚:
    MasterèŠ‚ç‚¹:
      æœ€å°é…ç½®:
        CPU: 2æ ¸
        å†…å­˜: 4GB
        ç£ç›˜: 50GB
      
      æ¨èé…ç½®:
        CPU: 4æ ¸+
        å†…å­˜: 8GB+
        ç£ç›˜: 100GB+ SSD
    
    WorkerèŠ‚ç‚¹:
      æœ€å°é…ç½®:
        CPU: 2æ ¸
        å†…å­˜: 4GB
        ç£ç›˜: 50GB
      
      æ¨èé…ç½®:
        CPU: 8æ ¸+
        å†…å­˜: 16GB+
        ç£ç›˜: 200GB+ SSD
    
    etcdèŠ‚ç‚¹ (ç‹¬ç«‹éƒ¨ç½²æ—¶):
      CPU: 2æ ¸+
      å†…å­˜: 8GB+
      ç£ç›˜: 50GB+ SSD (ä½å»¶è¿Ÿ)
  
  æ“ä½œç³»ç»Ÿè¦æ±‚:
    æ¨èç³»ç»Ÿ:
      - Ubuntu 20.04 LTS / 22.04 LTS
      - CentOS Stream 8 / 9
      - RHEL 8 / 9
      - Rocky Linux 8 / 9
      - éº’éºŸ V10
      - openEuler 20.03 LTS / 22.03 LTS
    
    å†…æ ¸è¦æ±‚:
      æœ€ä½: 4.19
      æ¨è: 5.4+
  
  ç½‘ç»œè¦æ±‚:
    èŠ‚ç‚¹é—´ç½‘ç»œ:
      - å»¶è¿Ÿ < 10ms (åŒæ•°æ®ä¸­å¿ƒ)
      - å¸¦å®½ >= 1Gbps
      - æ‰€æœ‰èŠ‚ç‚¹äº’é€š
    
    ç«¯å£è¦æ±‚:
      MasterèŠ‚ç‚¹:
        - 6443: kube-apiserver
        - 2379-2380: etcd
        - 10250: kubelet
        - 10251: kube-scheduler
        - 10252: kube-controller-manager
      
      WorkerèŠ‚ç‚¹:
        - 10250: kubelet
        - 30000-32767: NodePort Services
    
    Podç½‘ç»œ:
      - 10.244.0.0/16 (Flannelé»˜è®¤)
      - 192.168.0.0/16 (Calicoé»˜è®¤)
      - å¯è‡ªå®šä¹‰
    
    Serviceç½‘ç»œ:
      - 10.96.0.0/12 (é»˜è®¤)
      - å¯è‡ªå®šä¹‰
  
  è½¯ä»¶è¦æ±‚:
    å®¹å™¨è¿è¡Œæ—¶:
      - containerd >= 1.6 (æ¨è)
      - Docker >= 20.10
      - CRI-O >= 1.24
    
    å¿…éœ€å·¥å…·:
      - kubeadm
      - kubelet
      - kubectl
    
    å¯é€‰å·¥å…·:
      - Helm >= 3.0
      - ctr / crictl
```

**ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬**:

```bash
#!/bin/bash
# ========================================
# KubernetesèŠ‚ç‚¹ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
# ========================================

set -e

echo "===== KubernetesèŠ‚ç‚¹åˆå§‹åŒ– ====="

# 1. å…³é—­é˜²ç«å¢™ (æˆ–é…ç½®è§„åˆ™)
systemctl stop firewalld
systemctl disable firewalld

# 2. å…³é—­SELinux
setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

# 3. å…³é—­swap
swapoff -a
sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab

# 4. é…ç½®å†…æ ¸å‚æ•°
cat <<EOF | tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

modprobe overlay
modprobe br_netfilter

cat <<EOF | tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sysctl --system

# 5. é…ç½®æ—¶é—´åŒæ­¥
yum install -y chrony
systemctl enable chronyd
systemctl start chronyd

# 6. é…ç½®ä¸»æœºåå’Œhosts
# éœ€è¦æ‰‹åŠ¨è®¾ç½®
# hostnamectl set-hostname k8s-master01
# cat >> /etc/hosts << EOF
# 192.168.1.10 k8s-master01
# 192.168.1.11 k8s-master02
# 192.168.1.12 k8s-master03
# 192.168.1.20 k8s-node01
# EOF

echo "âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼"
echo "è¯·æ‰‹åŠ¨é…ç½®ä¸»æœºåå’Œhostsæ–‡ä»¶"
```

---

## 3. kubeadméƒ¨ç½²

### 3.1 å•MasterèŠ‚ç‚¹éƒ¨ç½²

```bash
#!/bin/bash
# ========================================
# kubeadmå•MasterèŠ‚ç‚¹éƒ¨ç½²è„šæœ¬ (Ubuntu/Debian)
# ========================================

set -e

K8S_VERSION="1.28"
CONTAINERD_VERSION="1.7.8"

echo "===== Kuberneteså•MasterèŠ‚ç‚¹éƒ¨ç½² ====="

# ========================================
# æ­¥éª¤1: å®‰è£…containerd
# ========================================

echo "â¤ å®‰è£…containerd..."

# å®‰è£…ä¾èµ–
apt-get update
apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release

# ä¸‹è½½containerd
wget https://github.com/containerd/containerd/releases/download/v${CONTAINERD_VERSION}/containerd-${CONTAINERD_VERSION}-linux-amd64.tar.gz
tar Cxzvf /usr/local containerd-${CONTAINERD_VERSION}-linux-amd64.tar.gz

# å®‰è£…systemd service
mkdir -p /usr/local/lib/systemd/system
wget -O /usr/local/lib/systemd/system/containerd.service \
  https://raw.githubusercontent.com/containerd/containerd/main/containerd.service

systemctl daemon-reload
systemctl enable --now containerd

# é…ç½®containerd
mkdir -p /etc/containerd
containerd config default | tee /etc/containerd/config.toml

# ä¿®æ”¹é…ç½®ä½¿ç”¨systemd cgroup
sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml

# é‡å¯containerd
systemctl restart containerd

echo "âœ… containerdå®‰è£…å®Œæˆ"

# ========================================
# æ­¥éª¤2: å®‰è£…runc
# ========================================

echo "â¤ å®‰è£…runc..."
wget https://github.com/opencontainers/runc/releases/download/v1.1.10/runc.amd64
install -m 755 runc.amd64 /usr/local/sbin/runc
echo "âœ… runcå®‰è£…å®Œæˆ"

# ========================================
# æ­¥éª¤3: å®‰è£…CNIæ’ä»¶
# ========================================

echo "â¤ å®‰è£…CNIæ’ä»¶..."
wget https://github.com/containernetworking/plugins/releases/download/v1.3.0/cni-plugins-linux-amd64-v1.3.0.tgz
mkdir -p /opt/cni/bin
tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz
echo "âœ… CNIæ’ä»¶å®‰è£…å®Œæˆ"

# ========================================
# æ­¥éª¤4: å®‰è£…kubeadmã€kubeletã€kubectl
# ========================================

echo "â¤ å®‰è£…kubeadmã€kubeletã€kubectl..."

# æ·»åŠ Kubernetes aptæº
curl -fsSL https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/deb/Release.key | \
  gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/deb/ /" | \
  tee /etc/apt/sources.list.d/kubernetes.list

# å®‰è£…
apt-get update
apt-get install -y kubelet kubeadm kubectl
apt-mark hold kubelet kubeadm kubectl

# å¯åŠ¨kubelet
systemctl enable kubelet

echo "âœ… kubeadmã€kubeletã€kubectlå®‰è£…å®Œæˆ"

# ========================================
# æ­¥éª¤5: åˆå§‹åŒ–MasterèŠ‚ç‚¹
# ========================================

echo "â¤ åˆå§‹åŒ–Kubernetes MasterèŠ‚ç‚¹..."

kubeadm init \
  --pod-network-cidr=10.244.0.0/16 \
  --service-cidr=10.96.0.0/12 \
  --kubernetes-version=v${K8S_VERSION}.0

echo "âœ… MasterèŠ‚ç‚¹åˆå§‹åŒ–å®Œæˆ"

# ========================================
# æ­¥éª¤6: é…ç½®kubectl
# ========================================

echo "â¤ é…ç½®kubectl..."

mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

echo "âœ… kubectlé…ç½®å®Œæˆ"

# ========================================
# æ­¥éª¤7: å®‰è£…CNIç½‘ç»œæ’ä»¶ (Flannel)
# ========================================

echo "â¤ å®‰è£…Flannel CNI..."

kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

echo "âœ… Flannel CNIå®‰è£…å®Œæˆ"

# ========================================
# æ­¥éª¤8: éªŒè¯é›†ç¾¤
# ========================================

echo "â¤ éªŒè¯é›†ç¾¤çŠ¶æ€..."
sleep 30
kubectl get nodes
kubectl get pods -A

echo ""
echo "========================================="
echo "âœ… Kuberneteså•MasterèŠ‚ç‚¹éƒ¨ç½²å®Œæˆï¼"
echo "========================================="
echo ""
echo "é›†ç¾¤ä¿¡æ¯:"
kubectl cluster-info
echo ""
echo "WorkerèŠ‚ç‚¹åŠ å…¥å‘½ä»¤:"
kubeadm token create --print-join-command
echo ""
echo "========================================="
```

**CentOS/RHELç‰ˆæœ¬å®‰è£…è„šæœ¬**:

```bash
#!/bin/bash
# ========================================
# kubeadmå•MasterèŠ‚ç‚¹éƒ¨ç½²è„šæœ¬ (CentOS/RHEL)
# ========================================

set -e

K8S_VERSION="1.28"

echo "===== Kuberneteså•MasterèŠ‚ç‚¹éƒ¨ç½² (CentOS/RHEL) ====="

# 1. å®‰è£…containerd
echo "â¤ å®‰è£…containerd..."
yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum install -y containerd.io

# é…ç½®containerd
mkdir -p /etc/containerd
containerd config default | tee /etc/containerd/config.toml
sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml

systemctl enable --now containerd

# 2. æ·»åŠ Kubernetes yumæº
cat <<EOF | tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/rpm/repodata/repomd.xml.key
EOF

# 3. å®‰è£…kubeadmã€kubeletã€kubectl
yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes
systemctl enable kubelet

# 4. åˆå§‹åŒ–MasterèŠ‚ç‚¹
kubeadm init \
  --pod-network-cidr=10.244.0.0/16 \
  --service-cidr=10.96.0.0/12 \
  --kubernetes-version=v${K8S_VERSION}.0

# 5. é…ç½®kubectl
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

# 6. å®‰è£…Flannel
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

echo "âœ… Kuberneteséƒ¨ç½²å®Œæˆï¼"
kubectl get nodes
```

### 3.2 é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²

```yaml
# ========================================
# é«˜å¯ç”¨é›†ç¾¤æ¶æ„
# ========================================

HA_Architecture:
  æ‹“æ‰‘ç»“æ„:
    è´Ÿè½½å‡è¡¡å±‚:
      - HAProxy + Keepalived
      - æˆ–äº‘å‚å•†LB (AWS ELB, Azure LB)
      - VIP: 192.168.1.100
    
    MasterèŠ‚ç‚¹:
      - k8s-master01: 192.168.1.10
      - k8s-master02: 192.168.1.11
      - k8s-master03: 192.168.1.12
    
    WorkerèŠ‚ç‚¹:
      - k8s-node01: 192.168.1.20
      - k8s-node02: 192.168.1.21
      - k8s-node03: 192.168.1.22
    
    etcdé›†ç¾¤:
      - ä¸MasterèŠ‚ç‚¹éƒ¨ç½² (å †å æ¨¡å¼)
      - æˆ–ç‹¬ç«‹éƒ¨ç½² (å¤–éƒ¨etcd)
  
  é«˜å¯ç”¨è¦ç‚¹:
    - å¥‡æ•°ä¸ªMasterèŠ‚ç‚¹ (3/5/7)
    - etcdé›†ç¾¤ (3/5èŠ‚ç‚¹)
    - è´Ÿè½½å‡è¡¡å™¨é«˜å¯ç”¨
    - å¤šä¸ªWorkerèŠ‚ç‚¹
```

**HAProxy + Keepalivedé…ç½®**:

```bash
# ========================================
# HAProxy + Keepalived éƒ¨ç½² (ä¸¤å°LBæœåŠ¡å™¨)
# ========================================

# å®‰è£…HAProxyå’ŒKeepalived
yum install -y haproxy keepalived

# ========================================
# HAProxyé…ç½® (/etc/haproxy/haproxy.cfg)
# ========================================

cat > /etc/haproxy/haproxy.cfg << 'EOF'
global
    log /dev/log local0
    log /dev/log local1 notice
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s
    user haproxy
    group haproxy
    daemon

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend k8s-apiserver
    bind *:6443
    mode tcp
    option tcplog
    default_backend k8s-master-nodes

backend k8s-master-nodes
    mode tcp
    balance roundrobin
    option tcp-check
    server master01 192.168.1.10:6443 check inter 2000 rise 2 fall 3
    server master02 192.168.1.11:6443 check inter 2000 rise 2 fall 3
    server master03 192.168.1.12:6443 check inter 2000 rise 2 fall 3

listen stats
    bind *:9999
    mode http
    stats enable
    stats uri /haproxy-stats
    stats refresh 30s
    stats admin if TRUE
EOF

# å¯åŠ¨HAProxy
systemctl enable haproxy
systemctl start haproxy

# ========================================
# Keepalivedé…ç½® (/etc/keepalived/keepalived.conf)
# ========================================

# ä¸»LBæœåŠ¡å™¨é…ç½®
cat > /etc/keepalived/keepalived.conf << 'EOF'
! Configuration File for keepalived

global_defs {
   router_id LB01
}

vrrp_script check_haproxy {
    script "/usr/bin/killall -0 haproxy"
    interval 2
    weight 2
}

vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.1.100
    }
    track_script {
        check_haproxy
    }
}
EOF

# å¤‡LBæœåŠ¡å™¨é…ç½® (ä¿®æ”¹stateä¸ºBACKUP, priorityä¸º90)

# å¯åŠ¨Keepalived
systemctl enable keepalived
systemctl start keepalived

# éªŒè¯VIP
ip addr show eth0
```

**é«˜å¯ç”¨é›†ç¾¤åˆå§‹åŒ–**:

```bash
#!/bin/bash
# ========================================
# é«˜å¯ç”¨Kubernetesé›†ç¾¤åˆå§‹åŒ–
# ========================================

LOAD_BALANCER_DNS="k8s-lb.example.com"
LOAD_BALANCER_IP="192.168.1.100"
LOAD_BALANCER_PORT="6443"
POD_SUBNET="10.244.0.0/16"
SERVICE_SUBNET="10.96.0.0/12"
K8S_VERSION="1.28.0"

# ========================================
# ç¬¬ä¸€ä¸ªMasterèŠ‚ç‚¹åˆå§‹åŒ–
# ========================================

cat > kubeadm-config.yaml << EOF
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
kubernetesVersion: v${K8S_VERSION}
controlPlaneEndpoint: "${LOAD_BALANCER_IP}:${LOAD_BALANCER_PORT}"
networking:
  podSubnet: ${POD_SUBNET}
  serviceSubnet: ${SERVICE_SUBNET}
apiServer:
  certSANs:
    - "${LOAD_BALANCER_IP}"
    - "${LOAD_BALANCER_DNS}"
    - "192.168.1.10"
    - "192.168.1.11"
    - "192.168.1.12"
    - "k8s-master01"
    - "k8s-master02"
    - "k8s-master03"
etcd:
  local:
    dataDir: /var/lib/etcd
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 192.168.1.10
  bindPort: 6443
EOF

# åˆå§‹åŒ–ç¬¬ä¸€ä¸ªMaster
kubeadm init --config=kubeadm-config.yaml --upload-certs

# ä¿å­˜è¾“å‡ºçš„joinå‘½ä»¤

# é…ç½®kubectl
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

# å®‰è£…CNI
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

# ========================================
# å…¶ä»–MasterèŠ‚ç‚¹åŠ å…¥
# ========================================

# åœ¨master02å’Œmaster03ä¸Šæ‰§è¡Œkubeadm initè¾“å‡ºçš„joinå‘½ä»¤
# kubeadm join 192.168.1.100:6443 --token ... \
#   --discovery-token-ca-cert-hash sha256:... \
#   --control-plane --certificate-key ...

# ========================================
# WorkerèŠ‚ç‚¹åŠ å…¥
# ========================================

# åœ¨workerèŠ‚ç‚¹ä¸Šæ‰§è¡Œ
# kubeadm join 192.168.1.100:6443 --token ... \
#   --discovery-token-ca-cert-hash sha256:...

echo "âœ… é«˜å¯ç”¨Kubernetesé›†ç¾¤éƒ¨ç½²å®Œæˆï¼"
kubectl get nodes
kubectl get pods -A
```

---

## 4. äºŒè¿›åˆ¶éƒ¨ç½²

```yaml
Binary_Deployment_Overview:
  ä¼˜åŠ¿:
    - å®Œå…¨å¯æ§
    - è‡ªå®šä¹‰é…ç½®
    - æ·±å…¥ç†è§£
    - çµæ´»æ€§é«˜
  
  åŠ£åŠ¿:
    - å¤æ‚åº¦é«˜
    - ç»´æŠ¤æˆæœ¬é«˜
    - å‡çº§å›°éš¾
  
  é€‚ç”¨åœºæ™¯:
    - å­¦ä¹ ç ”ç©¶
    - ç‰¹æ®Šå®šåˆ¶éœ€æ±‚
    - å¯¹é›†ç¾¤æœ‰æ·±å…¥æ§åˆ¶éœ€æ±‚
  
  éƒ¨ç½²æ­¥éª¤æ¦‚è§ˆ:
    1. ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
    2. ç”Ÿæˆè¯ä¹¦
    3. é…ç½®etcdé›†ç¾¤
    4. é…ç½®kube-apiserver
    5. é…ç½®kube-controller-manager
    6. é…ç½®kube-scheduler
    7. é…ç½®kubelet
    8. é…ç½®kube-proxy
    9. é…ç½®CNIç½‘ç»œ
```

**äºŒè¿›åˆ¶éƒ¨ç½²è„šæœ¬éª¨æ¶** (å®Œæ•´è„šæœ¬è¾ƒé•¿ï¼Œè¿™é‡Œæä¾›ç»“æ„):

```bash
#!/bin/bash
# ========================================
# KubernetesäºŒè¿›åˆ¶éƒ¨ç½²è„šæœ¬ (ç®€åŒ–ç‰ˆ)
# ========================================

# 1. ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
K8S_VERSION="1.28.0"
wget https://dl.k8s.io/v${K8S_VERSION}/kubernetes-server-linux-amd64.tar.gz
tar -xzf kubernetes-server-linux-amd64.tar.gz

# 2. ç”Ÿæˆè¯ä¹¦ (ä½¿ç”¨cfsslå·¥å…·)
# è¯¦è§å®Œæ•´è„šæœ¬...

# 3. éƒ¨ç½²etcdé›†ç¾¤
# è¯¦è§å®Œæ•´è„šæœ¬...

# 4. éƒ¨ç½²Masterç»„ä»¶
# - kube-apiserver
# - kube-controller-manager
# - kube-scheduler

# 5. éƒ¨ç½²Nodeç»„ä»¶
# - kubelet
# - kube-proxy

# 6. éƒ¨ç½²CNIç½‘ç»œæ’ä»¶

echo "äºŒè¿›åˆ¶éƒ¨ç½²å®Œæˆ"
```

---

## 5. äº‘å‚å•†æ‰˜ç®¡Kubernetes

```yaml
Managed_Kubernetes:
  AWS_EKS:
    ç‰¹ç‚¹:
      - å®Œå…¨æ‰˜ç®¡çš„æ§åˆ¶å¹³é¢
      - è‡ªåŠ¨å‡çº§å’Œè¡¥ä¸
      - é›†æˆAWSæœåŠ¡
    
    éƒ¨ç½²:
      ä½¿ç”¨eksctl:
        bash
        eksctl create cluster \
          --name my-cluster \
          --region us-west-2 \
          --nodegroup-name standard-workers \
          --node-type t3.medium \
          --nodes 3 \
          --nodes-min 1 \
          --nodes-max 4
    
    æˆæœ¬:
      - æ§åˆ¶å¹³é¢: $0.10/å°æ—¶
      - WorkerèŠ‚ç‚¹: EC2å®šä»·
  
  Azure_AKS:
    ç‰¹ç‚¹:
      - æ‰˜ç®¡æ§åˆ¶å¹³é¢
      - å…è´¹æ§åˆ¶å¹³é¢
      - Azure DevOpsé›†æˆ
    
    éƒ¨ç½²:
      bash
      az aks create \
        --resource-group myResourceGroup \
        --name myAKSCluster \
        --node-count 3 \
        --enable-addons monitoring \
        --generate-ssh-keys
    
    æˆæœ¬:
      - æ§åˆ¶å¹³é¢: å…è´¹
      - WorkerèŠ‚ç‚¹: VMå®šä»·
  
  Google_GKE:
    ç‰¹ç‚¹:
      - æœ€æ—©çš„æ‰˜ç®¡K8s
      - è‡ªåŠ¨ä¿®å¤å’Œå‡çº§
      - åŒºåŸŸé›†ç¾¤
    
    éƒ¨ç½²:
      bash
      gcloud container clusters create my-cluster \
        --zone us-central1-a \
        --num-nodes 3 \
        --machine-type n1-standard-2
    
    æˆæœ¬:
      - æ§åˆ¶å¹³é¢: $0.10/å°æ—¶ (Autopilotå…è´¹)
      - WorkerèŠ‚ç‚¹: GCEå®šä»·
  
  é˜¿é‡Œäº‘_ACK:
    ç‰¹ç‚¹:
      - å®Œå…¨æ‰˜ç®¡
      - å®‰å…¨å®¹å™¨
      - ä¸­å›½åŒºåŸŸä¼˜åŒ–
    
    éƒ¨ç½²:
      é€šè¿‡æ§åˆ¶å°æˆ–CLI
    
    æˆæœ¬:
      - ä¸“æœ‰ç‰ˆ: Â¥0.42/å°æ—¶
      - æ‰˜ç®¡ç‰ˆ: å…è´¹
  
  è…¾è®¯äº‘_TKE:
    éƒ¨ç½²: é€šè¿‡æ§åˆ¶å°æˆ–TKE CLI
    æˆæœ¬: æ‰˜ç®¡ç‰ˆå…è´¹
  
  åä¸ºäº‘_CCE:
    éƒ¨ç½²: é€šè¿‡æ§åˆ¶å°æˆ–CLI
    æˆæœ¬: æ‰˜ç®¡ç‰ˆå…è´¹
```

---

## 6. è½»é‡çº§Kubernetes

```yaml
Lightweight_Kubernetes:
  K3s:
    ç‰¹ç‚¹:
      - å•äºŒè¿›åˆ¶æ–‡ä»¶ < 100MB
      - é€‚åˆè¾¹ç¼˜ã€IoTã€CI
      - åŒ…å«Traefikã€LocalPath
    
    éƒ¨ç½²:
      bash
      # ServerèŠ‚ç‚¹
      curl -sfL https://get.k3s.io | sh -
      
      # AgentèŠ‚ç‚¹
      curl -sfL https://get.k3s.io | K3S_URL=https://myserver:6443 \
        K3S_TOKEN=mynodetoken sh -
    
    é€‚ç”¨åœºæ™¯:
      - è¾¹ç¼˜è®¡ç®—
      - å¼€å‘æµ‹è¯•
      - èµ„æºå—é™ç¯å¢ƒ
  
  MicroK8s:
    ç‰¹ç‚¹:
      - SnapåŒ…ç®¡ç†
      - å¿«é€Ÿå®‰è£…
      - Canonicalç»´æŠ¤
    
    éƒ¨ç½²:
      bash
      sudo snap install microk8s --classic
      sudo microk8s enable dns storage
    
    é€‚ç”¨åœºæ™¯:
      - å¼€å‘ç¯å¢ƒ
      - CI/CD
      - Ubuntuç³»ç»Ÿ
  
  Kind (Kubernetes in Docker):
    ç‰¹ç‚¹:
      - Dockerå®¹å™¨ä¸­è¿è¡ŒK8s
      - å¿«é€Ÿåˆ›å»º/é”€æ¯
      - CIæµ‹è¯•
    
    éƒ¨ç½²:
      bash
      kind create cluster --name my-cluster
    
    é€‚ç”¨åœºæ™¯:
      - æœ¬åœ°å¼€å‘
      - CIæµ‹è¯•
      - å­¦ä¹ å®éªŒ
  
  Minikube:
    ç‰¹ç‚¹:
      - å•æœºKubernetes
      - å¤šç§é©±åŠ¨ (Docker, VirtualBox, KVM)
      - ä¸°å¯Œæ’ä»¶
    
    éƒ¨ç½²:
      bash
      minikube start --cpus=4 --memory=8192
    
    é€‚ç”¨åœºæ™¯:
      - æœ¬åœ°å¼€å‘
      - å­¦ä¹ K8s
      - å¿«é€Ÿå®éªŒ
```

---

## 7. é›†ç¾¤éªŒè¯

```bash
#!/bin/bash
# ========================================
# Kubernetesé›†ç¾¤éªŒè¯è„šæœ¬
# ========================================

echo "===== Kubernetesé›†ç¾¤éªŒè¯ ====="

# 1. æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
echo -e "\nâ¤ èŠ‚ç‚¹çŠ¶æ€:"
kubectl get nodes -o wide

# 2. æ£€æŸ¥ç³»ç»ŸPod
echo -e "\nâ¤ ç³»ç»ŸPodçŠ¶æ€:"
kubectl get pods -n kube-system

# 3. æ£€æŸ¥ç»„ä»¶å¥åº·
echo -e "\nâ¤ ç»„ä»¶å¥åº·çŠ¶æ€:"
kubectl get cs

# 4. æ£€æŸ¥é›†ç¾¤ä¿¡æ¯
echo -e "\nâ¤ é›†ç¾¤ä¿¡æ¯:"
kubectl cluster-info

# 5. æµ‹è¯•DNS
echo -e "\nâ¤ æµ‹è¯•DNS:"
kubectl run test-dns --image=busybox:1.28 --rm -it --restart=Never -- nslookup kubernetes.default

# 6. æµ‹è¯•Podç½‘ç»œ
echo -e "\nâ¤ æµ‹è¯•Podåˆ›å»º:"
kubectl run nginx --image=nginx:alpine
sleep 10
kubectl get pod nginx
kubectl delete pod nginx

# 7. æµ‹è¯•Service
echo -e "\nâ¤ æµ‹è¯•Service:"
kubectl create deployment nginx --image=nginx:alpine --replicas=2
kubectl expose deployment nginx --port=80
sleep 10
kubectl get svc nginx
kubectl delete svc nginx
kubectl delete deployment nginx

# 8. æ£€æŸ¥èµ„æºä½¿ç”¨
echo -e "\nâ¤ èŠ‚ç‚¹èµ„æºä½¿ç”¨:"
kubectl top nodes

echo -e "\nâœ… é›†ç¾¤éªŒè¯å®Œæˆï¼"
```

---

## 8. éƒ¨ç½²æœ€ä½³å®è·µ

```yaml
Deployment_Best_Practices:
  è§„åˆ’é˜¶æ®µ:
    âœ… å®¹é‡è§„åˆ’:
      - é¢„ä¼°Podæ•°é‡
      - é¢„ä¼°èµ„æºéœ€æ±‚
      - é¢„ç•™30%å†—ä½™
    
    âœ… ç½‘ç»œè§„åˆ’:
      - Pod CIDRä¸ä¸ç°æœ‰ç½‘ç»œå†²çª
      - Service CIDRç‹¬ç«‹è§„åˆ’
      - è€ƒè™‘æœªæ¥æ‰©å±•
    
    âœ… é«˜å¯ç”¨è®¾è®¡:
      - è‡³å°‘3ä¸ªMasterèŠ‚ç‚¹
      - è·¨å¯ç”¨åŒºéƒ¨ç½²
      - è´Ÿè½½å‡è¡¡å™¨å†—ä½™
  
  å®‰è£…é˜¶æ®µ:
    âœ… ç‰ˆæœ¬é€‰æ‹©:
      - ä½¿ç”¨ç¨³å®šç‰ˆæœ¬
      - é¿å….0ç‰ˆæœ¬
      - æŸ¥çœ‹Release Notes
    
    âœ… ç»„ä»¶é…ç½®:
      - åˆç†çš„èµ„æºé™åˆ¶
      - å¯ç”¨å®¡è®¡æ—¥å¿—
      - é…ç½®å¤‡ä»½ç­–ç•¥
    
    âœ… å®‰å…¨åŠ å›º:
      - RBACæƒé™æ§åˆ¶
      - Pod Security Policy
      - Network Policy
      - SecretåŠ å¯†
  
  è¿ç»´é˜¶æ®µ:
    âœ… ç›‘æ§å‘Šè­¦:
      - éƒ¨ç½²Prometheus
      - é…ç½®Grafana
      - è®¾ç½®å‘Šè­¦è§„åˆ™
    
    âœ… æ—¥å¿—ç®¡ç†:
      - é›†ä¸­å¼æ—¥å¿— (EFK)
      - æ—¥å¿—è½®è½¬
      - æ—¥å¿—æŸ¥è¯¢
    
    âœ… å¤‡ä»½ç­–ç•¥:
      - etcdå®šæœŸå¤‡ä»½
      - é…ç½®æ–‡ä»¶å¤‡ä»½
      - PVæ•°æ®å¤‡ä»½
    
    âœ… å‡çº§ç­–ç•¥:
      - æµ‹è¯•ç¯å¢ƒéªŒè¯
      - æ»šåŠ¨å‡çº§
      - å›æ»šè®¡åˆ’
```

---

## ç›¸å…³æ–‡æ¡£

- [Kubernetesæ ¸å¿ƒç»„ä»¶](02_æ ¸å¿ƒç»„ä»¶.md)
- [Kubernetesåº”ç”¨éƒ¨ç½²](03_åº”ç”¨éƒ¨ç½².md)
- [Kubernetesèµ„æºç®¡ç†](04_èµ„æºç®¡ç†.md)
- [Kubernetesé«˜å¯ç”¨æ¶æ„](../../01_è™šæ‹ŸåŒ–éƒ¨ç½²/05_é«˜å¯ç”¨å®¹ç¾/02_Kubernetesé«˜å¯ç”¨æ¶æ„.md)
- [å®¹å™¨ç½‘ç»œé…ç½®](../03_å®¹å™¨ç½‘ç»œ/README.md)
- [å®¹å™¨å­˜å‚¨é…ç½®](../04_å®¹å™¨å­˜å‚¨/README.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
