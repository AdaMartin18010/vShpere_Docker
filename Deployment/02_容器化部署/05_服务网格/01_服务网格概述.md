# æœåŠ¡ç½‘æ ¼æ¦‚è¿°

> **è¿”å›**: [æœåŠ¡ç½‘æ ¼é¦–é¡µ](README.md) | [å®¹å™¨åŒ–éƒ¨ç½²é¦–é¡µ](../README.md) | [éƒ¨ç½²æŒ‡å—é¦–é¡µ](../../00_ç´¢å¼•å¯¼èˆª/README.md)

---

## ğŸ“‹ ç›®å½•

- [æœåŠ¡ç½‘æ ¼æ¦‚è¿°](#æœåŠ¡ç½‘æ ¼æ¦‚è¿°)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æœåŠ¡ç½‘æ ¼åŸºç¡€](#1-æœåŠ¡ç½‘æ ¼åŸºç¡€)
    - [1.1 ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼](#11-ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼)
    - [1.2 æ ¸å¿ƒæ¦‚å¿µ](#12-æ ¸å¿ƒæ¦‚å¿µ)
    - [1.3 æ¶æ„æ¨¡å¼](#13-æ¶æ„æ¨¡å¼)
      - [1.3.1 Sidecar æ¨¡å¼ (ä¸»æµ)](#131-sidecar-æ¨¡å¼-ä¸»æµ)
      - [1.3.2 Ambient Mesh (æ–°å…´)](#132-ambient-mesh-æ–°å…´)
    - [1.4 æ¼”è¿›å†å²](#14-æ¼”è¿›å†å²)
  - [2. æ ¸å¿ƒåŠŸèƒ½](#2-æ ¸å¿ƒåŠŸèƒ½)
    - [2.1 æµé‡ç®¡ç†](#21-æµé‡ç®¡ç†)
      - [2.1.1 æ™ºèƒ½è·¯ç”±](#211-æ™ºèƒ½è·¯ç”±)
      - [2.1.2 è´Ÿè½½å‡è¡¡](#212-è´Ÿè½½å‡è¡¡)
      - [2.1.3 è¶…æ—¶ä¸é‡è¯•](#213-è¶…æ—¶ä¸é‡è¯•)
    - [2.2 å®‰å…¨](#22-å®‰å…¨)
      - [2.2.1 mTLS (åŒå‘ TLS)](#221-mtls-åŒå‘-tls)
      - [2.2.2 æˆæƒç­–ç•¥](#222-æˆæƒç­–ç•¥)
    - [2.3 å¯è§‚æµ‹æ€§](#23-å¯è§‚æµ‹æ€§)
      - [2.3.1 åˆ†å¸ƒå¼è¿½è¸ª](#231-åˆ†å¸ƒå¼è¿½è¸ª)
      - [2.3.2 æŒ‡æ ‡æ”¶é›†](#232-æŒ‡æ ‡æ”¶é›†)
    - [2.4 å¼¹æ€§](#24-å¼¹æ€§)
      - [2.4.1 ç†”æ–­ (Circuit Breaking)](#241-ç†”æ–­-circuit-breaking)
      - [2.4.2 æ•…éšœæ³¨å…¥](#242-æ•…éšœæ³¨å…¥)
  - [3. ä¸»æµæœåŠ¡ç½‘æ ¼å¯¹æ¯”](#3-ä¸»æµæœåŠ¡ç½‘æ ¼å¯¹æ¯”)
    - [3.1 Istio](#31-istio)
    - [3.2 Linkerd](#32-linkerd)
    - [3.3 Consul Connect](#33-consul-connect)
    - [3.4 Cilium Service Mesh](#34-cilium-service-mesh)
    - [3.5 å¯¹æ¯”æ€»ç»“](#35-å¯¹æ¯”æ€»ç»“)
  - [4. Istio vs Linkerd è¯¦ç»†å¯¹æ¯”](#4-istio-vs-linkerd-è¯¦ç»†å¯¹æ¯”)
    - [4.1 æ¶æ„å¯¹æ¯”](#41-æ¶æ„å¯¹æ¯”)
    - [4.2 æ€§èƒ½å¯¹æ¯”](#42-æ€§èƒ½å¯¹æ¯”)
    - [4.3 åŠŸèƒ½å¯¹æ¯”](#43-åŠŸèƒ½å¯¹æ¯”)
    - [4.4 ç¤¾åŒºå¯¹æ¯”](#44-ç¤¾åŒºå¯¹æ¯”)
  - [5. ä½¿ç”¨åœºæ™¯](#5-ä½¿ç”¨åœºæ™¯)
    - [5.1 å¾®æœåŠ¡æ²»ç†](#51-å¾®æœåŠ¡æ²»ç†)
    - [5.2 å¤šé›†ç¾¤ç®¡ç†](#52-å¤šé›†ç¾¤ç®¡ç†)
    - [5.3 æ··åˆäº‘/å¤šäº‘](#53-æ··åˆäº‘å¤šäº‘)
    - [5.4 é›¶ä¿¡ä»»å®‰å…¨](#54-é›¶ä¿¡ä»»å®‰å…¨)
  - [6. é€‰å‹å»ºè®®](#6-é€‰å‹å»ºè®®)
    - [6.1 é€‰å‹ç»´åº¦](#61-é€‰å‹ç»´åº¦)
    - [6.2 é€‚ç”¨åœºæ™¯](#62-é€‚ç”¨åœºæ™¯)
    - [6.3 å†³ç­–æ ‘](#63-å†³ç­–æ ‘)
    - [6.4 è¿ç§»ç­–ç•¥](#64-è¿ç§»ç­–ç•¥)
  - [7. æœåŠ¡ç½‘æ ¼ä¸å…¶ä»–æŠ€æœ¯å¯¹æ¯”](#7-æœåŠ¡ç½‘æ ¼ä¸å…¶ä»–æŠ€æœ¯å¯¹æ¯”)
    - [7.1 æœåŠ¡ç½‘æ ¼ vs API ç½‘å…³](#71-æœåŠ¡ç½‘æ ¼-vs-api-ç½‘å…³)
    - [7.2 æœåŠ¡ç½‘æ ¼ vs Kubernetes Ingress](#72-æœåŠ¡ç½‘æ ¼-vs-kubernetes-ingress)
    - [7.3 æœåŠ¡ç½‘æ ¼ vs ä¼ ç»Ÿè´Ÿè½½å‡è¡¡](#73-æœåŠ¡ç½‘æ ¼-vs-ä¼ ç»Ÿè´Ÿè½½å‡è¡¡)
  - [8. éƒ¨ç½²æ¨¡å¼](#8-éƒ¨ç½²æ¨¡å¼)
    - [8.1 å…¨é¢éƒ¨ç½²](#81-å…¨é¢éƒ¨ç½²)
    - [8.2 æ¸è¿›å¼éƒ¨ç½²](#82-æ¸è¿›å¼éƒ¨ç½²)
    - [8.3 Sidecar vs Sidecar-less](#83-sidecar-vs-sidecar-less)
  - [9. æ€§èƒ½ä¸æˆæœ¬](#9-æ€§èƒ½ä¸æˆæœ¬)
    - [9.1 æ€§èƒ½å½±å“](#91-æ€§èƒ½å½±å“)
    - [9.2 èµ„æºå¼€é”€](#92-èµ„æºå¼€é”€)
    - [9.3 æˆæœ¬åˆ†æ](#93-æˆæœ¬åˆ†æ)
  - [10. æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)
    - [10.1 éƒ¨ç½²å»ºè®®](#101-éƒ¨ç½²å»ºè®®)
    - [10.2 ç›‘æ§ä¸å‘Šè­¦](#102-ç›‘æ§ä¸å‘Šè­¦)
    - [10.3 æ•…éšœæ’æŸ¥](#103-æ•…éšœæ’æŸ¥)
    - [10.4 å‡çº§ç­–ç•¥](#104-å‡çº§ç­–ç•¥)
  - [æ€»ç»“](#æ€»ç»“)

---

## 1. æœåŠ¡ç½‘æ ¼åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼

**æœåŠ¡ç½‘æ ¼ (Service Mesh)** æ˜¯ä¸€ä¸ªä¸“ç”¨çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç”¨äºå¤„ç†æœåŠ¡é—´é€šä¿¡ã€‚å®ƒé€šè¿‡**é€æ˜ä»£ç†**æ‹¦æˆªæœåŠ¡é—´çš„ç½‘ç»œæµé‡ï¼Œæä¾›**æµé‡ç®¡ç†ã€å®‰å…¨ã€å¯è§‚æµ‹æ€§**ç­‰åŠŸèƒ½ï¼Œæ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç ã€‚

**æ ¸å¿ƒå®šä¹‰**:

```text
æœåŠ¡ç½‘æ ¼ = æ•°æ®å¹³é¢ (Data Plane) + æ§åˆ¶å¹³é¢ (Control Plane)

æ•°æ®å¹³é¢: è´Ÿè´£å®é™…æµé‡è½¬å‘ (é€šå¸¸æ˜¯ Sidecar ä»£ç†)
æ§åˆ¶å¹³é¢: è´Ÿè´£é…ç½®åˆ†å‘ã€ç­–ç•¥ç®¡ç†ã€é¥æµ‹æ”¶é›†
```

**æ¶æ„ç¤ºæ„**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ§åˆ¶å¹³é¢ (Control Plane)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ç­–ç•¥ç®¡ç†     â”‚  â”‚  é…ç½®åˆ†å‘    â”‚  â”‚  é¥æµ‹æ”¶é›†     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ (é…ç½®æ¨é€/æ‹‰å–)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service A      â”‚    â”‚  Service B       â”‚    â”‚  Service C       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚    App     â”‚  â”‚    â”‚ â”‚    App     â”‚   â”‚    â”‚ â”‚    App     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚         â”‚    â”‚       â”‚          â”‚    â”‚       â”‚          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚   Sidecar  â”‚â—„â”€â”¼â”€â”€â”€â”€â”¼â”€â”¤   Sidecar  â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”¤   Sidecar  â”‚   â”‚
â”‚ â”‚   Proxy    â”‚  â”‚    â”‚ â”‚   Proxy    â”‚   â”‚    â”‚ â”‚   Proxy    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  æ•°æ®å¹³é¢ (Data Plane - æµé‡è½¬å‘)
```

---

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|-----|------|
| **Sidecar ä»£ç†** | ä¸åº”ç”¨å®¹å™¨éƒ¨ç½²åœ¨åŒä¸€ Pod ä¸­çš„ä»£ç†å®¹å™¨ï¼Œæ‹¦æˆªæ‰€æœ‰è¿›å‡ºæµé‡ |
| **æ•°æ®å¹³é¢ (Data Plane)** | ç”±æ‰€æœ‰ Sidecar ä»£ç†ç»„æˆï¼Œè´Ÿè´£å®é™…æµé‡è½¬å‘ |
| **æ§åˆ¶å¹³é¢ (Control Plane)** | ç®¡ç†å’Œé…ç½®æ•°æ®å¹³é¢ï¼Œæä¾›ç­–ç•¥ã€é¥æµ‹ã€è¯ä¹¦ç®¡ç† |
| **æœåŠ¡å‘ç° (Service Discovery)** | è‡ªåŠ¨å‘ç°æœåŠ¡å®ä¾‹çš„ä½ç½®å’ŒçŠ¶æ€ |
| **è´Ÿè½½å‡è¡¡ (Load Balancing)** | åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹é—´åˆ†é…æµé‡ |
| **ç†”æ–­ (Circuit Breaking)** | é˜²æ­¢æ•…éšœæœåŠ¡å½±å“æ•´ä½“ç³»ç»Ÿ |
| **mTLS (Mutual TLS)** | æœåŠ¡é—´åŒå‘ TLS åŠ å¯†å’Œèº«ä»½éªŒè¯ |
| **é¥æµ‹ (Telemetry)** | æ”¶é›†æœåŠ¡é—´é€šä¿¡çš„æŒ‡æ ‡ã€æ—¥å¿—ã€è¿½è¸ªæ•°æ® |

---

### 1.3 æ¶æ„æ¨¡å¼

#### 1.3.1 Sidecar æ¨¡å¼ (ä¸»æµ)

**ç‰¹ç‚¹**:

- æ¯ä¸ªåº”ç”¨ Pod æ³¨å…¥ä¸€ä¸ª Sidecar ä»£ç†å®¹å™¨
- ä»£ç†æ‹¦æˆªæ‰€æœ‰è¿›å‡ºæµé‡
- åº”ç”¨æ— éœ€æ„ŸçŸ¥æœåŠ¡ç½‘æ ¼å­˜åœ¨

**ä¼˜ç‚¹**:

- âœ… åº”ç”¨æ— ä¾µå…¥ (æ— éœ€ä¿®æ”¹ä»£ç )
- âœ… è¯­è¨€æ— å…³ (æ”¯æŒä»»æ„ç¼–ç¨‹è¯­è¨€)
- âœ… çµæ´»é…ç½® (å¯æŒ‰æœåŠ¡ç²’åº¦é…ç½®ç­–ç•¥)

**ç¼ºç‚¹**:

- âŒ èµ„æºå¼€é”€å¤§ (æ¯ä¸ª Pod é¢å¤–æ¶ˆè€— CPU/å†…å­˜)
- âŒ è¿ç»´å¤æ‚åº¦é«˜ (Sidecar å‡çº§ã€æ•…éšœæ’æŸ¥)

**ç¤ºä¾‹**:

```yaml
# Istio è‡ªåŠ¨æ³¨å…¥ Sidecar
apiVersion: v1
kind: Pod
metadata:
  name: app
  labels:
    app: myapp
spec:
  containers:
  - name: app
    image: myapp:v1
  # Istio è‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹å®¹å™¨
  - name: istio-proxy
    image: istio/proxyv2:1.20.0
```

---

#### 1.3.2 Ambient Mesh (æ–°å…´)

**ç‰¹ç‚¹**:

- æ— éœ€ Sidecar å®¹å™¨
- é€šè¿‡èŠ‚ç‚¹çº§ä»£ç† (Ztunnel) + å¯é€‰ L7 ä»£ç† (Waypoint) å®ç°

**ä¼˜ç‚¹**:

- âœ… èµ„æºå¼€é”€ä½ (å…±äº«èŠ‚ç‚¹çº§ä»£ç†)
- âœ… è¿ç»´ç®€å• (å‡å°‘ Sidecar ç®¡ç†)
- âœ… æ€§èƒ½æ›´å¥½ (å‡å°‘ä»£ç†è·³æ•°)

**ç¼ºç‚¹**:

- âŒ åŠŸèƒ½å—é™ (éƒ¨åˆ†é«˜çº§åŠŸèƒ½éœ€ Waypoint ä»£ç†)
- âŒ æˆç†Ÿåº¦ä½ (Istio 1.18+ å®éªŒæ€§åŠŸèƒ½)

**æ¶æ„**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Node 1                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Pod A   â”‚  â”‚  Pod B   â”‚  â”‚  Pod C   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚             â”‚             â”‚                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                     â”‚                               â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â”‚   Ztunnel        â”‚ (èŠ‚ç‚¹çº§ L4 ä»£ç†)     â”‚
â”‚            â”‚   (DaemonSet)    â”‚                     â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Waypoint Proxy â”‚ (å¯é€‰ L7 ä»£ç†)
              â”‚  (Deployment)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.4 æ¼”è¿›å†å²

**2016 - æœåŠ¡ç½‘æ ¼è¯ç”Ÿ**:

- Linkerd 1.0 å‘å¸ƒ (åŸºäº Twitter Finagle)
- Envoy å‘å¸ƒ (Lyft å¼€æº)

**2017 - Istio æ¨ªç©ºå‡ºä¸–**:

- Google/IBM/Lyft è”åˆæ¨å‡º Istio
- åŸºäº Envoy ä½œä¸ºæ•°æ®å¹³é¢

**2018 - CNCF æ¥çº³**:

- Linkerd åŠ å…¥ CNCF (åæ¼”è¿›ä¸º Linkerd 2)
- Envoy åŠ å…¥ CNCF

**2019 - ç”Ÿæ€æˆç†Ÿ**:

- Istio 1.0 ç”Ÿäº§å°±ç»ª
- AWS App Mesh å‘å¸ƒ

**2020 - ç®€åŒ–è¶‹åŠ¿**:

- Linkerd 2.8 ç¨³å®šç‰ˆå‘å¸ƒ
- Consul Connect å¢å¼º

**2021-2023 - æ€§èƒ½ä¼˜åŒ–**:

- Cilium Service Mesh (åŸºäº eBPF)
- Istio Ambient Mesh (æ—  Sidecar)

**2024+ - æ ‡å‡†åŒ–**:

- Gateway API æˆä¸ºæœåŠ¡ç½‘æ ¼æ ‡å‡†æ¥å£
- GAMMA (Gateway API for Service Mesh) å€¡è®®

---

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 æµé‡ç®¡ç†

#### 2.1.1 æ™ºèƒ½è·¯ç”±

**åŠŸèƒ½**:

- åŸºäºè¯·æ±‚å¤´/è·¯å¾„çš„è·¯ç”±
- é‡‘ä¸é›€å‘å¸ƒ (Canary Release)
- è“ç»¿éƒ¨ç½² (Blue-Green Deployment)
- A/B æµ‹è¯•

**ç¤ºä¾‹ (Istio VirtualService)**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - match:
    - headers:
        user:
          exact: "vip"
    route:
    - destination:
        host: reviews
        subset: v2  # VIP ç”¨æˆ·è®¿é—® v2
  - route:
    - destination:
        host: reviews
        subset: v1
      weight: 90  # 90% æµé‡åˆ° v1
    - destination:
        host: reviews
        subset: v2
      weight: 10  # 10% æµé‡åˆ° v2 (é‡‘ä¸é›€)
```

---

#### 2.1.2 è´Ÿè½½å‡è¡¡

**æ”¯æŒçš„ç®—æ³•**:

| ç®—æ³• | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|-----|------|---------|
| **Round Robin** | è½®è¯¢ | å®ä¾‹æ€§èƒ½ç›¸è¿‘ |
| **Least Request** | æœ€å°‘è¯·æ±‚æ•° | å®ä¾‹æ€§èƒ½ä¸åŒ |
| **Random** | éšæœº | ç®€å•åœºæ™¯ |
| **Consistent Hash** | ä¸€è‡´æ€§å“ˆå¸Œ | éœ€è¦ä¼šè¯ä¿æŒ |

**ç¤ºä¾‹ (Istio DestinationRule)**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews
spec:
  host: reviews
  trafficPolicy:
    loadBalancer:
      consistentHash:
        httpHeaderName: "user-id"  # åŸºäº user-id å“ˆå¸Œ
```

---

#### 2.1.3 è¶…æ—¶ä¸é‡è¯•

**é…ç½®è¶…æ—¶**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews
spec:
  http:
  - timeout: 10s  # è¯·æ±‚è¶…æ—¶ 10 ç§’
    retries:
      attempts: 3
      perTryTimeout: 2s
      retryOn: 5xx,reset,connect-failure
```

---

### 2.2 å®‰å…¨

#### 2.2.1 mTLS (åŒå‘ TLS)

**åŠŸèƒ½**:

- æœåŠ¡é—´æµé‡è‡ªåŠ¨åŠ å¯†
- åŒå‘èº«ä»½éªŒè¯
- è‡ªåŠ¨è¯ä¹¦è½®æ¢

**å·¥ä½œæµç¨‹**:

```text
1. Service A å‘ Service B å‘èµ·è¿æ¥
        â†“
2. Service A çš„ Sidecar ä¸ Service B çš„ Sidecar å»ºç«‹ mTLS è¿æ¥
        â†“
3. åŒæ–¹äº¤æ¢è¯ä¹¦ (ç”±æ§åˆ¶å¹³é¢ç­¾å‘)
        â†“
4. éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§
        â†“
5. å»ºç«‹åŠ å¯†é€šé“ï¼Œä¼ è¾“æ•°æ®
```

**é…ç½® (Istio)**:

```yaml
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: istio-system
spec:
  mtls:
    mode: STRICT  # å¼ºåˆ¶ mTLS
```

---

#### 2.2.2 æˆæƒç­–ç•¥

**åŠŸèƒ½**:

- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- ç»†ç²’åº¦æˆæƒ (æŒ‰æœåŠ¡/æ–¹æ³•/è·¯å¾„)

**ç¤ºä¾‹ (Istio AuthorizationPolicy)**:

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: reviews-policy
  namespace: default
spec:
  selector:
    matchLabels:
      app: reviews
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/default/sa/frontend"]  # ä»…å…è®¸ frontend è®¿é—®
    to:
    - operation:
        methods: ["GET"]  # ä»…å…è®¸ GET è¯·æ±‚
```

---

### 2.3 å¯è§‚æµ‹æ€§

#### 2.3.1 åˆ†å¸ƒå¼è¿½è¸ª

**é›†æˆæ–¹æ¡ˆ**:

- Jaeger
- Zipkin
- OpenTelemetry

**è¿½è¸ªç¤ºä¾‹**:

```text
HTTP Request: /api/users/123
â”œâ”€ frontend (50ms)
â”‚  â”œâ”€ backend-api (30ms)
â”‚  â”‚  â”œâ”€ user-service (15ms)
â”‚  â”‚  â”‚  â””â”€ database (10ms)
â”‚  â”‚  â””â”€ cache-service (5ms)
â”‚  â””â”€ auth-service (10ms)
â””â”€ Total: 50ms
```

---

#### 2.3.2 æŒ‡æ ‡æ”¶é›†

**æœåŠ¡ç½‘æ ¼æŒ‡æ ‡**:

| æŒ‡æ ‡ç±»å‹ | æŒ‡æ ‡åç§° | è¯´æ˜ |
|---------|---------|------|
| **è¯·æ±‚é‡** | `istio_requests_total` | æ€»è¯·æ±‚æ•° |
| **å“åº”æ—¶é—´** | `istio_request_duration_milliseconds` | è¯·æ±‚å»¶è¿Ÿ |
| **é”™è¯¯ç‡** | `istio_request_errors_total` | é”™è¯¯è¯·æ±‚æ•° |
| **æµé‡å¤§å°** | `istio_request_bytes` | è¯·æ±‚ä½“å¤§å° |
| **è¿æ¥æ•°** | `istio_tcp_connections_opened_total` | TCP è¿æ¥æ•° |

---

### 2.4 å¼¹æ€§

#### 2.4.1 ç†”æ–­ (Circuit Breaking)

**åŠŸèƒ½**: é˜²æ­¢æ•…éšœæœåŠ¡å½±å“æ•´ä½“ç³»ç»Ÿ

**é…ç½® (Istio)**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews
spec:
  host: reviews
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 10
        http2MaxRequests: 100
    outlierDetection:
      consecutive5xxErrors: 5  # è¿ç»­ 5 æ¬¡ 5xx é”™è¯¯
      interval: 30s
      baseEjectionTime: 30s    # é©±é€ 30 ç§’
      maxEjectionPercent: 50   # æœ€å¤šé©±é€ 50% å®ä¾‹
```

---

#### 2.4.2 æ•…éšœæ³¨å…¥

**ç”¨é€”**: æµ‹è¯•ç³»ç»Ÿå¼¹æ€§

**ç¤ºä¾‹ (æ³¨å…¥å»¶è¿Ÿ)**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews
spec:
  http:
  - fault:
      delay:
        percentage:
          value: 10  # 10% è¯·æ±‚å»¶è¿Ÿ
        fixedDelay: 5s  # å»¶è¿Ÿ 5 ç§’
    route:
    - destination:
        host: reviews
```

---

## 3. ä¸»æµæœåŠ¡ç½‘æ ¼å¯¹æ¯”

### 3.1 Istio

**ç®€ä»‹**: åŠŸèƒ½æœ€å…¨ã€ç”Ÿæ€æœ€ä¸°å¯Œçš„æœåŠ¡ç½‘æ ¼

**æ ¸å¿ƒç‰¹ç‚¹**:

- âœ… åŠŸèƒ½å…¨é¢ (æµé‡ç®¡ç†/å®‰å…¨/å¯è§‚æµ‹æ€§)
- âœ… å¤šé›†ç¾¤æ”¯æŒ
- âœ… ç”Ÿæ€æˆç†Ÿ (Google/IBM/Lyft æ”¯æŒ)
- âŒ å¤æ‚åº¦é«˜
- âŒ èµ„æºå¼€é”€å¤§

**æ¶æ„**:

```text
æ§åˆ¶å¹³é¢: Istiod (å•ä½“åŒ–è®¾è®¡)
æ•°æ®å¹³é¢: Envoy Proxy
```

**é€‚ç”¨åœºæ™¯**:

- å¤§å‹ä¼ä¸š
- å¤šé›†ç¾¤/å¤šäº‘ç¯å¢ƒ
- éœ€è¦é«˜çº§æµé‡ç®¡ç†åŠŸèƒ½

---

### 3.2 Linkerd

**ç®€ä»‹**: è½»é‡çº§ã€æ˜“ç”¨çš„æœåŠ¡ç½‘æ ¼

**æ ¸å¿ƒç‰¹ç‚¹**:

- âœ… è½»é‡çº§ (ä½èµ„æºå¼€é”€)
- âœ… ç®€å•æ˜“ç”¨
- âœ… æ€§èƒ½ä¼˜ç§€
- âŒ åŠŸèƒ½ç›¸å¯¹è¾ƒå°‘
- âŒ å¤šé›†ç¾¤æ”¯æŒå¼±

**æ¶æ„**:

```text
æ§åˆ¶å¹³é¢: Linkerd Control Plane
æ•°æ®å¹³é¢: Linkerd2-proxy (Rust ç¼–å†™)
```

**é€‚ç”¨åœºæ™¯**:

- ä¸­å°å‹å›¢é˜Ÿ
- ç®€å•å¾®æœåŠ¡æ¶æ„
- æ³¨é‡æ€§èƒ½å’Œç¨³å®šæ€§

---

### 3.3 Consul Connect

**ç®€ä»‹**: HashiCorp çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒç‰¹ç‚¹**:

- âœ… ä¸ Consul æœåŠ¡å‘ç°æ·±åº¦é›†æˆ
- âœ… å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒ
- âŒ Kubernetes åŸç”Ÿæ”¯æŒè¾ƒå¼±

**é€‚ç”¨åœºæ™¯**:

- å·²ä½¿ç”¨ Consul çš„ç»„ç»‡
- æ··åˆäº‘/è™šæ‹Ÿæœºç¯å¢ƒ

---

### 3.4 Cilium Service Mesh

**ç®€ä»‹**: åŸºäº eBPF çš„æœåŠ¡ç½‘æ ¼

**æ ¸å¿ƒç‰¹ç‚¹**:

- âœ… åŸºäº eBPF (æ€§èƒ½æé«˜)
- âœ… æ—  Sidecar (Sidecar-less)
- âŒ æˆç†Ÿåº¦è¾ƒä½

**é€‚ç”¨åœºæ™¯**:

- å¯¹æ€§èƒ½è¦æ±‚æé«˜
- å·²ä½¿ç”¨ Cilium CNI

---

### 3.5 å¯¹æ¯”æ€»ç»“

| å¯¹æ¯”é¡¹ | Istio | Linkerd | Consul Connect | Cilium Service Mesh |
|-------|-------|---------|---------------|---------------------|
| **å¤æ‚åº¦** | â­â­â­â­â­ (é«˜) | â­â­ (ä½) | â­â­â­ (ä¸­) | â­â­â­ (ä¸­) |
| **åŠŸèƒ½ä¸°å¯Œåº¦** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ |
| **æ€§èƒ½** | â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **èµ„æºå¼€é”€** | é«˜ | ä½ | ä¸­ | æä½ |
| **å¤šé›†ç¾¤** | â­â­â­â­â­ | â­â­ | â­â­â­â­ | â­â­ |
| **æˆç†Ÿåº¦** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | æé«˜ | é«˜ | é«˜ | ä¸­ |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | ä¸­ç­‰ | é™¡å³­ |

---

## 4. Istio vs Linkerd è¯¦ç»†å¯¹æ¯”

### 4.1 æ¶æ„å¯¹æ¯”

**Istio æ¶æ„**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Istiod (Control Plane)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Pilot    â”‚  â”‚  Citadel   â”‚         â”‚
â”‚  â”‚ (æµé‡ç®¡ç†)  â”‚  â”‚  (è¯ä¹¦)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Envoy  â”‚      â”‚ Envoy  â”‚    â”‚ Envoy  â”‚
â”‚ Proxy  â”‚      â”‚ Proxy  â”‚    â”‚ Proxy  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Linkerd æ¶æ„**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Linkerd Control Plane              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚Destinationâ”‚  â”‚ Identity â”‚             â”‚
â”‚  â”‚ (æœåŠ¡å‘ç°) â”‚  â”‚ (è¯ä¹¦)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚linkerd2-proxyâ”‚ â”‚linkerd2-proxyâ”‚ â”‚linkerd2-proxyâ”‚
â”‚  (Rust)      â”‚ â”‚  (Rust)      â”‚ â”‚  (Rust)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 æ€§èƒ½å¯¹æ¯”

**åŸºå‡†æµ‹è¯•ç»“æœ** (å‚è€ƒå€¼):

| æŒ‡æ ‡ | Istio | Linkerd | è¯´æ˜ |
|-----|-------|---------|------|
| **P50 å»¶è¿Ÿå¢åŠ ** | +3ms | +1ms | ä¸­ä½æ•°å»¶è¿Ÿ |
| **P99 å»¶è¿Ÿå¢åŠ ** | +10ms | +3ms | 99 åˆ†ä½å»¶è¿Ÿ |
| **CPU å¼€é”€ (æ¯ Pod)** | 50-100m | 20-50m | Sidecar CPU æ¶ˆè€— |
| **å†…å­˜å¼€é”€ (æ¯ Pod)** | 50-100MB | 20-50MB | Sidecar å†…å­˜æ¶ˆè€— |
| **ååé‡å½±å“** | -10% | -5% | ç›¸å¯¹äºæ— ç½‘æ ¼ |

**ç»“è®º**:

- **Linkerd** åœ¨æ€§èƒ½å’Œèµ„æºå¼€é”€ä¸Šä¼˜äº Istio
- **Istio** åŠŸèƒ½æ›´ä¸°å¯Œ,æ€§èƒ½æŸè€—åœ¨å¯æ¥å—èŒƒå›´å†…

---

### 4.3 åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | Istio | Linkerd | å¤‡æ³¨ |
|-----|-------|---------|------|
| **æµé‡ç®¡ç†** ||||
| é‡‘ä¸é›€å‘å¸ƒ | âœ… | âœ… | ä¸¤è€…éƒ½æ”¯æŒ |
| è“ç»¿éƒ¨ç½² | âœ… | âœ… | |
| æµé‡é•œåƒ | âœ… | âŒ | Istio ç‹¬æœ‰ |
| **å®‰å…¨** ||||
| mTLS | âœ… | âœ… | ä¸¤è€…éƒ½è‡ªåŠ¨å¯ç”¨ |
| æˆæƒç­–ç•¥ | âœ… | âœ… | |
| å¤–éƒ¨ CA é›†æˆ | âœ… | âŒ | Istio æ”¯æŒ |
| **å¯è§‚æµ‹æ€§** ||||
| æŒ‡æ ‡ | âœ… | âœ… | ä¸¤è€…éƒ½åŸºäº Prometheus |
| åˆ†å¸ƒå¼è¿½è¸ª | âœ… | âœ… | |
| è®¿é—®æ—¥å¿— | âœ… | âŒ | Istio æ”¯æŒ |
| **å¤šé›†ç¾¤** ||||
| å¤šé›†ç¾¤æ”¯æŒ | âœ… | âš ï¸ (æœ‰é™) | Istio æ›´æˆç†Ÿ |
| è·¨é›†ç¾¤æœåŠ¡å‘ç° | âœ… | âŒ | |
| **å…¶ä»–** ||||
| è™šæ‹Ÿæœºæ”¯æŒ | âœ… | âŒ | Istio æ”¯æŒ |
| Egress ç½‘å…³ | âœ… | âŒ | |
| WebAssembly æ‰©å±• | âœ… | âŒ | |

---

### 4.4 ç¤¾åŒºå¯¹æ¯”

| å¯¹æ¯”é¡¹ | Istio | Linkerd |
|-------|-------|---------|
| **GitHub Stars** | 35k+ | 10k+ |
| **è´¡çŒ®è€…** | 1000+ | 300+ |
| **ä¼ä¸šæ”¯æŒ** | Google, IBM, Red Hat | Buoyant |
| **CNCF çŠ¶æ€** | å·²æ¯•ä¸š (2023) | å·²æ¯•ä¸š (2021) |
| **å‘å¸ƒå‘¨æœŸ** | å­£åº¦å‘å¸ƒ | å­£åº¦å‘å¸ƒ |
| **å•†ä¸šæ”¯æŒ** | å¤šå®¶å‚å•† (Google Cloud, Red Hat) | Buoyant |

---

## 5. ä½¿ç”¨åœºæ™¯

### 5.1 å¾®æœåŠ¡æ²»ç†

**å…¸å‹é—®é¢˜**:

- æœåŠ¡é—´è°ƒç”¨å¤æ‚,éš¾ä»¥è¿½è¸ª
- ç¼ºä¹ç»Ÿä¸€çš„æµé‡ç®¡ç†
- å®‰å…¨ç­–ç•¥åˆ†æ•£åœ¨å„æœåŠ¡ä¸­

**æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆ**:

```yaml
# ç»Ÿä¸€æµé‡ç®¡ç†
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: global-timeout
spec:
  hosts:
  - "*"
  http:
  - timeout: 10s  # å…¨å±€è¶…æ—¶ç­–ç•¥
    retries:
      attempts: 3
```

---

### 5.2 å¤šé›†ç¾¤ç®¡ç†

**åœºæ™¯**: è·¨åœ°åŸŸ/è·¨äº‘çš„å¤šé›†ç¾¤æ¶æ„

**Istio å¤šé›†ç¾¤æ–¹æ¡ˆ**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cluster 1 (US)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cluster 2 (EU)  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   mTLS    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Istiod    â”‚  â”‚           â”‚  â”‚  Istiod    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Services   â”‚  â”‚           â”‚  â”‚ Services   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®**:

```yaml
# è·¨é›†ç¾¤æœåŠ¡è®¿é—®
apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: external-svc
spec:
  hosts:
  - service-in-cluster2.global
  location: MESH_INTERNAL
  ports:
  - number: 80
    name: http
    protocol: HTTP
  resolution: DNS
```

---

### 5.3 æ··åˆäº‘/å¤šäº‘

**åœºæ™¯**: åŒæ—¶è¿è¡Œåœ¨ AWS/Azure/GCP çš„æœåŠ¡éœ€è¦äº’è®¿

**è§£å†³æ–¹æ¡ˆ**:

- ç»Ÿä¸€ mTLS åŠ å¯†
- è·¨äº‘æœåŠ¡å‘ç°
- ç»Ÿä¸€æµé‡ç­–ç•¥

---

### 5.4 é›¶ä¿¡ä»»å®‰å…¨

**åŸåˆ™**: "æ°¸ä¸ä¿¡ä»»,å§‹ç»ˆéªŒè¯"

**æœåŠ¡ç½‘æ ¼å®ç°**:

```yaml
# é»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: deny-all
  namespace: default
spec:
  {}  # ç©ºè§„åˆ™ = æ‹’ç»æ‰€æœ‰
---
# æ˜¾å¼å…è®¸ç‰¹å®šæœåŠ¡
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-frontend-to-backend
spec:
  selector:
    matchLabels:
      app: backend
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/default/sa/frontend"]
```

---

## 6. é€‰å‹å»ºè®®

### 6.1 é€‰å‹ç»´åº¦

| ç»´åº¦ | Istio | Linkerd |
|-----|-------|---------|
| **å›¢é˜Ÿè§„æ¨¡** | å¤§å‹ (>50äºº) | ä¸­å°å‹ (<50äºº) |
| **æŠ€æœ¯èƒ½åŠ›** | é«˜ (éœ€ä¸“äººç»´æŠ¤) | ä¸­ (æ˜“ä¸Šæ‰‹) |
| **åŠŸèƒ½éœ€æ±‚** | å¤æ‚ (å¤šé›†ç¾¤/å¤šäº‘) | ç®€å• (åŸºç¡€æµé‡ç®¡ç†) |
| **æ€§èƒ½è¦æ±‚** | ä¸­ç­‰ | é«˜ |
| **é¢„ç®—** | å……è¶³ (éœ€æ›´å¤šèµ„æº) | æœ‰é™ |

---

### 6.2 é€‚ç”¨åœºæ™¯

**é€‰æ‹© Istio**:

- âœ… å¤§å‹ä¼ä¸š/é‡‘èè¡Œä¸š
- âœ… å¤šé›†ç¾¤/å¤šäº‘æ¶æ„
- âœ… éœ€è¦é«˜çº§æµé‡ç®¡ç† (æµé‡é•œåƒ/Egress ç½‘å…³)
- âœ… å·²æœ‰ Envoy ç»éªŒ

**é€‰æ‹© Linkerd**:

- âœ… åˆåˆ›å…¬å¸/ä¸­å°å‹å›¢é˜Ÿ
- âœ… æ³¨é‡æ€§èƒ½å’Œç¨³å®šæ€§
- âœ… ç®€å•å¾®æœåŠ¡æ¶æ„
- âœ… éœ€è¦å¿«é€Ÿä¸Šæ‰‹

---

### 6.3 å†³ç­–æ ‘

```text
æ˜¯å¦éœ€è¦å¤šé›†ç¾¤æ”¯æŒ?
â”œâ”€ æ˜¯ â†’ Istio
â””â”€ å¦
    â”œâ”€ å›¢é˜ŸæŠ€æœ¯èƒ½åŠ›å¼º?
    â”‚   â”œâ”€ æ˜¯ â†’ Istio (åŠŸèƒ½ä¸°å¯Œ)
    â”‚   â””â”€ å¦ â†’ Linkerd (æ˜“ç”¨)
    â””â”€ å¯¹æ€§èƒ½è¦æ±‚æé«˜?
        â”œâ”€ æ˜¯ â†’ Linkerd / Cilium Service Mesh
        â””â”€ å¦ â†’ Istio / Linkerd éƒ½å¯
```

---

### 6.4 è¿ç§»ç­–ç•¥

**æ¸è¿›å¼è¿ç§»æ­¥éª¤**:

```text
1. åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æœåŠ¡ç½‘æ ¼
        â†“
2. é€‰æ‹© 1-2 ä¸ªéå…³é”®æœåŠ¡è¿›è¡Œç°åº¦
        â†“
3. éªŒè¯åŠŸèƒ½/æ€§èƒ½/ç¨³å®šæ€§
        â†“
4. é€æ­¥æ‰©å¤§åˆ°æ›´å¤šæœåŠ¡
        â†“
5. ç”Ÿäº§ç¯å¢ƒå…¨é‡ä¸Šçº¿
```

---

## 7. æœåŠ¡ç½‘æ ¼ä¸å…¶ä»–æŠ€æœ¯å¯¹æ¯”

### 7.1 æœåŠ¡ç½‘æ ¼ vs API ç½‘å…³

| å¯¹æ¯”é¡¹ | æœåŠ¡ç½‘æ ¼ | API ç½‘å…³ |
|-------|---------|---------|
| **éƒ¨ç½²ä½ç½®** | æœåŠ¡é—´ (East-West) | é›†ç¾¤è¾¹ç¼˜ (North-South) |
| **ä¸»è¦åŠŸèƒ½** | æœåŠ¡é—´é€šä¿¡æ²»ç† | å¤–éƒ¨æµé‡å…¥å£ |
| **æµé‡ç±»å‹** | å†…éƒ¨å¾®æœåŠ¡æµé‡ | å¤–éƒ¨ API è¯·æ±‚ |
| **èº«ä»½è®¤è¯** | mTLS | OAuth/JWT |
| **é€‚ç”¨åœºæ™¯** | å¾®æœåŠ¡æ²»ç† | API ç®¡ç†/é™æµ |

**ååŒä½¿ç”¨**:

```text
å¤–éƒ¨æµé‡ â†’ API ç½‘å…³ (Kong/APISIX) â†’ æœåŠ¡ç½‘æ ¼ (Istio) â†’ å¾®æœåŠ¡
```

---

### 7.2 æœåŠ¡ç½‘æ ¼ vs Kubernetes Ingress

| å¯¹æ¯”é¡¹ | æœåŠ¡ç½‘æ ¼ | Ingress |
|-------|---------|---------|
| **æµé‡ç±»å‹** | æœåŠ¡é—´ (East-West) | å…¥å£æµé‡ (North-South) |
| **åŠŸèƒ½** | æµé‡ç®¡ç†/å®‰å…¨/å¯è§‚æµ‹æ€§ | HTTP è·¯ç”± |
| **åè®®æ”¯æŒ** | HTTP/TCP/gRPC | HTTP/HTTPS |
| **æ˜¯å¦å¯æ›¿ä»£** | ä¸å¯æ›¿ä»£ | å¯é€šè¿‡æœåŠ¡ç½‘æ ¼ç½‘å…³æ›¿ä»£ |

---

### 7.3 æœåŠ¡ç½‘æ ¼ vs ä¼ ç»Ÿè´Ÿè½½å‡è¡¡

| å¯¹æ¯”é¡¹ | æœåŠ¡ç½‘æ ¼ | ä¼ ç»Ÿè´Ÿè½½å‡è¡¡ (Nginx/HAProxy) |
|-------|---------|---------------------------|
| **è´Ÿè½½å‡è¡¡ä½ç½®** | å®¢æˆ·ç«¯ (Sidecar) | æœåŠ¡ç«¯ (é›†ä¸­å¼) |
| **æœåŠ¡å‘ç°** | è‡ªåŠ¨ | æ‰‹åŠ¨é…ç½® |
| **å¥åº·æ£€æŸ¥** | è‡ªåŠ¨ | æ‰‹åŠ¨é…ç½® |
| **æ•…éšœå¤„ç†** | è‡ªåŠ¨ç†”æ–­/é‡è¯• | åŸºç¡€å¥åº·æ£€æŸ¥ |
| **å¯è§‚æµ‹æ€§** | åŸç”Ÿæ”¯æŒ | éœ€é¢å¤–é›†æˆ |

---

## 8. éƒ¨ç½²æ¨¡å¼

### 8.1 å…¨é¢éƒ¨ç½²

**ç­–ç•¥**: æ‰€æœ‰æœåŠ¡å¯ç”¨æœåŠ¡ç½‘æ ¼

**ä¼˜ç‚¹**:

- âœ… ç»Ÿä¸€ç®¡ç†
- âœ… åŠŸèƒ½å®Œæ•´

**ç¼ºç‚¹**:

- âŒ èµ„æºå¼€é”€å¤§
- âŒ é£é™©é«˜ (æ•…éšœå½±å“èŒƒå›´å¤§)

---

### 8.2 æ¸è¿›å¼éƒ¨ç½²

**ç­–ç•¥**: é€æ­¥ä¸ºæœåŠ¡å¯ç”¨æœåŠ¡ç½‘æ ¼

**æ­¥éª¤**:

```text
1. æ ¸å¿ƒæœåŠ¡ (10% æµé‡)
        â†“
2. ä¸šåŠ¡æœåŠ¡ (50% æµé‡)
        â†“
3. å…¨éƒ¨æœåŠ¡ (100% æµé‡)
```

**ä¼˜ç‚¹**:

- âœ… é£é™©å¯æ§
- âœ… å¯éšæ—¶å›æ»š

---

### 8.3 Sidecar vs Sidecar-less

**Sidecar æ¨¡å¼**:

```yaml
# Istio è‡ªåŠ¨æ³¨å…¥
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    istio-injection: enabled
```

**Sidecar-less (Ambient Mesh)**:

```yaml
# Istio Ambient æ¨¡å¼
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    istio.io/dataplane-mode: ambient
```

---

## 9. æ€§èƒ½ä¸æˆæœ¬

### 9.1 æ€§èƒ½å½±å“

**å»¶è¿Ÿå½±å“**:

| åœºæ™¯ | æ— æœåŠ¡ç½‘æ ¼ | Linkerd | Istio |
|-----|----------|---------|-------|
| **P50 å»¶è¿Ÿ** | 5ms | 6ms (+20%) | 8ms (+60%) |
| **P99 å»¶è¿Ÿ** | 20ms | 23ms (+15%) | 30ms (+50%) |

**ååé‡å½±å“**:

- Linkerd: -5%
- Istio: -10%

---

### 9.2 èµ„æºå¼€é”€

**æ¯ Pod èµ„æºå¼€é”€**:

| ç»„ä»¶ | Linkerd | Istio |
|-----|---------|-------|
| **CPU (m)** | 20-50 | 50-100 |
| **å†…å­˜ (MB)** | 20-50 | 50-100 |

**é›†ç¾¤æ€»å¼€é”€ (100 Pods)**:

- Linkerd: 2-5 CPUæ ¸å¿ƒ, 2-5 GB å†…å­˜
- Istio: 5-10 CPUæ ¸å¿ƒ, 5-10 GB å†…å­˜

---

### 9.3 æˆæœ¬åˆ†æ

**å¹´åº¦æˆæœ¬ä¼°ç®—** (100 Pods, AWS):

```text
æ— æœåŠ¡ç½‘æ ¼: $0
Linkerd:    $500-1000 (é¢å¤–èŠ‚ç‚¹æˆæœ¬)
Istio:      $1000-2000 (é¢å¤–èŠ‚ç‚¹æˆæœ¬)
```

**éšæ€§æˆæœ¬**:

- å­¦ä¹ æˆæœ¬
- è¿ç»´æˆæœ¬
- æ•…éšœæ’æŸ¥æˆæœ¬

---

## 10. æœ€ä½³å®è·µ

### 10.1 éƒ¨ç½²å»ºè®®

**1. å‘½åç©ºé—´éš”ç¦»**:

```yaml
# ç”Ÿäº§ç¯å¢ƒå¯ç”¨æœåŠ¡ç½‘æ ¼
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    istio-injection: enabled

# æµ‹è¯•ç¯å¢ƒä¸å¯ç”¨
apiVersion: v1
kind: Namespace
metadata:
  name: testing
  labels:
    istio-injection: disabled
```

**2. èµ„æºé™åˆ¶**:

```yaml
# Sidecar èµ„æºé™åˆ¶
spec:
  containers:
  - name: istio-proxy
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 2000m
        memory: 1024Mi
```

---

### 10.2 ç›‘æ§ä¸å‘Šè­¦

**å…³é”®æŒ‡æ ‡**:

```yaml
# Prometheus å‘Šè­¦è§„åˆ™
groups:
- name: istio.rules
  rules:
  # æœåŠ¡æˆåŠŸç‡ < 95%
  - alert: HighErrorRate
    expr: |
      sum(rate(istio_requests_total{response_code=~"5.."}[5m])) 
      / 
      sum(rate(istio_requests_total[5m])) > 0.05
    for: 5m
    annotations:
      summary: "Error rate > 5%"
  
  # P99 å»¶è¿Ÿ > 1s
  - alert: HighLatency
    expr: |
      histogram_quantile(0.99, 
        sum(rate(istio_request_duration_milliseconds_bucket[5m])) by (le)
      ) > 1000
    for: 5m
```

---

### 10.3 æ•…éšœæ’æŸ¥

**å¸¸è§é—®é¢˜**:

**1. Sidecar æ³¨å…¥å¤±è´¥**:

```bash
# æ£€æŸ¥å‘½åç©ºé—´æ ‡ç­¾
kubectl get namespace production -o yaml | grep istio-injection

# æ‰‹åŠ¨æ³¨å…¥
istioctl kube-inject -f deployment.yaml | kubectl apply -f -
```

**2. mTLS è¿æ¥å¤±è´¥**:

```bash
# æ£€æŸ¥ mTLS çŠ¶æ€
istioctl authn tls-check <pod-name>.<namespace>

# æŸ¥çœ‹è¯ä¹¦
istioctl proxy-config secret <pod-name> -n <namespace>
```

---

### 10.4 å‡çº§ç­–ç•¥

**é‡‘ä¸é›€å‡çº§**:

```bash
# 1. å‡çº§æ§åˆ¶å¹³é¢åˆ°æ–°ç‰ˆæœ¬ (ä¿æŒæ—§ç‰ˆæœ¬æ•°æ®å¹³é¢)
istioctl install --set revision=1-20-0

# 2. ä¸ºå‘½åç©ºé—´æ‰“æ ‡ç­¾,ä½¿ç”¨æ–°ç‰ˆæœ¬ Sidecar
kubectl label namespace production istio.io/rev=1-20-0

# 3. é‡å¯ Pod,æ³¨å…¥æ–°ç‰ˆæœ¬ Sidecar
kubectl rollout restart deployment -n production

# 4. éªŒè¯æˆåŠŸå,æ¸…ç†æ—§ç‰ˆæœ¬æ§åˆ¶å¹³é¢
istioctl uninstall --revision=1-19-0
```

---

## æ€»ç»“

**æœåŠ¡ç½‘æ ¼æ ¸å¿ƒä»·å€¼**:

- âœ… **é€æ˜åŒ–**: æ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç 
- âœ… **ç»Ÿä¸€ç®¡ç†**: é›†ä¸­é…ç½®æµé‡/å®‰å…¨ç­–ç•¥
- âœ… **å¯è§‚æµ‹æ€§**: è‡ªåŠ¨æ”¶é›†æŒ‡æ ‡/æ—¥å¿—/è¿½è¸ª
- âœ… **å¼¹æ€§**: è‡ªåŠ¨ç†”æ–­/é‡è¯•/è¶…æ—¶

**ä½•æ—¶ä½¿ç”¨æœåŠ¡ç½‘æ ¼**:

- âœ… å¾®æœåŠ¡æ•°é‡ > 10
- âœ… éœ€è¦ç»†ç²’åº¦æµé‡æ§åˆ¶
- âœ… éœ€è¦æœåŠ¡é—´åŠ å¯† (mTLS)
- âœ… éœ€è¦åˆ†å¸ƒå¼è¿½è¸ª
- âŒ ç®€å•å•ä½“åº”ç”¨ (ä¸æ¨è)

**é€‰å‹å»ºè®®**:

- **Istio**: å¤§å‹ä¼ä¸šã€å¤šé›†ç¾¤ã€åŠŸèƒ½ä¸°å¯Œ
- **Linkerd**: ä¸­å°å‹å›¢é˜Ÿã€ç®€å•æ˜“ç”¨ã€é«˜æ€§èƒ½
- **Cilium Service Mesh**: å¯¹æ€§èƒ½è¦æ±‚æé«˜ã€å·²ä½¿ç”¨ Cilium CNI

---

**ç›¸å…³æ–‡æ¡£**:

- [Istioéƒ¨ç½²ä¸é…ç½®](02_Istioéƒ¨ç½²ä¸é…ç½®.md)
- [Linkerdéƒ¨ç½²ä¸é…ç½®](03_Linkerdéƒ¨ç½²ä¸é…ç½®.md)
- [æœåŠ¡ç½‘æ ¼æµé‡ç®¡ç†](04_æœåŠ¡ç½‘æ ¼æµé‡ç®¡ç†.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**å‚è€ƒ**: Istio 1.20, Linkerd 2.14
