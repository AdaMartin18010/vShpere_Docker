# ç½‘ç»œå®‰å…¨ç­–ç•¥

> **è¿”å›ž**: [ç½‘ç»œæž¶æž„ç›®å½•](README.md) | [è™šæ‹ŸåŒ–éƒ¨ç½²é¦–é¡µ](../README.md) | [éƒ¨ç½²æŒ‡å—é¦–é¡µ](../../00_ç´¢å¼•å¯¼èˆª/README.md)

---

## ðŸ“‹ ç›®å½•

- [ç½‘ç»œå®‰å…¨ç­–ç•¥](#ç½‘ç»œå®‰å…¨ç­–ç•¥)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. å®‰å…¨è®¾è®¡åŽŸåˆ™](#1-å®‰å…¨è®¾è®¡åŽŸåˆ™)
  - [2. é˜²ç«å¢™é…ç½®](#2-é˜²ç«å¢™é…ç½®)
    - [2.1 Linuxé˜²ç«å¢™ (iptables/nftables)](#21-linuxé˜²ç«å¢™-iptablesnftables)
    - [2.2 UFWé˜²ç«å¢™ (Ubuntu)](#22-ufwé˜²ç«å¢™-ubuntu)
    - [2.3 firewalldé˜²ç«å¢™ (CentOS/RHEL)](#23-firewalldé˜²ç«å¢™-centosrhel)
  - [3. ACLè®¿é—®æŽ§åˆ¶](#3-aclè®¿é—®æŽ§åˆ¶)
    - [3.1 Ciscoæ ‡å‡†ACL](#31-ciscoæ ‡å‡†acl)
    - [3.2 Ciscoæ‰©å±•ACL](#32-ciscoæ‰©å±•acl)
    - [3.3 æ—¶é—´èŒƒå›´ACL](#33-æ—¶é—´èŒƒå›´acl)
    - [3.4 åŽä¸ºACLé…ç½®](#34-åŽä¸ºaclé…ç½®)
  - [4. ç½‘ç»œéš”ç¦»ä¸Žåˆ†æ®µ](#4-ç½‘ç»œéš”ç¦»ä¸Žåˆ†æ®µ)
    - [4.1 VLANéš”ç¦»](#41-vlanéš”ç¦»)
    - [4.2 Private VLANéš”ç¦»](#42-private-vlanéš”ç¦»)
    - [4.3 å¾®åˆ†æ®µ (Micro-segmentation)](#43-å¾®åˆ†æ®µ-micro-segmentation)
      - [Kubernetes NetworkPolicyç¤ºä¾‹](#kubernetes-networkpolicyç¤ºä¾‹)
  - [5. VPNé…ç½®](#5-vpné…ç½®)
    - [5.1 IPSec VPN (Site-to-Site)](#51-ipsec-vpn-site-to-site)
    - [5.2 OpenVPNæœåŠ¡å™¨é…ç½®](#52-openvpnæœåŠ¡å™¨é…ç½®)
    - [5.3 WireGuard VPN (çŽ°ä»£åŒ–)](#53-wireguard-vpn-çŽ°ä»£åŒ–)
  - [6. å…¥ä¾µæ£€æµ‹ä¸Žé˜²æŠ¤](#6-å…¥ä¾µæ£€æµ‹ä¸Žé˜²æŠ¤)
    - [6.1 Snort IDSé…ç½®](#61-snort-idsé…ç½®)
    - [6.2 Suricata IDS/IPS](#62-suricata-idsips)
  - [7. DDoSé˜²æŠ¤](#7-ddosé˜²æŠ¤)
    - [Linuxç³»ç»ŸDDoSé˜²æŠ¤](#linuxç³»ç»Ÿddosé˜²æŠ¤)
  - [8. å®‰å…¨å®¡è®¡ä¸Žæ—¥å¿—](#8-å®‰å…¨å®¡è®¡ä¸Žæ—¥å¿—)
    - [8.1 é›†ä¸­æ—¥å¿—æ”¶é›† (ELK Stack)](#81-é›†ä¸­æ—¥å¿—æ”¶é›†-elk-stack)
    - [8.2 å®¡è®¡æ—¥å¿—é…ç½®](#82-å®¡è®¡æ—¥å¿—é…ç½®)
  - [9. å®‰å…¨åŠ å›ºæ¸…å•](#9-å®‰å…¨åŠ å›ºæ¸…å•)
  - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. å®‰å…¨è®¾è®¡åŽŸåˆ™

```yaml
ç½‘ç»œå®‰å…¨æ ¸å¿ƒåŽŸåˆ™:
  é›¶ä¿¡ä»»æž¶æž„ (Zero Trust):
    åŽŸåˆ™: æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯
    å®žæ–½:
      - é»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
      - æ˜¾å¼æŽˆæƒå¿…è¦æµé‡
      - æœ€å°æƒé™åŽŸåˆ™
      - æŒç»­éªŒè¯èº«ä»½
      - å¾®åˆ†æ®µéš”ç¦»
    
  çºµæ·±é˜²å¾¡ (Defense in Depth):
    å±‚æ¬¡:
      L1_ç‰©ç†å±‚: æœºæˆ¿é—¨ç¦ã€ç›‘æŽ§
      L2_ç½‘ç»œå±‚: é˜²ç«å¢™ã€IPSã€éš”ç¦»
      L3_ä¸»æœºå±‚: é˜²ç—…æ¯’ã€è¡¥ä¸ã€åŠ å›º
      L4_åº”ç”¨å±‚: WAFã€è¾“å…¥éªŒè¯
      L5_æ•°æ®å±‚: åŠ å¯†ã€å¤‡ä»½ã€å®¡è®¡
    
  æœ€å°æƒé™åŽŸåˆ™:
    ç½‘ç»œ: åªå¼€æ”¾å¿…è¦ç«¯å£
    ç”¨æˆ·: åªæŽˆäºˆå¿…è¦æƒé™
    æœåŠ¡: åªè¿è¡Œå¿…è¦æœåŠ¡
    æ•°æ®: åªè®¿é—®å¿…è¦æ•°æ®

å®‰å…¨åŒºåŸŸåˆ’åˆ†:
  DMZ (éžå†›äº‹åŒº):
    ä½ç½®: å¤–ç½‘ä¸Žå†…ç½‘ä¹‹é—´
    ç”¨é€”: å¯¹å¤–æœåŠ¡ (Web/é‚®ä»¶/DNS)
    éš”ç¦»: é˜²ç«å¢™éš”ç¦»å†…å¤–ç½‘
  
  å†…ç½‘åŒº:
    ç®¡ç†åŒº: VLAN 10 - ç®¡ç†è®¾å¤‡
    åŠžå…¬åŒº: VLAN 100 - åŠžå…¬ç»ˆç«¯
    ç”Ÿäº§åŒº: VLAN 40-42 - ç”Ÿäº§ç³»ç»Ÿ
    å­˜å‚¨åŒº: VLAN 30-31 - å­˜å‚¨ç½‘ç»œ
  
  è®¿é—®æŽ§åˆ¶:
    å¤–ç½‘ â†’ DMZ: å…è®¸ (HTTP/HTTPS)
    DMZ â†’ å†…ç½‘: ä¸¥æ ¼é™åˆ¶
    å†…ç½‘ â†’ DMZ: å…è®¸
    å†…ç½‘å„åŒº: æŒ‰éœ€æŽ§åˆ¶
```

---

## 2. é˜²ç«å¢™é…ç½®

### 2.1 Linuxé˜²ç«å¢™ (iptables/nftables)

```bash
#!/bin/bash
# ========================================
# iptablesé˜²ç«å¢™é…ç½®è„šæœ¬
# ========================================

# æ¸…ç©ºçŽ°æœ‰è§„åˆ™
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X

# è®¾ç½®é»˜è®¤ç­–ç•¥ (é»˜è®¤æ‹’ç»)
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# å…è®¸æœ¬åœ°å›žçŽ¯
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# å…è®¸å·²å»ºç«‹è¿žæŽ¥
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

# é˜²æ­¢SYNæ´ªæ°´æ”»å‡»
iptables -A INPUT -p tcp --syn -m limit --limit 1/s --limit-burst 3 -j ACCEPT
iptables -A INPUT -p tcp --syn -j DROP

# é˜²æ­¢ICMPæ´ªæ°´æ”»å‡»
iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s -j ACCEPT

# å…è®¸SSH (é™åˆ¶æ¥æº)
iptables -A INPUT -p tcp -s 192.168.10.0/24 --dport 22 -m state --state NEW -j ACCEPT

# å…è®¸HTTP/HTTPS
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# å…è®¸DNS
iptables -A INPUT -p udp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -j ACCEPT

# è®°å½•è¢«æ‹’ç»çš„åŒ…
iptables -A INPUT -m limit --limit 5/min -j LOG --log-prefix "iptables INPUT denied: " --log-level 7
iptables -A FORWARD -m limit --limit 5/min -j LOG --log-prefix "iptables FORWARD denied: " --log-level 7

# ä¿å­˜è§„åˆ™
iptables-save > /etc/iptables/rules.v4

echo "âœ… é˜²ç«å¢™è§„åˆ™é…ç½®å®Œæˆ"
iptables -L -v -n
```

### 2.2 UFWé˜²ç«å¢™ (Ubuntu)

```bash
#!/bin/bash
# ========================================
# UFWé˜²ç«å¢™é…ç½®
# ========================================

# é‡ç½®UFW
ufw --force reset

# é»˜è®¤ç­–ç•¥
ufw default deny incoming
ufw default allow outgoing

# å…è®¸SSH (é™åˆ¶æ¥æº)
ufw allow from 192.168.10.0/24 to any port 22 proto tcp

# å…è®¸HTTP/HTTPS
ufw allow 80/tcp
ufw allow 443/tcp

# å…è®¸ç‰¹å®šæœåŠ¡
ufw allow from 192.168.10.0/24 to any port 3306 proto tcp  # MySQL
ufw allow from 192.168.10.0/24 to any port 5432 proto tcp  # PostgreSQL

# é€ŸçŽ‡é™åˆ¶SSH
ufw limit 22/tcp

# å¯ç”¨æ—¥å¿—
ufw logging medium

# å¯ç”¨UFW
ufw --force enable

# æŸ¥çœ‹çŠ¶æ€
ufw status verbose
```

### 2.3 firewalldé˜²ç«å¢™ (CentOS/RHEL)

```bash
#!/bin/bash
# ========================================
# firewalldé˜²ç«å¢™é…ç½®
# ========================================

# å¯åŠ¨firewalld
systemctl start firewalld
systemctl enable firewalld

# è®¾ç½®é»˜è®¤åŒºåŸŸ
firewall-cmd --set-default-zone=public

# åˆ›å»ºè‡ªå®šä¹‰åŒºåŸŸ
firewall-cmd --permanent --new-zone=management
firewall-cmd --permanent --new-zone=dmz-zone
firewall-cmd --permanent --new-zone=internal

# é…ç½®ç®¡ç†åŒºåŸŸ
firewall-cmd --permanent --zone=management --add-source=192.168.10.0/24
firewall-cmd --permanent --zone=management --add-service=ssh
firewall-cmd --permanent --zone=management --add-service=https

# é…ç½®DMZåŒºåŸŸ
firewall-cmd --permanent --zone=dmz-zone --add-service=http
firewall-cmd --permanent --zone=dmz-zone --add-service=https

# é…ç½®å†…ç½‘åŒºåŸŸ
firewall-cmd --permanent --zone=internal --add-source=10.100.0.0/16
firewall-cmd --permanent --zone=internal --add-service=mysql
firewall-cmd --permanent --zone=internal --add-service=postgresql

# ç«¯å£è½¬å‘ç¤ºä¾‹
firewall-cmd --permanent --zone=public --add-forward-port=port=8080:proto=tcp:toport=80

# å¯Œè§„åˆ™ (é«˜çº§è§„åˆ™)
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.10.0/24" port port="3306" protocol="tcp" accept'

# é‡è½½é…ç½®
firewall-cmd --reload

# æŸ¥çœ‹é…ç½®
firewall-cmd --list-all-zones
```

---

## 3. ACLè®¿é—®æŽ§åˆ¶

### 3.1 Ciscoæ ‡å‡†ACL

```cisco
! ========================================
! Ciscoæ ‡å‡†ACLé…ç½®
! ========================================

! æ ‡å‡†ACL (1-99, 1300-1999)
! åªèƒ½åŒ¹é…æºIPåœ°å€

! å…è®¸ç®¡ç†ç½‘ç»œè®¿é—®
access-list 10 permit 192.168.10.0 0.0.0.255
access-list 10 deny any log

! åº”ç”¨åˆ°æŽ¥å£
interface Vlan10
 ip access-group 10 in

! éªŒè¯
show access-lists
show ip access-lists 10
show ip interface Vlan10
```

### 3.2 Ciscoæ‰©å±•ACL

```cisco
! ========================================
! Ciscoæ‰©å±•ACLé…ç½®
! ========================================

! æ‰©å±•ACL (100-199, 2000-2699)
! å¯ä»¥åŒ¹é…æº/ç›®æ ‡IPã€ç«¯å£ã€åè®®

! é™åˆ¶æ•°æ®åº“è®¿é—®
ip access-list extended DB-ACCESS
 remark === Allow app servers to database ===
 permit tcp 10.100.41.0 0.0.0.255 10.100.42.0 0.0.0.127 eq 3306
 permit tcp 10.100.41.0 0.0.0.255 10.100.42.0 0.0.0.127 eq 5432
 remark === Deny all other traffic ===
 deny ip any 10.100.42.0 0.0.0.127 log
 permit ip any any

! WebæœåŠ¡å™¨ACL
ip access-list extended WEB-ACCESS
 remark === Allow HTTP/HTTPS from anywhere ===
 permit tcp any 10.100.40.0 0.0.0.255 eq 80
 permit tcp any 10.100.40.0 0.0.0.255 eq 443
 remark === Allow SSH from management ===
 permit tcp 192.168.10.0 0.0.0.255 10.100.40.0 0.0.0.255 eq 22
 remark === Deny all other inbound ===
 deny ip any 10.100.40.0 0.0.0.255 log
 permit ip any any

! åº”ç”¨ACL
interface Vlan42
 description Database-Tier
 ip access-group DB-ACCESS in

interface Vlan40
 description Web-Tier
 ip access-group WEB-ACCESS in

! éªŒè¯
show access-lists
show ip interface Vlan42
```

### 3.3 æ—¶é—´èŒƒå›´ACL

```cisco
! ========================================
! åŸºäºŽæ—¶é—´çš„ACL
! ========================================

! å®šä¹‰æ—¶é—´èŒƒå›´ (å·¥ä½œæ—¶é—´)
time-range BUSINESS-HOURS
 periodic weekdays 8:00 to 18:00

! å®šä¹‰æ—¶é—´èŒƒå›´ (ç»´æŠ¤çª—å£)
time-range MAINTENANCE-WINDOW
 periodic weekend 2:00 to 6:00

! ä½¿ç”¨æ—¶é—´èŒƒå›´çš„ACL
ip access-list extended TIMED-ACCESS
 permit tcp 192.168.100.0 0.0.0.255 any eq 80 time-range BUSINESS-HOURS
 permit tcp 192.168.100.0 0.0.0.255 any eq 443 time-range BUSINESS-HOURS
 deny ip any any log

! åº”ç”¨
interface GigabitEthernet1/0/1
 ip access-group TIMED-ACCESS in
```

### 3.4 åŽä¸ºACLé…ç½®

```huawei
# ========================================
# åŽä¸ºACLé…ç½®
# ========================================

# åŸºæœ¬ACL (2000-2999)
acl number 2000
 description Management-Access
 rule 5 permit source 192.168.10.0 0.0.0.255
 rule 10 deny source any

# é«˜çº§ACL (3000-3999)
acl number 3000
 description Database-Access
 rule 5 permit tcp source 10.100.41.0 0.0.0.255 destination 10.100.42.0 0.0.0.127 destination-port eq 3306
 rule 10 permit tcp source 10.100.41.0 0.0.0.255 destination 10.100.42.0 0.0.0.127 destination-port eq 5432
 rule 15 deny ip destination 10.100.42.0 0.0.0.127

# åº”ç”¨ACL
interface Vlanif42
 traffic-filter inbound acl 3000

# éªŒè¯
display acl all
display acl 3000
display traffic-filter applied-record
```

---

## 4. ç½‘ç»œéš”ç¦»ä¸Žåˆ†æ®µ

### 4.1 VLANéš”ç¦»

```yaml
VLAN_Isolation:
  ç®¡ç†éš”ç¦»:
    VLAN_10: ç½‘ç»œè®¾å¤‡ç®¡ç†
    VLAN_11: è™šæ‹ŸåŒ–ç®¡ç† (vCenter/ESXi)
    è®¿é—®: ä¸¥æ ¼é™åˆ¶ï¼Œä»…ç®¡ç†å‘˜
  
  ä¸šåŠ¡éš”ç¦»:
    VLAN_40: Webå±‚
    VLAN_41: åº”ç”¨å±‚
    VLAN_42: æ•°æ®åº“å±‚
    ç­–ç•¥: å•å‘è®¿é—®ï¼Œé€å±‚é˜²æŠ¤
  
  å­˜å‚¨éš”ç¦»:
    VLAN_30: iSCSIå­˜å‚¨A
    VLAN_31: iSCSIå­˜å‚¨B
    ç‰¹ç‚¹: ç‹¬ç«‹ç½‘ç»œï¼ŒJumbo Frame
  
  å®‰å…¨ç­–ç•¥:
    - VLANé—´é»˜è®¤ç¦æ­¢é€šä¿¡
    - é€šè¿‡ACLæ˜¾å¼å…è®¸å¿…è¦æµé‡
    - è®°å½•æ‰€æœ‰è·¨VLANæµé‡
```

### 4.2 Private VLANéš”ç¦»

```cisco
! ========================================
! Private VLANç«¯å£éš”ç¦»
! ========================================

! åœºæ™¯ï¼šåŒä¸€VLANå†…æœåŠ¡å™¨ä¹‹é—´éš”ç¦»
! åº”ç”¨ï¼šWebæœåŠ¡å™¨é›†ç¾¤ï¼Œé˜²æ­¢æ¨ªå‘ç§»åŠ¨

! åˆ›å»ºPrivate VLAN
vlan 200
 name Primary-VLAN
 private-vlan primary

vlan 201
 name Isolated-VLAN
 private-vlan isolated

vlan 202
 name Community-VLAN
 private-vlan community

! å…³è”
vlan 200
 private-vlan association 201,202

! é…ç½®Promiscuousç«¯å£ (ç½‘å…³/é˜²ç«å¢™)
interface GigabitEthernet1/0/1
 description Gateway
 switchport mode private-vlan promiscuous
 switchport private-vlan mapping 200 201,202

! é…ç½®Isolatedç«¯å£ (å®Œå…¨éš”ç¦»çš„æœåŠ¡å™¨)
interface range GigabitEthernet1/0/10-20
 description Isolated-Web-Servers
 switchport mode private-vlan host
 switchport private-vlan host-association 200 201

! é…ç½®Communityç«¯å£ (å…è®¸ç»„å†…é€šä¿¡)
interface range GigabitEthernet1/0/21-30
 description App-Servers-Group
 switchport mode private-vlan host
 switchport private-vlan host-association 200 202
```

### 4.3 å¾®åˆ†æ®µ (Micro-segmentation)

```yaml
Micro_Segmentation:
  æ¦‚å¿µ: ç»†ç²’åº¦çš„ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æŽ§åˆ¶
  
  ä¼ ç»Ÿåˆ†æ®µ:
    ç²’åº¦: VLAN/å­ç½‘
    è§„åˆ™: åŸºäºŽç½‘ç»œä½ç½®
    é—®é¢˜: æ¨ªå‘ç§»åŠ¨é£Žé™©
  
  å¾®åˆ†æ®µ:
    ç²’åº¦: å·¥ä½œè´Ÿè½½/åº”ç”¨
    è§„åˆ™: åŸºäºŽèº«ä»½å’Œä¸Šä¸‹æ–‡
    ä¼˜åŠ¿: é›¶ä¿¡ä»»ï¼Œæœ€å°æƒé™
  
  å®žæ–½æ–¹å¼:
    VMware_NSX:
      - åˆ†å¸ƒå¼é˜²ç«å¢™
      - åŸºäºŽVMæ ‡ç­¾çš„ç­–ç•¥
      - åŠ¨æ€å®‰å…¨ç»„
    
    Kubernetes_NetworkPolicy:
      - Podçº§åˆ«éš”ç¦»
      - å‘½åç©ºé—´éš”ç¦»
      - Ingress/Egressè§„åˆ™
    
    Cisco_ACI:
      - åº”ç”¨ä¸ºä¸­å¿ƒ
      - åˆçº¦(Contract)æœºåˆ¶
      - EPG (Endpoint Group)
```

#### Kubernetes NetworkPolicyç¤ºä¾‹

```yaml
# ========================================
# Kubernetes NetworkPolicy
# ========================================

# ç­–ç•¥1: é»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress

---
# ç­–ç•¥2: å…è®¸Webåˆ°Appçš„æµé‡
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-web-to-app
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: app
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: web
    ports:
    - protocol: TCP
      port: 8080

---
# ç­–ç•¥3: å…è®¸Appåˆ°æ•°æ®åº“çš„æµé‡
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app-to-db
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: database
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: app
    ports:
    - protocol: TCP
      port: 3306
    - protocol: TCP
      port: 5432

---
# ç­–ç•¥4: å…è®¸DNSæŸ¥è¯¢
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Egress
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53
```

---

## 5. VPNé…ç½®

### 5.1 IPSec VPN (Site-to-Site)

```cisco
! ========================================
! Cisco IPSec Site-to-Site VPN
! ========================================

! ISAKMPç­–ç•¥ (Phase 1)
crypto isakmp policy 10
 encryption aes 256
 hash sha256
 authentication pre-share
 group 14
 lifetime 86400

! é¢„å…±äº«å¯†é’¥
crypto isakmp key VpnKey@2025 address 203.0.113.10

! IPSecè½¬æ¢é›† (Phase 2)
crypto ipsec transform-set STRONG-TRANSFORM esp-aes 256 esp-sha256-hmac
 mode tunnel

! å®šä¹‰æ„Ÿå…´è¶£æµé‡
ip access-list extended VPN-TRAFFIC
 permit ip 192.168.10.0 0.0.0.255 10.20.30.0 0.0.0.255

! åˆ›å»ºåŠ å¯†æ˜ å°„
crypto map VPN-MAP 10 ipsec-isakmp
 set peer 203.0.113.10
 set transform-set STRONG-TRANSFORM
 set pfs group14
 match address VPN-TRAFFIC

! åº”ç”¨åˆ°æŽ¥å£
interface GigabitEthernet0/0
 description WAN-Interface
 ip address 198.51.100.1 255.255.255.252
 crypto map VPN-MAP

! éªŒè¯
show crypto isakmp sa
show crypto ipsec sa
show crypto map
```

### 5.2 OpenVPNæœåŠ¡å™¨é…ç½®

```bash
#!/bin/bash
# ========================================
# OpenVPNæœåŠ¡å™¨é…ç½®
# ========================================

# å®‰è£…OpenVPN
apt update
apt install -y openvpn easy-rsa

# åˆå§‹åŒ–PKI
make-cadir ~/openvpn-ca
cd ~/openvpn-ca

# é…ç½®vars
cat > vars << 'EOF'
export KEY_COUNTRY="CN"
export KEY_PROVINCE="Beijing"
export KEY_CITY="Beijing"
export KEY_ORG="Example Corp"
export KEY_EMAIL="admin@example.com"
export KEY_OU="IT"
export KEY_NAME="server"
EOF

# ç”ŸæˆCAè¯ä¹¦
source vars
./clean-all
./build-ca

# ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦
./build-key-server server

# ç”ŸæˆDHå‚æ•°
./build-dh

# ç”ŸæˆTLSå¯†é’¥
openvpn --genkey --secret keys/ta.key

# é…ç½®OpenVPNæœåŠ¡å™¨
cat > /etc/openvpn/server.conf << 'EOF'
port 1194
proto udp
dev tun

ca /etc/openvpn/ca.crt
cert /etc/openvpn/server.crt
key /etc/openvpn/server.key
dh /etc/openvpn/dh2048.pem
tls-auth /etc/openvpn/ta.key 0

server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt

# æŽ¨é€è·¯ç”±
push "route 192.168.10.0 255.255.255.0"
push "route 10.100.0.0 255.255.0.0"

# DNS
push "dhcp-option DNS 192.168.10.1"

keepalive 10 120
cipher AES-256-CBC
auth SHA256
comp-lzo
persist-key
persist-tun
status openvpn-status.log
log-append /var/log/openvpn.log
verb 3
EOF

# å¯ç”¨IPè½¬å‘
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
sysctl -p

# é…ç½®é˜²ç«å¢™
iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE
iptables-save > /etc/iptables/rules.v4

# å¯åŠ¨OpenVPN
systemctl start openvpn@server
systemctl enable openvpn@server

echo "âœ… OpenVPNæœåŠ¡å™¨é…ç½®å®Œæˆ"
```

### 5.3 WireGuard VPN (çŽ°ä»£åŒ–)

```bash
#!/bin/bash
# ========================================
# WireGuard VPNé…ç½® (æ›´å¿«ã€æ›´å®‰å…¨)
# ========================================

# å®‰è£…WireGuard
apt update
apt install -y wireguard

# ç”Ÿæˆå¯†é’¥å¯¹
wg genkey | tee /etc/wireguard/server_private.key | wg pubkey > /etc/wireguard/server_public.key
chmod 600 /etc/wireguard/server_private.key

# é…ç½®WireGuardæœåŠ¡å™¨
cat > /etc/wireguard/wg0.conf << 'EOF'
[Interface]
Address = 10.9.0.1/24
ListenPort = 51820
PrivateKey = <SERVER_PRIVATE_KEY>
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

# å®¢æˆ·ç«¯1
[Peer]
PublicKey = <CLIENT1_PUBLIC_KEY>
AllowedIPs = 10.9.0.2/32

# å®¢æˆ·ç«¯2
[Peer]
PublicKey = <CLIENT2_PUBLIC_KEY>
AllowedIPs = 10.9.0.3/32
EOF

# å¯ç”¨IPè½¬å‘
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
sysctl -p

# å¯åŠ¨WireGuard
systemctl enable wg-quick@wg0
systemctl start wg-quick@wg0

# æŸ¥çœ‹çŠ¶æ€
wg show
```

---

## 6. å…¥ä¾µæ£€æµ‹ä¸Žé˜²æŠ¤

### 6.1 Snort IDSé…ç½®

```bash
#!/bin/bash
# ========================================
# Snortå…¥ä¾µæ£€æµ‹ç³»ç»Ÿé…ç½®
# ========================================

# å®‰è£…Snort
apt update
apt install -y snort

# é…ç½®Snort (/etc/snort/snort.conf)
cat >> /etc/snort/snort.conf << 'EOF'
# ç½‘ç»œé…ç½®
ipvar HOME_NET 192.168.10.0/24
ipvar EXTERNAL_NET any

# è§„åˆ™è·¯å¾„
var RULE_PATH /etc/snort/rules

# å¯ç”¨è§„åˆ™
include $RULE_PATH/local.rules
include $RULE_PATH/community.rules
EOF

# è‡ªå®šä¹‰è§„åˆ™
cat > /etc/snort/rules/local.rules << 'EOF'
# SSHæš´åŠ›ç ´è§£æ£€æµ‹
alert tcp any any -> $HOME_NET 22 (msg:"SSH Brute Force Attempt"; \
  flags:S; threshold:type both, track by_src, count 5, seconds 60; \
  sid:1000001; rev:1;)

# SQLæ³¨å…¥æ£€æµ‹
alert tcp any any -> $HOME_NET any (msg:"Possible SQL Injection"; \
  content:"select"; nocase; content:"from"; nocase; \
  sid:1000002; rev:1;)

# ç«¯å£æ‰«ææ£€æµ‹
alert tcp any any -> $HOME_NET any (msg:"Port Scan Detected"; \
  flags:S; threshold:type both, track by_src, count 20, seconds 60; \
  sid:1000003; rev:1;)
EOF

# å¯åŠ¨Snort
snort -c /etc/snort/snort.conf -i eth0 -D

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/snort/alert
```

### 6.2 Suricata IDS/IPS

```bash
#!/bin/bash
# ========================================
# Suricata IDS/IPSé…ç½®
# ========================================

# å®‰è£…Suricata
add-apt-repository ppa:oisf/suricata-stable
apt update
apt install -y suricata

# æ›´æ–°è§„åˆ™
suricata-update

# é…ç½®æŽ¥å£ (/etc/suricata/suricata.yaml)
cat > /etc/suricata/suricata.yaml << 'EOF'
vars:
  address-groups:
    HOME_NET: "[192.168.10.0/24,10.100.0.0/16]"
    EXTERNAL_NET: "!$HOME_NET"

af-packet:
  - interface: eth0
    cluster-id: 99
    cluster-type: cluster_flow
    defrag: yes

default-rule-path: /var/lib/suricata/rules
rule-files:
  - suricata.rules

outputs:
  - fast:
      enabled: yes
      filename: fast.log
  - eve-log:
      enabled: yes
      filetype: regular
      filename: eve.json
      types:
        - alert
        - http
        - dns
        - tls
EOF

# å¯åŠ¨Suricata
systemctl enable suricata
systemctl start suricata

# æŸ¥çœ‹ç»Ÿè®¡
suricatasc -c "dump-counters"
tail -f /var/log/suricata/fast.log
```

---

## 7. DDoSé˜²æŠ¤

```yaml
DDoS_Protection:
  æ”»å‡»ç±»åž‹:
    SYN_Flood:
      åŽŸç†: å¤§é‡SYNåŒ…è€—å°½è¿žæŽ¥è¡¨
      é˜²æŠ¤: SYN Cookie, è¿žæŽ¥é€ŸçŽ‡é™åˆ¶
    
    UDP_Flood:
      åŽŸç†: å¤§é‡UDPåŒ…è€—å°½å¸¦å®½
      é˜²æŠ¤: é€ŸçŽ‡é™åˆ¶, æ— æ•ˆç«¯å£è¿‡æ»¤
    
    HTTP_Flood:
      åŽŸç†: å¤§é‡HTTPè¯·æ±‚
      é˜²æŠ¤: WAF, éªŒè¯ç , é€ŸçŽ‡é™åˆ¶
    
    Amplification:
      åŽŸç†: åˆ©ç”¨æ”¾å¤§æ”»å‡» (DNS/NTP)
      é˜²æŠ¤: ç¦æ­¢åå°„, BCP38

é˜²æŠ¤æŽªæ–½:
  ç½‘ç»œå±‚:
    - ä¸Šæ¸¸ISP DDoSæ¸…æ´—æœåŠ¡
    - BGP Flowspec
    - Blackholeè·¯ç”±
  
  è¾¹ç•Œè®¾å¤‡:
    - ç¡¬ä»¶é˜²ç«å¢™
    - æµé‡æ¸…æ´—è®¾å¤‡
    - CDNæœåŠ¡
  
  ç³»ç»Ÿå±‚:
    - TCPå‚æ•°è°ƒä¼˜
    - è¿žæŽ¥æ•°é™åˆ¶
    - SYN Cookie
  
  åº”ç”¨å±‚:
    - WAFé˜²æŠ¤
    - é€ŸçŽ‡é™åˆ¶
    - éªŒè¯ç 
```

### Linuxç³»ç»ŸDDoSé˜²æŠ¤

```bash
#!/bin/bash
# ========================================
# Linuxç³»ç»ŸDDoSé˜²æŠ¤é…ç½®
# ========================================

# TCPå‚æ•°ä¼˜åŒ–
cat >> /etc/sysctl.conf << 'EOF'
# TCP SYN Cookie
net.ipv4.tcp_syncookies = 1

# SYNé˜Ÿåˆ—é•¿åº¦
net.ipv4.tcp_max_syn_backlog = 8192
net.core.netdev_max_backlog = 16384

# è¿žæŽ¥è¿½è¸ªä¼˜åŒ–
net.netfilter.nf_conntrack_max = 1048576

# è¶…æ—¶è®¾ç½®
net.ipv4.tcp_fin_timeout = 15
net.ipv4.tcp_keepalive_time = 300

# IPæºåœ°å€éªŒè¯ (é˜²æ­¢IPæ¬ºéª—)
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# å¿½ç•¥ICMPé‡å®šå‘
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0

# ç¦æ­¢è½¬å‘æºè·¯ç”±åŒ…
net.ipv4.conf.all.accept_source_route = 0
EOF

sysctl -p

# iptables DDoSé˜²æŠ¤
iptables -N DDOS-PROTECT

# é™åˆ¶æ–°è¿žæŽ¥é€ŸçŽ‡
iptables -A DDOS-PROTECT -p tcp --dport 80 -m state --state NEW -m limit --limit 50/s --limit-burst 100 -j ACCEPT
iptables -A DDOS-PROTECT -p tcp --dport 80 -m state --state NEW -j DROP

# é™åˆ¶ICMP
iptables -A DDOS-PROTECT -p icmp --icmp-type echo-request -m limit --limit 1/s -j ACCEPT
iptables -A DDOS-PROTECT -p icmp --icmp-type echo-request -j DROP

# é˜²æ­¢ç«¯å£æ‰«æ
iptables -A DDOS-PROTECT -p tcp --tcp-flags ALL NONE -j DROP
iptables -A DDOS-PROTECT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP
iptables -A DDOS-PROTECT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP

# åº”ç”¨è§„åˆ™é“¾
iptables -A INPUT -j DDOS-PROTECT

echo "âœ… DDoSé˜²æŠ¤é…ç½®å®Œæˆ"
```

---

## 8. å®‰å…¨å®¡è®¡ä¸Žæ—¥å¿—

### 8.1 é›†ä¸­æ—¥å¿—æ”¶é›† (ELK Stack)

```yaml
# ========================================
# Filebeaté…ç½® (æ”¶é›†æ—¥å¿—)
# ========================================
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/syslog
    - /var/log/auth.log
    - /var/log/firewall.log
  fields:
    log_type: system

- type: log
  enabled: true
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/error.log
  fields:
    log_type: nginx

output.logstash:
  hosts: ["logstash.example.com:5044"]
  ssl.certificate_authorities: ["/etc/filebeat/ca.crt"]
```

### 8.2 å®¡è®¡æ—¥å¿—é…ç½®

```bash
#!/bin/bash
# ========================================
# Linuxå®¡è®¡ç³»ç»Ÿ (auditd)
# ========================================

# å®‰è£…auditd
apt install -y auditd audispd-plugins

# é…ç½®å®¡è®¡è§„åˆ™
cat > /etc/audit/rules.d/custom.rules << 'EOF'
# åˆ é™¤æ‰€æœ‰è§„åˆ™
-D

# ç¼“å†²åŒºå¤§å°
-b 8192

# å¤±è´¥æ¨¡å¼ (1=æ‰“å°, 2=å†…æ ¸panic)
-f 1

# ç›‘æŽ§æ–‡ä»¶ä¿®æ”¹
-w /etc/passwd -p wa -k passwd_changes
-w /etc/shadow -p wa -k shadow_changes
-w /etc/group -p wa -k group_changes
-w /etc/sudoers -p wa -k sudoers_changes

# ç›‘æŽ§ç½‘ç»œé…ç½®
-w /etc/network/ -p wa -k network_changes
-w /etc/sysconfig/network-scripts/ -p wa -k network_changes

# ç›‘æŽ§é˜²ç«å¢™è§„åˆ™
-w /etc/iptables/ -p wa -k firewall_changes
-w /etc/ufw/ -p wa -k firewall_changes

# ç›‘æŽ§SSHé…ç½®
-w /etc/ssh/sshd_config -p wa -k sshd_config_changes

# ç›‘æŽ§ç‰¹æƒå‘½ä»¤
-a always,exit -F arch=b64 -S execve -F euid=0 -k root_commands

# ç›‘æŽ§ç”¨æˆ·ç™»å½•
-w /var/log/lastlog -p wa -k login_events
-w /var/run/faillock/ -p wa -k login_events

# ç›‘æŽ§æ—¶é—´å˜æ›´
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time_change
-a always,exit -F arch=b64 -S clock_settime -k time_change

# ç›‘æŽ§å†…æ ¸æ¨¡å—
-w /sbin/insmod -p x -k kernel_modules
-w /sbin/rmmod -p x -k kernel_modules
-w /sbin/modprobe -p x -k kernel_modules

# ä½¿è§„åˆ™ç”Ÿæ•ˆ
-e 2
EOF

# é‡å¯auditd
service auditd restart

# æŸ¥çœ‹å®¡è®¡æ—¥å¿—
ausearch -k passwd_changes
aureport --summary
```

---

## 9. å®‰å…¨åŠ å›ºæ¸…å•

```yaml
ç½‘ç»œè®¾å¤‡å®‰å…¨åŠ å›ºæ¸…å•:
  åŸºç¡€å®‰å…¨:
    âœ… ä¿®æ”¹é»˜è®¤å¯†ç 
    âœ… ç¦ç”¨ä¸å¿…è¦æœåŠ¡
    âœ… å¯ç”¨SSH, ç¦ç”¨Telnet
    âœ… é…ç½®å¼ºå¯†ç ç­–ç•¥
    âœ… å¯ç”¨AAAè®¤è¯
    âœ… é…ç½®Bannerè­¦å‘Š
    âœ… é™åˆ¶ç®¡ç†è®¿é—®æ¥æº
    âœ… å¯ç”¨NTPæ—¶é—´åŒæ­¥
  
  è®¿é—®æŽ§åˆ¶:
    âœ… é…ç½®RBACè§’è‰²æƒé™
    âœ… ä½¿ç”¨å¯†é’¥è®¤è¯SSH
    âœ… å¯ç”¨å¤šå› ç´ è®¤è¯
    âœ… å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
    âœ… ç¦ç”¨æœªä½¿ç”¨ç«¯å£
    âœ… é…ç½®ç«¯å£å®‰å…¨
    âœ… å¯ç”¨DHCP Snooping
    âœ… å¯ç”¨ARP Inspection
  
  æ—¥å¿—å®¡è®¡:
    âœ… å¯ç”¨æ—¥å¿—è®°å½•
    âœ… é…ç½®è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨
    âœ… å¯ç”¨SNMPç›‘æŽ§
    âœ… é…ç½®Syslogå‘Šè­¦
    âœ… å®šæœŸå®¡æŸ¥æ—¥å¿—
    âœ… ä¿ç•™180å¤©æ—¥å¿—
  
  ç½‘ç»œé˜²æŠ¤:
    âœ… é…ç½®ACLç­–ç•¥
    âœ… å¯ç”¨STPä¿æŠ¤
    âœ… é…ç½®BPDU Guard
    âœ… é…ç½®Root Guard
    âœ… å¯ç”¨ç«¯å£å®‰å…¨
    âœ… é…ç½®é£Žæš´æŽ§åˆ¶
    âœ… å¯ç”¨ç§æœ‰VLAN
  
  åŠ å¯†é€šä¿¡:
    âœ… ä½¿ç”¨SSHv2
    âœ… ç¦ç”¨SSLv2/v3, TLSv1.0/1.1
    âœ… é…ç½®å¼ºåŠ å¯†å¥—ä»¶
    âœ… å¯ç”¨SNMPv3
    âœ… ä½¿ç”¨åŠ å¯†ç®¡ç†åè®®
  
  å®šæœŸç»´æŠ¤:
    âœ… æ›´æ–°å›ºä»¶/è½¯ä»¶
    âœ… åº”ç”¨å®‰å…¨è¡¥ä¸
    âœ… å¤‡ä»½é…ç½®æ–‡ä»¶
    âœ… å®¡æŸ¥å®‰å…¨ç­–ç•¥
    âœ… æ¼æ´žæ‰«æ
    âœ… å®‰å…¨è¯„ä¼°

æœåŠ¡å™¨å®‰å…¨åŠ å›ºæ¸…å•:
  ç³»ç»ŸåŠ å›º:
    âœ… æœ€å°åŒ–å®‰è£…
    âœ… ç¦ç”¨ä¸å¿…è¦æœåŠ¡
    âœ… é…ç½®SELinux/AppArmor
    âœ… å†…æ ¸å‚æ•°ä¼˜åŒ–
    âœ… é™åˆ¶èµ„æºä½¿ç”¨
  
  è´¦æˆ·å®‰å…¨:
    âœ… ç¦ç”¨rootè¿œç¨‹ç™»å½•
    âœ… ä½¿ç”¨sudo
    âœ… å¼ºå¯†ç ç­–ç•¥
    âœ… SSHå¯†é’¥è®¤è¯
    âœ… å®šæœŸå¯†ç å˜æ›´
  
  é˜²ç«å¢™:
    âœ… å¯ç”¨é˜²ç«å¢™
    âœ… é»˜è®¤æ‹’ç»ç­–ç•¥
    âœ… æœ€å°æƒé™å¼€æ”¾
    âœ… é€ŸçŽ‡é™åˆ¶
  
  è¡¥ä¸ç®¡ç†:
    âœ… è‡ªåŠ¨æ›´æ–°å®‰å…¨è¡¥ä¸
    âœ… å®šæœŸå…¨é¢æ›´æ–°
    âœ… æµ‹è¯•åŽå†ä¸Šçº¿
  
  ç›‘æŽ§å®¡è®¡:
    âœ… å¯ç”¨auditd
    âœ… é›†ä¸­æ—¥å¿—ç®¡ç†
    âœ… å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ
    âœ… æ–‡ä»¶å®Œæ•´æ€§ç›‘æŽ§
  
  æ•°æ®ä¿æŠ¤:
    âœ… æ•æ„Ÿæ•°æ®åŠ å¯†
    âœ… å®šæœŸå¤‡ä»½
    âœ… å¤‡ä»½åŠ å¯†
    âœ… å¼‚åœ°å¤‡ä»½
```

---

## ç›¸å…³æ–‡æ¡£

- [ç½‘ç»œæ‹“æ‰‘ä¸ŽVLANè§„åˆ’](01_ç½‘ç»œæ‹“æ‰‘ä¸ŽVLANè§„åˆ’.md)
- [äº¤æ¢æœºé…ç½®ä¸Žä¼˜åŒ–](02_äº¤æ¢æœºé…ç½®ä¸Žä¼˜åŒ–.md)
- [è´Ÿè½½å‡è¡¡ä¸Žé«˜å¯ç”¨](03_è´Ÿè½½å‡è¡¡ä¸Žé«˜å¯ç”¨.md)
- [ç½‘ç»œç›‘æŽ§ä¸Žæ•…éšœæŽ’æŸ¥](05_ç½‘ç»œç›‘æŽ§ä¸Žæ•…éšœæŽ’æŸ¥.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
