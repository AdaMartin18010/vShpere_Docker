# ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥

> **è¿”å›**: [ç½‘ç»œæ¶æ„ç›®å½•](README.md) | [è™šæ‹ŸåŒ–éƒ¨ç½²é¦–é¡µ](../README.md) | [éƒ¨ç½²æŒ‡å—é¦–é¡µ](../../00_ç´¢å¼•å¯¼èˆª/README.md)

---

## ğŸ“‹ ç›®å½•

- [ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥](#ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. ç›‘æ§ä½“ç³»æ¶æ„](#1-ç›‘æ§ä½“ç³»æ¶æ„)
  - [2. SNMPç›‘æ§](#2-snmpç›‘æ§)
    - [2.1 SNMPé…ç½®](#21-snmpé…ç½®)
    - [2.2 å¸¸ç”¨SNMP OID](#22-å¸¸ç”¨snmp-oid)
    - [2.3 SNMPç›‘æ§è„šæœ¬](#23-snmpç›‘æ§è„šæœ¬)
  - [3. NetFlowæµé‡åˆ†æ](#3-netflowæµé‡åˆ†æ)
    - [3.1 Cisco NetFlowé…ç½®](#31-cisco-netflowé…ç½®)
    - [3.2 nfdumpåˆ†æå·¥å…·](#32-nfdumpåˆ†æå·¥å…·)
    - [3.3 æµé‡å¼‚å¸¸æ£€æµ‹](#33-æµé‡å¼‚å¸¸æ£€æµ‹)
  - [4. æ—¥å¿—åˆ†æ](#4-æ—¥å¿—åˆ†æ)
    - [4.1 Syslogé…ç½®](#41-syslogé…ç½®)
    - [4.2 æ—¥å¿—åˆ†æè„šæœ¬](#42-æ—¥å¿—åˆ†æè„šæœ¬)
  - [5. æ€§èƒ½ç›‘æ§](#5-æ€§èƒ½ç›‘æ§)
    - [5.1 Prometheus + Grafana](#51-prometheus--grafana)
    - [5.2 Prometheuså‘Šè­¦è§„åˆ™](#52-prometheuså‘Šè­¦è§„åˆ™)
  - [6. å‘Šè­¦é…ç½®](#6-å‘Šè­¦é…ç½®)
    - [6.1 Alertmanageré…ç½®](#61-alertmanageré…ç½®)
    - [6.2 é’‰é’‰å‘Šè­¦è„šæœ¬](#62-é’‰é’‰å‘Šè­¦è„šæœ¬)
  - [7. æ•…éšœæ’æŸ¥æ–¹æ³•è®º](#7-æ•…éšœæ’æŸ¥æ–¹æ³•è®º)
  - [8. å¸¸è§æ•…éšœæ¡ˆä¾‹](#8-å¸¸è§æ•…éšœæ¡ˆä¾‹)
    - [æ¡ˆä¾‹1: ç½‘ç»œé—´æ­‡æ€§ä¸­æ–­](#æ¡ˆä¾‹1-ç½‘ç»œé—´æ­‡æ€§ä¸­æ–­)
    - [æ¡ˆä¾‹2: VLANé—´æ— æ³•é€šä¿¡](#æ¡ˆä¾‹2-vlané—´æ— æ³•é€šä¿¡)
    - [æ¡ˆä¾‹3: å¹¿æ’­é£æš´](#æ¡ˆä¾‹3-å¹¿æ’­é£æš´)
  - [9. è¯Šæ–­å‘½ä»¤å¤§å…¨](#9-è¯Šæ–­å‘½ä»¤å¤§å…¨)
    - [9.1 Ciscoè¯Šæ–­å‘½ä»¤](#91-ciscoè¯Šæ–­å‘½ä»¤)
    - [9.2 Linuxç½‘ç»œè¯Šæ–­å‘½ä»¤](#92-linuxç½‘ç»œè¯Šæ–­å‘½ä»¤)
  - [10. æ•…éšœæ’æŸ¥å·¥å…·](#10-æ•…éšœæ’æŸ¥å·¥å…·)
    - [10.1 æŠ“åŒ…åˆ†æ (tcpdump/Wireshark)](#101-æŠ“åŒ…åˆ†æ-tcpdumpwireshark)
    - [10.2 ç½‘ç»œæ€§èƒ½æµ‹è¯•](#102-ç½‘ç»œæ€§èƒ½æµ‹è¯•)
    - [10.3 è‡ªåŠ¨åŒ–å·¡æ£€è„šæœ¬](#103-è‡ªåŠ¨åŒ–å·¡æ£€è„šæœ¬)
  - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. ç›‘æ§ä½“ç³»æ¶æ„

```yaml
ç½‘ç»œç›‘æ§å±‚æ¬¡æ¨¡å‹:
  L1_ç‰©ç†å±‚ç›‘æ§:
    æŒ‡æ ‡:
      - ç«¯å£çŠ¶æ€ (Up/Down)
      - å…‰åŠŸç‡ (dBm)
      - é”™è¯¯ç‡ (CRC/Collision)
      - çº¿ç¼†è´¨é‡
    å·¥å…·: SNMP, è®¾å¤‡CLI
  
  L2_é“¾è·¯å±‚ç›‘æ§:
    æŒ‡æ ‡:
      - MACåœ°å€è¡¨
      - VLANçŠ¶æ€
      - ç”Ÿæˆæ ‘çŠ¶æ€
      - EtherChannelçŠ¶æ€
    å·¥å…·: SNMP, LLDP/CDP
  
  L3_ç½‘ç»œå±‚ç›‘æ§:
    æŒ‡æ ‡:
      - è·¯ç”±è¡¨
      - ARPè¡¨
      - ICMPå¯è¾¾æ€§
      - è·¯ç”±åè®®çŠ¶æ€
    å·¥å…·: Ping, Traceroute, BGP/OSPFç›‘æ§
  
  L4_ä¼ è¾“å±‚ç›‘æ§:
    æŒ‡æ ‡:
      - è¿æ¥æ•°
      - ç«¯å£åˆ©ç”¨ç‡
      - TCPé‡ä¼ ç‡
      - å»¶è¿Ÿ/æŠ–åŠ¨
    å·¥å…·: NetFlow, TCPåˆ†æ
  
  L7_åº”ç”¨å±‚ç›‘æ§:
    æŒ‡æ ‡:
      - HTTPå“åº”æ—¶é—´
      - DNSæŸ¥è¯¢å»¶è¿Ÿ
      - åº”ç”¨æ€§èƒ½
      - ç”¨æˆ·ä½“éªŒ
    å·¥å…·: APM, ç»¼åˆç›‘æ§

ç›‘æ§å·¥å…·æ ˆ:
  æ•°æ®é‡‡é›†:
    - SNMP (Simple Network Management Protocol)
    - NetFlow/sFlow/IPFIX
    - Syslog
    - API/CLI
  
  æ•°æ®å­˜å‚¨:
    - InfluxDB (æ—¶åºæ•°æ®)
    - Elasticsearch (æ—¥å¿—)
    - Prometheus (æŒ‡æ ‡)
  
  æ•°æ®å±•ç¤º:
    - Grafana (ä»ªè¡¨æ¿)
    - Kibana (æ—¥å¿—åˆ†æ)
    - Cacti/Zabbix (ä¼ ç»Ÿç›‘æ§)
  
  å‘Šè­¦é€šçŸ¥:
    - Alertmanager
    - PagerDuty
    - Email/SMS/é’‰é’‰/ä¼ä¸šå¾®ä¿¡
```

---

## 2. SNMPç›‘æ§

### 2.1 SNMPé…ç½®

```cisco
! ========================================
! Cisco SNMPé…ç½®
! ========================================

! SNMPv2cé…ç½® (ä¸æ¨èç”Ÿäº§ç¯å¢ƒ)
snmp-server community public RO
snmp-server community private RW
snmp-server location "DC1-Rack-A-U10"
snmp-server contact "admin@example.com"

! SNMPv3é…ç½® (æ¨è)
snmp-server group ADMIN-GROUP v3 priv
snmp-server user admin ADMIN-GROUP v3 auth sha AuthPass@2025 priv aes 128 PrivPass@2025

! é…ç½®Trapæ¥æ”¶è€…
snmp-server host 192.168.10.100 version 3 priv admin
snmp-server enable traps snmp linkdown linkup
snmp-server enable traps config
snmp-server enable traps cpu threshold
snmp-server enable traps memory bufferpeak
snmp-server enable traps vrrp
snmp-server enable traps hsrp

! éªŒè¯
show snmp
show snmp user
show snmp group
```

### 2.2 å¸¸ç”¨SNMP OID

```yaml
å¸¸ç”¨SNMP_OID:
  ç³»ç»Ÿä¿¡æ¯:
    sysName: .1.3.6.1.2.1.1.5.0
    sysUpTime: .1.3.6.1.2.1.1.3.0
    sysDescr: .1.3.6.1.2.1.1.1.0
    sysLocation: .1.3.6.1.2.1.1.6.0
  
  CPUå’Œå†…å­˜:
    CPU_5ç§’åˆ©ç”¨ç‡: .1.3.6.1.4.1.9.9.109.1.1.1.1.3
    CPU_1åˆ†é’Ÿåˆ©ç”¨ç‡: .1.3.6.1.4.1.9.9.109.1.1.1.1.4
    å†…å­˜ä½¿ç”¨: .1.3.6.1.4.1.9.9.48.1.1.1.5
    å†…å­˜ç©ºé—²: .1.3.6.1.4.1.9.9.48.1.1.1.6
  
  æ¥å£:
    ifDescr: .1.3.6.1.2.1.2.2.1.2
    ifOperStatus: .1.3.6.1.2.1.2.2.1.8
    ifInOctets: .1.3.6.1.2.1.2.2.1.10
    ifOutOctets: .1.3.6.1.2.1.2.2.1.16
    ifInErrors: .1.3.6.1.2.1.2.2.1.14
    ifOutErrors: .1.3.6.1.2.1.2.2.1.20
  
  ç¯å¢ƒ:
    æ¸©åº¦: .1.3.6.1.4.1.9.9.13.1.3.1.3
    é£æ‰‡çŠ¶æ€: .1.3.6.1.4.1.9.9.13.1.4.1.3
    ç”µæºçŠ¶æ€: .1.3.6.1.4.1.9.9.13.1.5.1.3
```

### 2.3 SNMPç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# ========================================
# SNMPæ‰¹é‡ç›‘æ§è„šæœ¬
# ========================================

DEVICES=(
    "192.168.10.10:Core-SW1"
    "192.168.10.11:Core-SW2"
    "192.168.10.20:Dist-SW1"
)

COMMUNITY="public"
OUTPUT_DIR="/var/log/snmp-monitoring"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$OUTPUT_DIR"

for DEVICE in "${DEVICES[@]}"; do
    IP="${DEVICE%%:*}"
    NAME="${DEVICE##*:}"
    
    echo "========================================" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    echo "ç›‘æ§è®¾å¤‡: $NAME ($IP)" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    echo "æ—¶é—´: $(date)" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    
    # è®¾å¤‡ä¿¡æ¯
    echo -e "\n--- è®¾å¤‡ä¿¡æ¯ ---" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    snmpget -v2c -c $COMMUNITY $IP .1.3.6.1.2.1.1.1.0 | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    snmpget -v2c -c $COMMUNITY $IP .1.3.6.1.2.1.1.3.0 | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    
    # CPUåˆ©ç”¨ç‡
    echo -e "\n--- CPUåˆ©ç”¨ç‡ ---" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    CPU_5SEC=$(snmpget -v2c -c $COMMUNITY -Ovq $IP .1.3.6.1.4.1.9.9.109.1.1.1.1.3.1)
    echo "CPU 5ç§’: $CPU_5SEC%" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    
    # å†…å­˜ä½¿ç”¨
    echo -e "\n--- å†…å­˜ä½¿ç”¨ ---" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    MEM_USED=$(snmpget -v2c -c $COMMUNITY -Ovq $IP .1.3.6.1.4.1.9.9.48.1.1.1.5.1)
    MEM_FREE=$(snmpget -v2c -c $COMMUNITY -Ovq $IP .1.3.6.1.4.1.9.9.48.1.1.1.6.1)
    MEM_TOTAL=$((MEM_USED + MEM_FREE))
    MEM_PERCENT=$((MEM_USED * 100 / MEM_TOTAL))
    echo "å†…å­˜ä½¿ç”¨: $MEM_USED / $MEM_TOTAL ($MEM_PERCENT%)" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    
    # æ¥å£çŠ¶æ€
    echo -e "\n--- æ¥å£çŠ¶æ€ ---" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    snmpwalk -v2c -c $COMMUNITY $IP .1.3.6.1.2.1.2.2.1.2 | head -10 | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    
    # å‘Šè­¦åˆ¤æ–­
    if [ "$CPU_5SEC" -gt 80 ]; then
        echo "âš ï¸  è­¦å‘Š: CPUä½¿ç”¨ç‡è¿‡é«˜ ($CPU_5SEC%)" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
        # å‘é€å‘Šè­¦ (é‚®ä»¶/é’‰é’‰/çŸ­ä¿¡)
    fi
    
    if [ "$MEM_PERCENT" -gt 90 ]; then
        echo "âš ï¸  è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($MEM_PERCENT%)" | tee -a "$OUTPUT_DIR/$NAME-$DATE.log"
    fi
done

echo "âœ… ç›‘æ§å®Œæˆï¼Œæ—¥å¿—ä¿å­˜åœ¨: $OUTPUT_DIR"
```

---

## 3. NetFlowæµé‡åˆ†æ

### 3.1 Cisco NetFlowé…ç½®

```cisco
! ========================================
! Cisco NetFlow v9é…ç½®
! ========================================

! é…ç½®Flow Exporter
flow exporter NETFLOW-EXPORT
 destination 192.168.10.100
 source Vlan10
 transport udp 9995
 export-protocol netflow-v9
 template data timeout 60

! é…ç½®Flow Record
flow record NETFLOW-RECORD
 match ipv4 tos
 match ipv4 protocol
 match ipv4 source address
 match ipv4 destination address
 match transport source-port
 match transport destination-port
 collect counter bytes
 collect counter packets
 collect timestamp sys-uptime first
 collect timestamp sys-uptime last

! é…ç½®Flow Monitor
flow monitor NETFLOW-MONITOR
 exporter NETFLOW-EXPORT
 cache timeout inactive 10
 cache timeout active 60
 record NETFLOW-RECORD

! åº”ç”¨åˆ°æ¥å£
interface GigabitEthernet1/0/1
 ip flow monitor NETFLOW-MONITOR input
 ip flow monitor NETFLOW-MONITOR output

! éªŒè¯
show flow monitor NETFLOW-MONITOR cache
show flow exporter NETFLOW-EXPORT statistics
```

### 3.2 nfdumpåˆ†æå·¥å…·

```bash
#!/bin/bash
# ========================================
# nfdump NetFlowåˆ†æ
# ========================================

# å®‰è£…nfdump
apt install -y nfdump

# é…ç½®nfcapdæ”¶é›†å™¨
nfcapd -w /var/cache/nfdump -p 9995 -D

# å®æ—¶æµé‡åˆ†æ
# Top 10 æµé‡æºIP
nfdump -R /var/cache/nfdump -s srcip/bytes -n 10

# Top 10 æµé‡ç›®æ ‡IP
nfdump -R /var/cache/nfdump -s dstip/bytes -n 10

# Top 10 ä½¿ç”¨ç«¯å£
nfdump -R /var/cache/nfdump -s dstport/bytes -n 10

# æŸ¥çœ‹ç‰¹å®šIPçš„æµé‡
nfdump -R /var/cache/nfdump 'src ip 192.168.10.100'

# æŸ¥çœ‹HTTPæµé‡
nfdump -R /var/cache/nfdump 'dst port 80 or dst port 443'

# æŒ‰æ—¶é—´è¿‡æ»¤
nfdump -R /var/cache/nfdump -t 2025/10/19.10:00:00-2025/10/19.12:00:00

# ç”Ÿæˆæµé‡æŠ¥å‘Š
nfdump -R /var/cache/nfdump -s srcip/bytes -n 20 -o csv > traffic_report.csv
```

### 3.3 æµé‡å¼‚å¸¸æ£€æµ‹

```python
#!/usr/bin/env python3
# ========================================
# NetFlowå¼‚å¸¸æµé‡æ£€æµ‹
# ========================================

import subprocess
import re
from collections import defaultdict

def get_top_talkers(n=10):
    """è·å–Topæµé‡ä¸»æœº"""
    cmd = f"nfdump -R /var/cache/nfdump -s srcip/bytes -n {n} -q"
    output = subprocess.check_output(cmd, shell=True).decode()
    
    talkers = []
    for line in output.split('\n'):
        match = re.search(r'(\d+\.\d+\.\d+\.\d+)\s+(\d+\.\d+\s+\w+)', line)
        if match:
            talkers.append((match.group(1), match.group(2)))
    
    return talkers

def detect_port_scan(threshold=100):
    """æ£€æµ‹ç«¯å£æ‰«æ"""
    cmd = "nfdump -R /var/cache/nfdump -a -o extended"
    output = subprocess.check_output(cmd, shell=True).decode()
    
    src_ports = defaultdict(set)
    for line in output.split('\n'):
        match = re.search(r'(\d+\.\d+\.\d+\.\d+):\d+ -> \d+\.\d+\.\d+\.\d+:(\d+)', line)
        if match:
            src_ip = match.group(1)
            dst_port = match.group(2)
            src_ports[src_ip].add(dst_port)
    
    # æ£€æµ‹è®¿é—®è¿‡å¤šç«¯å£çš„IP
    scanners = []
    for ip, ports in src_ports.items():
        if len(ports) > threshold:
            scanners.append((ip, len(ports)))
    
    return sorted(scanners, key=lambda x: x[1], reverse=True)

def detect_ddos(threshold_gbps=1.0):
    """æ£€æµ‹DDoSæ”»å‡»"""
    cmd = "nfdump -R /var/cache/nfdump -s srcip/bps -n 10 -q"
    output = subprocess.check_output(cmd, shell=True).decode()
    
    attacks = []
    for line in output.split('\n'):
        match = re.search(r'(\d+\.\d+\.\d+\.\d+)\s+(\d+\.\d+)\s+G', line)
        if match and float(match.group(2)) > threshold_gbps:
            attacks.append((match.group(1), float(match.group(2))))
    
    return attacks

if __name__ == "__main__":
    print("=== Top 10 æµé‡ä¸»æœº ===")
    for ip, traffic in get_top_talkers():
        print(f"{ip}: {traffic}")
    
    print("\n=== å¯ç–‘ç«¯å£æ‰«æ ===")
    for ip, port_count in detect_port_scan():
        print(f"âš ï¸  {ip} è®¿é—®äº† {port_count} ä¸ªä¸åŒç«¯å£")
    
    print("\n=== å¯ç–‘DDoSæ”»å‡» ===")
    for ip, gbps in detect_ddos():
        print(f"ğŸ”´ {ip} æµé‡: {gbps} Gbps")
```

---

## 4. æ—¥å¿—åˆ†æ

### 4.1 Syslogé…ç½®

```bash
#!/bin/bash
# ========================================
# rsyslogé…ç½®
# ========================================

# é…ç½®rsyslogæœåŠ¡å™¨
cat >> /etc/rsyslog.conf << 'EOF'
# å¯ç”¨UDPæ¥æ”¶ (é»˜è®¤514ç«¯å£)
$ModLoad imudp
$UDPServerRun 514

# å¯ç”¨TCPæ¥æ”¶
$ModLoad imtcp
$InputTCPServerRun 514

# æŒ‰ä¸»æœºåˆ†ç±»æ—¥å¿—
$template RemoteLogs,"/var/log/remote/%HOSTNAME%/%$YEAR%%$MONTH%%$DAY%.log"
*.* ?RemoteLogs
EOF

# é‡å¯rsyslog
systemctl restart rsyslog

# é…ç½®æ—¥å¿—è½®è½¬
cat > /etc/logrotate.d/remote-logs << 'EOF'
/var/log/remote/*/*.log {
    daily
    rotate 90
    compress
    delaycompress
    missingok
    notifempty
    create 0640 syslog adm
}
EOF
```

### 4.2 æ—¥å¿—åˆ†æè„šæœ¬

```bash
#!/bin/bash
# ========================================
# ç½‘ç»œè®¾å¤‡æ—¥å¿—åˆ†æè„šæœ¬
# ========================================

LOG_DIR="/var/log/remote"
REPORT_FILE="/var/log/network-analysis-$(date +%Y%m%d).txt"

echo "=== ç½‘ç»œæ—¥å¿—åˆ†ææŠ¥å‘Š ===" > $REPORT_FILE
echo "ç”Ÿæˆæ—¶é—´: $(date)" >> $REPORT_FILE
echo "" >> $REPORT_FILE

# 1. é“¾è·¯Downäº‹ä»¶
echo "=== é“¾è·¯Downäº‹ä»¶ ===" >> $REPORT_FILE
grep -r "LINK-3-UPDOWN.*down" $LOG_DIR | tail -20 >> $REPORT_FILE

# 2. é…ç½®å˜æ›´
echo -e "\n=== é…ç½®å˜æ›´ ===" >> $REPORT_FILE
grep -r "CONFIG_I" $LOG_DIR | tail -20 >> $REPORT_FILE

# 3. è®¤è¯å¤±è´¥
echo -e "\n=== è®¤è¯å¤±è´¥ ===" >> $REPORT_FILE
grep -r "Authentication failed\|LOGIN-4-LOGIN_FAILED" $LOG_DIR | tail -20 >> $REPORT_FILE

# 4. VRRP/HSRPçŠ¶æ€å˜åŒ–
echo -e "\n=== VRRP/HSRPçŠ¶æ€å˜åŒ– ===" >> $REPORT_FILE
grep -r "VRRP\|HSRP.*state" $LOG_DIR | tail -20 >> $REPORT_FILE

# 5. CPU/å†…å­˜å‘Šè­¦
echo -e "\n=== CPU/å†…å­˜å‘Šè­¦ ===" >> $REPORT_FILE
grep -r "CPU\|MEMORY.*threshold" $LOG_DIR | tail -20 >> $REPORT_FILE

# 6. ç»Ÿè®¡åˆ†æ
echo -e "\n=== é”™è¯¯ç»Ÿè®¡ ===" >> $REPORT_FILE
echo "é”™è¯¯æ€»æ•°:" >> $REPORT_FILE
grep -rc "ERROR\|CRIT" $LOG_DIR | sort -t: -k2 -nr | head -10 >> $REPORT_FILE

cat $REPORT_FILE
```

---

## 5. æ€§èƒ½ç›‘æ§

### 5.1 Prometheus + Grafana

```yaml
# ========================================
# Prometheusé…ç½®
# ========================================
global:
  scrape_interval: 30s
  evaluation_interval: 30s

scrape_configs:
  # SNMP Exporterç›‘æ§äº¤æ¢æœº
  - job_name: 'snmp-switches'
    static_configs:
      - targets:
        - 192.168.10.10  # Core-SW1
        - 192.168.10.11  # Core-SW2
        labels:
          device_type: 'switch'
          location: 'DC1'
    metrics_path: /snmp
    params:
      module: [cisco_ios]
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: localhost:9116  # SNMP Exporteråœ°å€
  
  # Node Exporterç›‘æ§æœåŠ¡å™¨
  - job_name: 'node'
    static_configs:
      - targets:
        - 192.168.10.100:9100
        - 192.168.10.101:9100
        labels:
          env: 'production'
```

### 5.2 Prometheuså‘Šè­¦è§„åˆ™

```yaml
# ========================================
# Prometheuså‘Šè­¦è§„åˆ™
# ========================================
groups:
  - name: network_alerts
    interval: 30s
    rules:
      # æ¥å£Downå‘Šè­¦
      - alert: InterfaceDown
        expr: ifOperStatus == 2
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "æ¥å£Down: {{ $labels.ifDescr }}"
          description: "è®¾å¤‡ {{ $labels.instance }} æ¥å£ {{ $labels.ifDescr }} å·²Downè¶…è¿‡1åˆ†é’Ÿ"
      
      # é«˜å¸¦å®½ä½¿ç”¨
      - alert: HighBandwidthUtilization
        expr: (rate(ifHCInOctets[5m]) * 8 / ifHighSpeed) > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å¸¦å®½ä½¿ç”¨ç‡è¿‡é«˜"
          description: "{{ $labels.ifDescr }} å¸¦å®½ä½¿ç”¨ç‡è¶…è¿‡80%"
      
      # é«˜é”™è¯¯ç‡
      - alert: HighErrorRate
        expr: rate(ifInErrors[5m]) > 100
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "æ¥å£é”™è¯¯ç‡è¿‡é«˜"
          description: "{{ $labels.ifDescr }} æ¯ç§’é”™è¯¯è¶…è¿‡100ä¸ª"
      
      # CPUè¿‡é«˜
      - alert: HighCPU
        expr: cpmCPUTotal5minRev > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "{{ $labels.instance }} CPUä½¿ç”¨ç‡ {{ $value }}%"
      
      # å†…å­˜ä¸è¶³
      - alert: LowMemory
        expr: (cempMemPoolHCUsed / (cempMemPoolHCUsed + cempMemPoolHCFree)) * 100 > 90
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "å†…å­˜ä¸è¶³"
          description: "{{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡ {{ $value }}%"
```

---

## 6. å‘Šè­¦é…ç½®

### 6.1 Alertmanageré…ç½®

```yaml
# ========================================
# Alertmanageré…ç½®
# ========================================
global:
  resolve_timeout: 5m
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'password'

route:
  group_by: ['alertname', 'cluster']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'
  routes:
    - match:
        severity: critical
      receiver: 'critical-team'
      continue: true
    
    - match:
        severity: warning
      receiver: 'ops-team'

receivers:
  - name: 'default'
    email_configs:
      - to: 'ops@example.com'
  
  - name: 'critical-team'
    email_configs:
      - to: 'oncall@example.com'
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=xxx'
  
  - name: 'ops-team'
    email_configs:
      - to: 'ops@example.com'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
```

### 6.2 é’‰é’‰å‘Šè­¦è„šæœ¬

```bash
#!/bin/bash
# ========================================
# é’‰é’‰Webhookå‘Šè­¦è„šæœ¬
# ========================================

DINGTALK_WEBHOOK="https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN"

ALERT_NAME=$1
ALERT_SEVERITY=$2
ALERT_MESSAGE=$3

JSON_DATA=$(cat <<EOF
{
    "msgtype": "markdown",
    "markdown": {
        "title": "ç½‘ç»œå‘Šè­¦",
        "text": "## ğŸ”” ç½‘ç»œå‘Šè­¦é€šçŸ¥\n\n**å‘Šè­¦åç§°**: ${ALERT_NAME}\n\n**ä¸¥é‡ç¨‹åº¦**: ${ALERT_SEVERITY}\n\n**å‘Šè­¦ä¿¡æ¯**: ${ALERT_MESSAGE}\n\n**æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')"
    },
    "at": {
        "isAtAll": false
    }
}
EOF
)

curl -H "Content-Type: application/json" \
     -d "$JSON_DATA" \
     "$DINGTALK_WEBHOOK"
```

---

## 7. æ•…éšœæ’æŸ¥æ–¹æ³•è®º

```yaml
æ•…éšœæ’æŸ¥æµç¨‹:
  ç¬¬ä¸€æ­¥_ç¡®å®šèŒƒå›´:
    é—®é¢˜ç°è±¡: ç”¨æˆ·æŠ¥å‘Šçš„å…·ä½“é—®é¢˜
    å½±å“èŒƒå›´: å•ç”¨æˆ·/éƒ¨é—¨/å…¨ç½‘
    å‘ç”Ÿæ—¶é—´: ä½•æ—¶å¼€å§‹å‡ºç°
    ç¯å¢ƒå˜åŒ–: è¿‘æœŸæ˜¯å¦æœ‰å˜æ›´
  
  ç¬¬äºŒæ­¥_æ”¶é›†ä¿¡æ¯:
    ç”¨æˆ·ç»ˆç«¯:
      - IPé…ç½® (ipconfig/ifconfig)
      - ç½‘å…³å¯è¾¾æ€§ (ping)
      - DNSè§£æ (nslookup)
    
    ç½‘ç»œè®¾å¤‡:
      - æ¥å£çŠ¶æ€
      - é…ç½®å˜æ›´æ—¥å¿—
      - é”™è¯¯æ—¥å¿—
      - CPU/å†…å­˜ä½¿ç”¨
    
    ç›‘æ§æ•°æ®:
      - æµé‡å›¾è¡¨
      - å‘Šè­¦å†å²
      - æ€§èƒ½æŒ‡æ ‡
  
  ç¬¬ä¸‰æ­¥_åˆ†å±‚æ’æŸ¥:
    L1_ç‰©ç†å±‚:
      âœ“ çº¿ç¼†è¿æ¥
      âœ“ ç«¯å£æŒ‡ç¤ºç¯
      âœ“ å…‰åŠŸç‡ (å…‰çº¤)
    
    L2_æ•°æ®é“¾è·¯å±‚:
      âœ“ ç«¯å£çŠ¶æ€ (show interface)
      âœ“ VLANé…ç½®
      âœ“ MACåœ°å€è¡¨
      âœ“ ç”Ÿæˆæ ‘çŠ¶æ€
    
    L3_ç½‘ç»œå±‚:
      âœ“ IPé…ç½®
      âœ“ è·¯ç”±è¡¨
      âœ“ ARPè¡¨
      âœ“ Pingæµ‹è¯•
    
    L4_ä¼ è¾“å±‚:
      âœ“ ç«¯å£ç›‘å¬
      âœ“ è¿æ¥çŠ¶æ€
      âœ“ é˜²ç«å¢™è§„åˆ™
    
    L7_åº”ç”¨å±‚:
      âœ“ æœåŠ¡è¿è¡ŒçŠ¶æ€
      âœ“ åº”ç”¨æ—¥å¿—
      âœ“ ä¸šåŠ¡é€»è¾‘
  
  ç¬¬å››æ­¥_éš”ç¦»é—®é¢˜:
    å¯¹æ¯”æ³•:
      - æ­£å¸¸vså¼‚å¸¸å¯¹æ¯”
      - å†å²vså½“å‰å¯¹æ¯”
    
    æ›¿æ¢æ³•:
      - æ›´æ¢çº¿ç¼†
      - æ›´æ¢æ¨¡å—
      - åˆ‡æ¢è·¯å¾„
    
    åˆ†æ®µæ³•:
      - é€æ®µæµ‹è¯•
      - ç¼©å°èŒƒå›´
  
  ç¬¬äº”æ­¥_è§£å†³é—®é¢˜:
    ä¸´æ—¶æªæ–½: å¿«é€Ÿæ¢å¤æœåŠ¡
    æ ¹æœ¬è§£å†³: å½»åº•ä¿®å¤é—®é¢˜
    æ–‡æ¡£è®°å½•: è®°å½•æ•…éšœå’Œè§£å†³æ–¹æ¡ˆ
  
  ç¬¬å…­æ­¥_éªŒè¯ä¸é¢„é˜²:
    éªŒè¯: ç¡®è®¤é—®é¢˜å·²è§£å†³
    ç›‘æ§: æŒç»­è§‚å¯Ÿ
    é¢„é˜²: é¿å…å†æ¬¡å‘ç”Ÿ

OSIä¸ƒå±‚æ’æŸ¥å£è¯€:
  "ç‰©æ•°ç½‘ä¼ ä¼šè¡¨åº”ï¼Œè‡ªä¸‹è€Œä¸ŠæŠŠå±‚æ¸…"
  - å…ˆæ£€æŸ¥ç‰©ç†è¿æ¥
  - å†æŸ¥é“¾è·¯å±‚é…ç½®
  - ç„¶åçœ‹ç½‘ç»œå±‚è·¯ç”±
  - æœ€åæ’æŸ¥åº”ç”¨é—®é¢˜
```

---

## 8. å¸¸è§æ•…éšœæ¡ˆä¾‹

### æ¡ˆä¾‹1: ç½‘ç»œé—´æ­‡æ€§ä¸­æ–­

```yaml
æ•…éšœç°è±¡:
  ç”¨æˆ·è®¿é—®å†…ç½‘èµ„æºé—´æ­‡æ€§ä¸­æ–­
  Pingä¸¢åŒ…ç‡10-30%
  å½±å“èŒƒå›´: æ•´ä¸ªåŠå…¬åŒº
  æŒç»­æ—¶é—´: 2å°æ—¶

æ’æŸ¥è¿‡ç¨‹:
  1. æ£€æŸ¥ç”¨æˆ·ç»ˆç«¯:
     - IPé…ç½®æ­£å¸¸
     - pingç½‘å…³æœ‰ä¸¢åŒ…
  
  2. æ£€æŸ¥æ¥å…¥äº¤æ¢æœº:
     - show interface: å¤§é‡CRCé”™è¯¯
     - show mac address-table: MACåœ°å€é¢‘ç¹å˜åŒ–
     - show interface counters errors: input errorsæŒç»­å¢é•¿
  
  3. æ£€æŸ¥ç‰©ç†è¿æ¥:
     - å‘ç°æŸæ¡çº¿ç¼†æ¾åŠ¨
     - æ’å¤´æ°§åŒ–

æ ¹æœ¬åŸå› :
  ç½‘çº¿æ¥è§¦ä¸è‰¯å¯¼è‡´CRCé”™è¯¯å’Œä¸¢åŒ…

è§£å†³æ–¹æ¡ˆ:
  1. ä¸´æ—¶: æ›´æ¢ç½‘çº¿
  2. æ°¸ä¹…: é‡æ–°æ•´ç†å¸ƒçº¿ï¼Œä½¿ç”¨è´¨é‡æ›´å¥½çš„ç½‘çº¿
  3. é¢„é˜²: å®šæœŸæ£€æŸ¥çº¿ç¼†ï¼Œç›‘æ§CRCé”™è¯¯

å…³é”®å‘½ä»¤:
  show interface GigabitEthernet1/0/1
  show interface counters errors
  show logging | include CRC
```

### æ¡ˆä¾‹2: VLANé—´æ— æ³•é€šä¿¡

```yaml
æ•…éšœç°è±¡:
  WebæœåŠ¡å™¨(VLAN40)æ— æ³•è®¿é—®æ•°æ®åº“(VLAN42)
  åº”ç”¨æŠ¥é”™: Connection refused

æ’æŸ¥è¿‡ç¨‹:
  1. æµ‹è¯•è¿é€šæ€§:
     WebæœåŠ¡å™¨: ping 10.100.42.10 (æ•°æ®åº“) - å¤±è´¥
     
  2. æ£€æŸ¥è·¯ç”±:
     show ip route - è·¯ç”±å­˜åœ¨
     show ip interface brief - æ¥å£Up
  
  3. æ£€æŸ¥ACL:
     show access-lists - å‘ç°DB-ACCESS ACL
     show ip access-lists DB-ACCESS
     å‘ç°: åªå…è®¸10.100.41.0/24è®¿é—®æ•°æ®åº“
     é—®é¢˜: WebæœåŠ¡å™¨åœ¨10.100.40.0/24ç½‘æ®µ
  
  4. æ£€æŸ¥é…ç½®å†å²:
     show archive log config all
     å‘ç°æ˜¨å¤©æœ‰ACLå˜æ›´

æ ¹æœ¬åŸå› :
  ACLé…ç½®é”™è¯¯ï¼ŒæœªåŒ…å«WebæœåŠ¡å™¨ç½‘æ®µ

è§£å†³æ–¹æ¡ˆ:
  ip access-list extended DB-ACCESS
   5 permit tcp 10.100.40.0 0.0.0.255 10.100.42.0 0.0.0.127 eq 3306
   10 permit tcp 10.100.41.0 0.0.0.255 10.100.42.0 0.0.0.127 eq 3306

æ•™è®­:
  - é…ç½®å˜æ›´å¿…é¡»æœ‰å˜æ›´ç”³è¯·
  - ACLå˜æ›´è¦å……åˆ†æµ‹è¯•
  - é…ç½®å‰åè¦å¤‡ä»½
```

### æ¡ˆä¾‹3: å¹¿æ’­é£æš´

```yaml
æ•…éšœç°è±¡:
  å…¨ç½‘ç½‘ç»œå¡é¡¿
  äº¤æ¢æœºCPU 100%
  æ¥å£æµé‡å¼‚å¸¸

æ’æŸ¥è¿‡ç¨‹:
  1. æ£€æŸ¥CPUä½¿ç”¨:
     show processes cpu sorted
     å‘ç°: "Ethernet Input"è¿›ç¨‹å ç”¨90%
  
  2. æ£€æŸ¥æ¥å£æµé‡:
     show interface counters rate
     å‘ç°: æ‰€æœ‰æ¥å£éƒ½æœ‰å¤§é‡å¹¿æ’­åŒ…
  
  3. æ£€æŸ¥ç”Ÿæˆæ ‘:
     show spanning-tree
     å‘ç°: å¤šä¸ªç«¯å£å¤„äºForwardingçŠ¶æ€
     åŸå› : æŸå°äº¤æ¢æœºç”Ÿæˆæ ‘è¢«ç¦ç”¨
  
  4. å®šä½æºå¤´:
     show mac address-tableåŠ¨æ€å˜åŒ–
     show cdp neighbors - å‘ç°æ–°æ¥å…¥è®¾å¤‡

æ ¹æœ¬åŸå› :
  ç”¨æˆ·ç§æ¥äº¤æ¢æœºï¼Œä¸”ç¦ç”¨äº†ç”Ÿæˆæ ‘ï¼Œå½¢æˆç¯è·¯

è§£å†³æ–¹æ¡ˆ:
  1. ç´§æ€¥: æ–­å¼€ç¯è·¯ç«¯å£
     interface GigabitEthernet1/0/24
      shutdown
  
  2. é•¿æœŸ: å¯ç”¨BPDU Guard
     spanning-tree portfast bpduguard default
     
     åœ¨æ‰€æœ‰æ¥å…¥ç«¯å£:
     interface range GigabitEthernet1/0/1-24
      spanning-tree portfast
      spanning-tree bpduguard enable

é¢„é˜²æªæ–½:
  - æ¥å…¥å±‚å¯ç”¨BPDU Guard
  - ç«¯å£å®‰å…¨é™åˆ¶MACæ•°é‡
  - ç›‘æ§å¹¿æ’­æµé‡
```

---

## 9. è¯Šæ–­å‘½ä»¤å¤§å…¨

### 9.1 Ciscoè¯Šæ–­å‘½ä»¤

```cisco
! ========================================
! Ciscoå¸¸ç”¨è¯Šæ–­å‘½ä»¤
! ========================================

! === åŸºç¡€ä¿¡æ¯ ===
show version                          ! ç‰ˆæœ¬ä¿¡æ¯
show running-config                   ! è¿è¡Œé…ç½®
show startup-config                   ! å¯åŠ¨é…ç½®
show inventory                        ! ç¡¬ä»¶æ¸…å•
show module                           ! æ¨¡å—ä¿¡æ¯

! === æ¥å£è¯Šæ–­ ===
show interfaces                       ! æ‰€æœ‰æ¥å£çŠ¶æ€
show interfaces status                ! æ¥å£ç®€è¦çŠ¶æ€
show interfaces GigabitEthernet1/0/1  ! ç‰¹å®šæ¥å£è¯¦ç»†ä¿¡æ¯
show interfaces counters              ! æ¥å£è®¡æ•°å™¨
show interfaces counters errors       ! æ¥å£é”™è¯¯ç»Ÿè®¡
show interfaces description           ! æ¥å£æè¿°
show controllers                      ! æ§åˆ¶å™¨ä¿¡æ¯

! === VLANå’Œäº¤æ¢ ===
show vlan brief                       ! VLANç®€è¦ä¿¡æ¯
show vlan id 10                       ! ç‰¹å®šVLANè¯¦æƒ…
show interfaces switchport            ! äº¤æ¢ç«¯å£é…ç½®
show interfaces trunk                 ! Trunkç«¯å£ä¿¡æ¯
show mac address-table                ! MACåœ°å€è¡¨
show mac address-table aging-time     ! MACè€åŒ–æ—¶é—´

! === é“¾è·¯èšåˆ ===
show etherchannel summary             ! EtherChannelæ¦‚è¦
show etherchannel 1 detail            ! ç‰¹å®šChannelè¯¦æƒ…
show lacp neighbor                    ! LACPé‚»å±…
show lacp internal                    ! LACPå†…éƒ¨çŠ¶æ€

! === ç”Ÿæˆæ ‘ ===
show spanning-tree                    ! ç”Ÿæˆæ ‘çŠ¶æ€
show spanning-tree summary            ! ç”Ÿæˆæ ‘æ‘˜è¦
show spanning-tree vlan 10            ! ç‰¹å®šVLANç”Ÿæˆæ ‘
show spanning-tree interface Gi1/0/1  ! ç‰¹å®šæ¥å£ç”Ÿæˆæ ‘
show spanning-tree blockedports       ! è¢«é˜»å¡ç«¯å£

! === è·¯ç”±ç›¸å…³ ===
show ip interface brief               ! IPæ¥å£ç®€è¦
show ip route                         ! è·¯ç”±è¡¨
show ip arp                           ! ARPè¡¨
show ip protocols                     ! è·¯ç”±åè®®
show ip route summary                 ! è·¯ç”±æ‘˜è¦

! === VRRP/HSRP ===
show vrrp brief                       ! VRRPç®€è¦
show vrrp interface Vlan10            ! ç‰¹å®šæ¥å£VRRP
show standby brief                    ! HSRPç®€è¦
show standby                          ! HSRPè¯¦ç»†

! === ACL ===
show access-lists                     ! æ‰€æœ‰ACL
show ip access-lists                  ! IP ACL
show ip interface Vlan10 | include access list  ! æ¥å£åº”ç”¨çš„ACL

! === æ€§èƒ½ç›‘æ§ ===
show processes cpu                    ! CPUä½¿ç”¨
show processes cpu sorted             ! CPUæ’åº
show processes cpu history            ! CPUå†å²
show processes memory                 ! å†…å­˜ä½¿ç”¨
show processes memory sorted          ! å†…å­˜æ’åº
show environment all                  ! ç¯å¢ƒä¼ æ„Ÿå™¨

! === æ—¥å¿— ===
show logging                          ! æ—¥å¿—ä¿¡æ¯
show logging | include ERROR          ! è¿‡æ»¤é”™è¯¯
show archive log config all           ! é…ç½®å˜æ›´å†å²

! === è¯Šæ–­æµ‹è¯• ===
ping 192.168.10.1                     ! Pingæµ‹è¯•
traceroute 192.168.10.1               ! è·¯ç”±è¿½è¸ª
telnet 192.168.10.1 22                ! Telnetç«¯å£æµ‹è¯•

! === CDP/LLDP ===
show cdp neighbors                    ! CDPé‚»å±…
show cdp neighbors detail             ! CDPè¯¦ç»†
show lldp neighbors                   ! LLDPé‚»å±…
show lldp neighbors detail            ! LLDPè¯¦ç»†
```

### 9.2 Linuxç½‘ç»œè¯Šæ–­å‘½ä»¤

```bash
#!/bin/bash
# ========================================
# Linuxç½‘ç»œè¯Šæ–­å‘½ä»¤
# ========================================

# === æ¥å£çŠ¶æ€ ===
ip addr show                          # IPåœ°å€
ip link show                          # é“¾è·¯çŠ¶æ€
ifconfig -a                           # æ‰€æœ‰æ¥å£
ethtool eth0                          # ç½‘å¡è¯¦ç»†ä¿¡æ¯
ethtool -S eth0                       # ç½‘å¡ç»Ÿè®¡

# === è·¯ç”±å’Œç½‘å…³ ===
ip route show                         # è·¯ç”±è¡¨
route -n                              # è·¯ç”±è¡¨(æ•°å­—)
ip neigh show                         # ARPè¡¨(é‚»å±…)
arp -an                               # ARPè¡¨

# === è¿æ¥çŠ¶æ€ ===
ss -tunlp                             # æ‰€æœ‰ç›‘å¬ç«¯å£
ss -s                                 # å¥—æ¥å­—ç»Ÿè®¡
netstat -tunlp                        # æ‰€æœ‰è¿æ¥
netstat -i                            # æ¥å£ç»Ÿè®¡

# === è¿é€šæ€§æµ‹è¯• ===
ping -c 4 192.168.10.1                # Pingæµ‹è¯•
ping6 -c 4 fe80::1                    # IPv6 Ping
traceroute 192.168.10.1               # è·¯ç”±è¿½è¸ª
mtr 192.168.10.1                      # æŒç»­è·¯ç”±è¿½è¸ª

# === DNS ===
nslookup www.example.com              # DNSæŸ¥è¯¢
dig www.example.com                   # DNSè¯¦ç»†æŸ¥è¯¢
host www.example.com                  # ç®€å•DNSæŸ¥è¯¢

# === ç«¯å£æ‰«æ ===
nmap -p 80,443 192.168.10.1           # ç«¯å£æ‰«æ
nc -zv 192.168.10.1 80                # ç«¯å£æµ‹è¯•
telnet 192.168.10.1 80                # Telnetæµ‹è¯•

# === æµé‡ç›‘æ§ ===
iftop                                 # å®æ—¶æµé‡ç›‘æ§
nethogs                               # æŒ‰è¿›ç¨‹æµé‡
iptraf-ng                             # äº¤äº’å¼æµé‡ç›‘æ§
tcpdump -i eth0 -n                    # æŠ“åŒ…
tcpdump -i eth0 port 80 -w capture.pcap  # æŠ“åŒ…ä¿å­˜

# === é˜²ç«å¢™ ===
iptables -L -v -n                     # iptablesè§„åˆ™
iptables -L INPUT -v -n --line-numbers  # å¸¦è¡Œå·
nft list ruleset                      # nftablesè§„åˆ™
ufw status verbose                    # UFWçŠ¶æ€

# === æ€§èƒ½ ===
iperf3 -s                             # iperf3æœåŠ¡å™¨
iperf3 -c 192.168.10.1                # iperf3å®¢æˆ·ç«¯
speedtest-cli                         # ç½‘é€Ÿæµ‹è¯•

# === æ—¥å¿— ===
journalctl -u networking -f           # ç½‘ç»œæœåŠ¡æ—¥å¿—
tail -f /var/log/syslog | grep -i network  # å®æ—¶ç½‘ç»œæ—¥å¿—
dmesg | grep -i eth                   # å†…æ ¸ç½‘ç»œæ¶ˆæ¯
```

---

## 10. æ•…éšœæ’æŸ¥å·¥å…·

### 10.1 æŠ“åŒ…åˆ†æ (tcpdump/Wireshark)

```bash
#!/bin/bash
# ========================================
# tcpdumpæŠ“åŒ…ç¤ºä¾‹
# ========================================

# åŸºç¡€æŠ“åŒ…
tcpdump -i eth0

# æŠ“å–ç‰¹å®šä¸»æœº
tcpdump -i eth0 host 192.168.10.100

# æŠ“å–ç‰¹å®šç«¯å£
tcpdump -i eth0 port 80

# æŠ“å–TCP SYNåŒ… (ç«¯å£æ‰«ææ£€æµ‹)
tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn) != 0'

# æŠ“å–ICMP
tcpdump -i eth0 icmp

# ä¿å­˜åˆ°æ–‡ä»¶
tcpdump -i eth0 -w capture.pcap

# è¯»å–æ–‡ä»¶
tcpdump -r capture.pcap

# åªæ˜¾ç¤ºåŒ…å¤´
tcpdump -i eth0 -n -c 100

# è¯¦ç»†æ˜¾ç¤º
tcpdump -i eth0 -vv -n

# è¿‡æ»¤ç»„åˆ
tcpdump -i eth0 'src 192.168.10.100 and dst port 3306'

# æ’é™¤SSHæµé‡
tcpdump -i eth0 'port not 22'
```

### 10.2 ç½‘ç»œæ€§èƒ½æµ‹è¯•

```bash
#!/bin/bash
# ========================================
# ç½‘ç»œæ€§èƒ½æµ‹è¯•è„šæœ¬
# ========================================

TARGET_HOST="192.168.10.100"
DURATION=30

echo "=== ç½‘ç»œæ€§èƒ½æµ‹è¯• ==="
echo "ç›®æ ‡: $TARGET_HOST"
echo "æ—¶é—´: $(date)"
echo ""

# 1. å»¶è¿Ÿæµ‹è¯•
echo "--- Pingå»¶è¿Ÿæµ‹è¯• ---"
ping -c 10 $TARGET_HOST | tail -2

# 2. å¸¦å®½æµ‹è¯• (iperf3)
echo -e "\n--- å¸¦å®½æµ‹è¯• (TCP) ---"
iperf3 -c $TARGET_HOST -t $DURATION

echo -e "\n--- å¸¦å®½æµ‹è¯• (UDP) ---"
iperf3 -c $TARGET_HOST -u -b 1G -t 10

# 3. è·¯ç”±è¿½è¸ª
echo -e "\n--- è·¯ç”±è¿½è¸ª ---"
traceroute -n $TARGET_HOST

# 4. MTUæµ‹è¯•
echo -e "\n--- MTUæµ‹è¯• ---"
for size in 1472 1500 8972 9000; do
    echo "æµ‹è¯•MTU $size:"
    ping -c 3 -M do -s $size $TARGET_HOST 2>&1 | grep -E "bytes of data|Message too long"
done

# 5. å¹¶å‘è¿æ¥æµ‹è¯•
echo -e "\n--- å¹¶å‘è¿æ¥æµ‹è¯• ---"
iperf3 -c $TARGET_HOST -P 10 -t 10

echo -e "\nâœ… æµ‹è¯•å®Œæˆ"
```

### 10.3 è‡ªåŠ¨åŒ–å·¡æ£€è„šæœ¬

```bash
#!/bin/bash
# ========================================
# ç½‘ç»œè®¾å¤‡è‡ªåŠ¨åŒ–å·¡æ£€è„šæœ¬
# ========================================

DEVICES_FILE="devices.txt"  # è®¾å¤‡åˆ—è¡¨æ–‡ä»¶
REPORT_DIR="/var/log/network-patrol"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$REPORT_DIR"

while IFS=: read -r IP NAME; do
    echo "========================================" | tee "$REPORT_DIR/${NAME}_${DATE}.log"
    echo "å·¡æ£€è®¾å¤‡: $NAME ($IP)" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    echo "æ—¶é—´: $(date)" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    echo "" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    
    # è¿é€šæ€§æµ‹è¯•
    echo "--- Pingæµ‹è¯• ---" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    if ping -c 3 -W 2 $IP &> /dev/null; then
        echo "âœ… è®¾å¤‡å¯è¾¾" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    else
        echo "âŒ è®¾å¤‡ä¸å¯è¾¾" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
        continue
    fi
    
    # SNMPæ£€æŸ¥ (å‡è®¾ä½¿ç”¨SNMPv2c, community=public)
    echo -e "\n--- CPUä½¿ç”¨ç‡ ---" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    CPU=$(snmpget -v2c -c public -Ovq $IP .1.3.6.1.4.1.9.9.109.1.1.1.1.3.1 2>/dev/null)
    if [ -n "$CPU" ]; then
        echo "CPU: $CPU%" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
        if [ "$CPU" -gt 80 ]; then
            echo "âš ï¸  è­¦å‘Š: CPUä½¿ç”¨ç‡è¿‡é«˜" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
        fi
    fi
    
    echo -e "\n--- å†…å­˜ä½¿ç”¨ ---" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
    MEM_USED=$(snmpget -v2c -c public -Ovq $IP .1.3.6.1.4.1.9.9.48.1.1.1.5.1 2>/dev/null)
    MEM_FREE=$(snmpget -v2c -c public -Ovq $IP .1.3.6.1.4.1.9.9.48.1.1.1.6.1 2>/dev/null)
    if [ -n "$MEM_USED" ] && [ -n "$MEM_FREE" ]; then
        MEM_TOTAL=$((MEM_USED + MEM_FREE))
        MEM_PERCENT=$((MEM_USED * 100 / MEM_TOTAL))
        echo "å†…å­˜ä½¿ç”¨: $MEM_USED / $MEM_TOTAL ($MEM_PERCENT%)" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
        if [ "$MEM_PERCENT" -gt 90 ]; then
            echo "âš ï¸  è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜" | tee -a "$REPORT_DIR/${NAME}_${DATE}.log"
        fi
    fi
    
done < "$DEVICES_FILE"

echo "âœ… å·¡æ£€å®Œæˆï¼ŒæŠ¥å‘Šä¿å­˜åœ¨: $REPORT_DIR"
```

---

## ç›¸å…³æ–‡æ¡£

- [ç½‘ç»œæ‹“æ‰‘ä¸VLANè§„åˆ’](01_ç½‘ç»œæ‹“æ‰‘ä¸VLANè§„åˆ’.md)
- [äº¤æ¢æœºé…ç½®ä¸ä¼˜åŒ–](02_äº¤æ¢æœºé…ç½®ä¸ä¼˜åŒ–.md)
- [è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨](03_è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨.md)
- [ç½‘ç»œå®‰å…¨ç­–ç•¥](04_ç½‘ç»œå®‰å…¨ç­–ç•¥.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
